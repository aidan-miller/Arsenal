<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Reject Inference - Clean &amp; Prepare Reject Data | Arsenal Repository</title>
  <meta name="description" content="Chapter 6 Reject Inference - Clean &amp; Prepare Reject Data | Arsenal Repository" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Reject Inference - Clean &amp; Prepare Reject Data | Arsenal Repository" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Reject Inference - Clean &amp; Prepare Reject Data | Arsenal Repository" />
  
  
  

<meta name="author" content="Aidan Miller" />


<meta name="date" content="2023-07-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reject-inference---clean-prepare-reject-data.html"/>
<link rel="next" href="add-scores-to-train-comb-from-final-model.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Arsenal Repo</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> The Arsenal Repository</a></li>
<li class="chapter" data-level="2" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html"><i class="fa fa-check"></i><b>2</b> Financial Score Card Model</a></li>
<li class="chapter" data-level="3" data-path="evaluate-the-initial-model---training-data.html"><a href="evaluate-the-initial-model---training-data.html"><i class="fa fa-check"></i><b>3</b> Evaluate the Initial Model - Training Data</a></li>
<li class="chapter" data-level="4" data-path="add-scores-to-initial-model-on-training-data.html"><a href="add-scores-to-initial-model-on-training-data.html"><i class="fa fa-check"></i><b>4</b> Add Scores to Initial Model on Training Data</a></li>
<li class="chapter" data-level="5" data-path="reject-inference---clean-prepare-reject-data.html"><a href="reject-inference---clean-prepare-reject-data.html"><i class="fa fa-check"></i><b>5</b> Reject Inference - Clean &amp; Prepare Reject Data</a></li>
<li class="chapter" data-level="6" data-path="reject-inference---clean-prepare-reject-data-1.html"><a href="reject-inference---clean-prepare-reject-data-1.html"><i class="fa fa-check"></i><b>6</b> Reject Inference - Clean &amp; Prepare Reject Data</a></li>
<li class="chapter" data-level="7" data-path="add-scores-to-train-comb-from-final-model.html"><a href="add-scores-to-train-comb-from-final-model.html"><i class="fa fa-check"></i><b>7</b> Add Scores to Train Comb from Final Model</a></li>
<li class="chapter" data-level="8" data-path="add-scores-to-test-comb-from-final-model.html"><a href="add-scores-to-test-comb-from-final-model.html"><i class="fa fa-check"></i><b>8</b> Add Scores to Test Comb from Final Model</a></li>
<li class="chapter" data-level="9" data-path="a-caucus-race-and-a-long-tale.html"><a href="a-caucus-race-and-a-long-tale.html"><i class="fa fa-check"></i><b>9</b> A caucus-race and a long tale</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Arsenal Repository</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reject-inference---clean-prepare-reject-data-1" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Reject Inference - Clean &amp; Prepare Reject Data<a href="reject-inference---clean-prepare-reject-data-1.html#reject-inference---clean-prepare-reject-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-1" tabindex="-1"></a><span class="co">#altering the bands for each binning set in the results list in case there are any additional lower points or higher points in the rejects data</span></span>
<span id="cb83-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-2" tabindex="-1"></a><span class="co">#this is mostly for the numeric values </span></span>
<span id="cb83-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-3" tabindex="-1"></a></span>
<span id="cb83-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-4" tabindex="-1"></a><span class="co">#making sure bands change in our results_all_sig_char for accepts and rejects combined</span></span>
<span id="cb83-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-5" tabindex="-1"></a><span class="co">#this shouldnt cause any issues in the binner and WoE creating as long as there are the same type of unique levels</span></span>
<span id="cb83-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-6" tabindex="-1"></a><span class="co">#this will not run since these are categorical variables so no need to set band</span></span>
<span id="cb83-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-7" tabindex="-1"></a><span class="co"># for(i in names(results_all_sig_char)) {</span></span>
<span id="cb83-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-8" tabindex="-1"></a><span class="co">#   results_all_sig_char[[i]]$bands[1] &lt;- min(c(accepts[[i]], rejects[[i]]), na.rm = TRUE)</span></span>
<span id="cb83-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-9" tabindex="-1"></a><span class="co">#   results_all_sig_char[[i]]$bands[length(results_all_sig_char[[i]]$bands)] &lt;- max(c(accepts[[i]], rejects[[i]]), na.rm = TRUE)</span></span>
<span id="cb83-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-10" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb83-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-11" tabindex="-1"></a></span>
<span id="cb83-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-12" tabindex="-1"></a></span>
<span id="cb83-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-13" tabindex="-1"></a><span class="co">#making sure bands change in our results_all_sig_num for accepts and rejects combined</span></span>
<span id="cb83-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-14" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(results_all_sig_num)) {</span>
<span id="cb83-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-15" tabindex="-1"></a>  results_all_sig_num[[i]]<span class="sc">$</span>bands[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">c</span>(accepts[[i]], rejects[[i]]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-16" tabindex="-1"></a>  results_all_sig_num[[i]]<span class="sc">$</span>bands[<span class="fu">length</span>(results_all_sig_num[[i]]<span class="sc">$</span>bands)] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">c</span>(accepts[[i]], rejects[[i]]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-17" tabindex="-1"></a>}</span>
<span id="cb83-18"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-18" tabindex="-1"></a></span>
<span id="cb83-19"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-19" tabindex="-1"></a><span class="co">#Getting the bins of the variables in the results_all_sig numeric </span></span>
<span id="cb83-20"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-20" tabindex="-1"></a>rejects_scored <span class="ot">&lt;-</span> rejects</span>
<span id="cb83-21"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-21" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_num)) {</span>
<span id="cb83-22"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-22" tabindex="-1"></a>  rejects_scored <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> rejects_scored, <span class="at">ivout =</span> results_all_sig_num[[i]], </span>
<span id="cb83-23"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-23" tabindex="-1"></a>                                  <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb83-24"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-24" tabindex="-1"></a>}</span>
<span id="cb83-25"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-25" tabindex="-1"></a></span>
<span id="cb83-26"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-26" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_char)) {</span>
<span id="cb83-27"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-27" tabindex="-1"></a>  rejects_scored <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> rejects_scored, <span class="at">ivout =</span> results_all_sig_char[[i]], </span>
<span id="cb83-28"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-28" tabindex="-1"></a>                                         <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb83-29"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-29" tabindex="-1"></a>}</span>
<span id="cb83-30"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-30" tabindex="-1"></a></span>
<span id="cb83-31"><a href="reject-inference---clean-prepare-reject-data-1.html#cb83-31" tabindex="-1"></a>results_all_sig_AR<span class="ot">=</span><span class="fu">append</span>(results_all_sig_num,results_all_sig_char)</span></code></pre></div>
<p>Getting the WoE values for our Rejects Bins we Just Created
-This wont work if the levels of the categories are not the same across the rejects and accepts data for the significant categorical vars in the results list
-This also wont work if our bands for the numeric sig vars are not altered to account for both the accepts and the rejects</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-1" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_AR)) {</span>
<span id="cb84-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-2" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rejects_scored)) {</span>
<span id="cb84-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-3" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_AR[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb84-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-4" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(rejects_scored[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb84-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-5" tabindex="-1"></a>    </span>
<span id="cb84-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-6" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_AR[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb84-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-7" tabindex="-1"></a>    </span>
<span id="cb84-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-8" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb84-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-9" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig_AR[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb84-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-10" tabindex="-1"></a>      rejects_scored[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_AR[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb84-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-11" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb84-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-12" tabindex="-1"></a>      rejects_scored[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_AR[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb84-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-13" tabindex="-1"></a>    }</span>
<span id="cb84-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-14" tabindex="-1"></a>  }</span>
<span id="cb84-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-15" tabindex="-1"></a>}</span>
<span id="cb84-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-16" tabindex="-1"></a></span>
<span id="cb84-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb84-17" tabindex="-1"></a><span class="fu">head</span>(rejects_scored)</span></code></pre></div>
<pre><code>##   CHILDREN PERS_H TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN CASH          PRODUCT RESID
## 1        0      1     6     18   1       0       0      0       1      3        1     0    0  500 Dept. Store,Mail Lease
## 2        1      2    84     54   1       0       0   2500       0      2        1     0    3 1700 Furniture,Carpet Lease
## 3        1      3    36    108   2       0       1   2600       0      1        1     2    0  900  Radio, TV, Hifi Owner
## 4        2      3   168     15   1       0       0   1600       0      3        1     0    0 1200  Radio, TV, Hifi  &lt;NA&gt;
## 5        0      1   240      9   2       0       0      0       1      3        1     0    0 4000 Furniture,Carpet Lease
## 6        2      4    30      9   2       2       0   1700       0      3        1     0    0 2000  Radio, TV, Hifi Lease
##               PROF             CAR           CARDS TMJOB1_bin INCOME_bin PERS_H_bin              CARDS_bin EC_CARD_bin TMJOB1_WOE
## 1           Others             Car     Cheque card   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;     01 = &#39;Cheque card&#39;    02 = &#39;1&#39;    -0.3991
## 2 Food,Building,Ca Without Vehicle no credit cards  02 &lt;= 144     02 &gt; 0   02 = &#39;2&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;     0.0533
## 3           Others             Car no credit cards  02 &lt;= 144     02 &gt; 0   03 = &#39;3&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;     0.0533
## 4           Others Without Vehicle no credit cards   01 &lt;= 30     02 &gt; 0   03 = &#39;3&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;    -0.3991
## 5           Others Without Vehicle     Cheque card   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;     01 = &#39;Cheque card&#39;    02 = &#39;1&#39;    -0.3991
## 6           Others Without Vehicle no credit cards   01 &lt;= 30     02 &gt; 0   04 = &#39;4&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;    -0.3991
##   INCOME_WOE PERS_H_WOE CARDS_WOE EC_CARD_WOE
## 1     0.6767    -0.5239    0.6846      0.6846
## 2    -0.2075     0.4283   -0.2663     -0.2313
## 3    -0.2075     0.3172   -0.2663     -0.2313
## 4    -0.2075     0.3172   -0.2663     -0.2313
## 5     0.6767    -0.5239    0.6846      0.6846
## 6    -0.2075     0.2948   -0.2663     -0.2313</code></pre>
<p>#getting the scores for rejects data from our initial model we made</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-1" tabindex="-1"></a>pdo <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb86-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-2" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb86-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-3" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb86-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-4" tabindex="-1"></a>fact <span class="ot">&lt;-</span> pdo<span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)</span>
<span id="cb86-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-5" tabindex="-1"></a>os <span class="ot">&lt;-</span> score <span class="sc">-</span> fact<span class="sc">*</span><span class="fu">log</span>(odds)</span>
<span id="cb86-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-6" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">names</span>(initial_score<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb86-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-7" tabindex="-1"></a></span>
<span id="cb86-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-8" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> var_names) {</span>
<span id="cb86-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-9" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[i]</span>
<span id="cb86-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-10" tabindex="-1"></a>  beta0 <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb86-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-11" tabindex="-1"></a>  nvar <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb86-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-12" tabindex="-1"></a>  WOE_var <span class="ot">&lt;-</span> rejects_scored[[i]]</span>
<span id="cb86-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-13" tabindex="-1"></a>  points_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(i, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>), <span class="st">&quot;points&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb86-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-14" tabindex="-1"></a>  </span>
<span id="cb86-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-15" tabindex="-1"></a>  rejects_scored[[points_name]] <span class="ot">&lt;-</span> <span class="sc">-</span>(WOE_var<span class="sc">*</span>(beta) <span class="sc">+</span> (beta0<span class="sc">/</span>nvar))<span class="sc">*</span>fact <span class="sc">+</span> os<span class="sc">/</span>nvar</span>
<span id="cb86-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-16" tabindex="-1"></a>}</span>
<span id="cb86-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-17" tabindex="-1"></a></span>
<span id="cb86-18"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-18" tabindex="-1"></a>colini <span class="ot">&lt;-</span> (<span class="fu">ncol</span>(rejects_scored)<span class="sc">-</span>nvar <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb86-19"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-19" tabindex="-1"></a>colend <span class="ot">&lt;-</span> <span class="fu">ncol</span>(rejects_scored)</span>
<span id="cb86-20"><a href="reject-inference---clean-prepare-reject-data-1.html#cb86-20" tabindex="-1"></a>rejects_scored<span class="sc">$</span>Score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(rejects_scored[, colini<span class="sc">:</span>colend])</span></code></pre></div>
<p>Parceling our Rejects Data to get our GB variable</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb87-1" tabindex="-1"></a>parc <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">25</span>)</span>
<span id="cb87-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb87-2" tabindex="-1"></a></span>
<span id="cb87-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb87-3" tabindex="-1"></a>accepts_scored<span class="sc">$</span>Score_parc <span class="ot">&lt;-</span> <span class="fu">cut</span>(accepts_scored<span class="sc">$</span>Score, <span class="at">breaks =</span> parc)</span>
<span id="cb87-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb87-4" tabindex="-1"></a>rejects_scored<span class="sc">$</span>Score_parc <span class="ot">&lt;-</span> <span class="fu">cut</span>(rejects_scored<span class="sc">$</span>Score, <span class="at">breaks =</span> parc)</span>
<span id="cb87-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb87-6" tabindex="-1"></a><span class="fu">table</span>(accepts_scored<span class="sc">$</span>Score_parc, accepts_scored<span class="sc">$</span>GB)</span></code></pre></div>
<pre><code>##            
##               0   1
##   (200,225]   0   0
##   (225,250]   1   7
##   (250,275] 121 336
##   (275,300] 121 238
##   (300,325] 257 326
##   (325,350] 328 288
##   (350,375] 143  92
##   (375,400] 202  85
##   (400,425] 233 110
##   (425,450]  13   3
##   (450,475]  74  15
##   (475,500]   7   0</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-1" tabindex="-1"></a>parc_perc <span class="ot">&lt;-</span> <span class="fu">table</span>(accepts_scored<span class="sc">$</span>Score_parc, accepts_scored<span class="sc">$</span>GB)[,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">rowSums</span>(<span class="fu">table</span>(accepts_scored<span class="sc">$</span>Score_parc, accepts_scored<span class="sc">$</span>GB))</span>
<span id="cb89-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-2" tabindex="-1"></a></span>
<span id="cb89-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-3" tabindex="-1"></a>rejects<span class="sc">$</span>GB <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb89-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-4" tabindex="-1"></a></span>
<span id="cb89-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-5" tabindex="-1"></a>rej_bump <span class="ot">&lt;-</span> <span class="fl">1.25</span></span>
<span id="cb89-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-6" tabindex="-1"></a></span>
<span id="cb89-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(parc)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb89-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-8" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(rejects_scored<span class="sc">$</span>Score)) {</span>
<span id="cb89-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-9" tabindex="-1"></a>    <span class="cf">if</span>((rejects_scored<span class="sc">$</span>Score[j] <span class="sc">&gt;</span> parc[i]) <span class="sc">&amp;</span> </span>
<span id="cb89-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-10" tabindex="-1"></a>       (rejects_scored<span class="sc">$</span>Score[j] <span class="sc">&lt;=</span> parc[i<span class="sc">+</span><span class="dv">1</span>]) <span class="sc">&amp;</span> </span>
<span id="cb89-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-11" tabindex="-1"></a>       (<span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>) <span class="sc">&lt;</span> (rej_bump<span class="sc">*</span>parc_perc[i]))) {</span>
<span id="cb89-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-12" tabindex="-1"></a>      rejects<span class="sc">$</span>GB[j] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb89-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-13" tabindex="-1"></a>    }</span>
<span id="cb89-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-14" tabindex="-1"></a>  }</span>
<span id="cb89-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-15" tabindex="-1"></a>}</span>
<span id="cb89-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-16" tabindex="-1"></a></span>
<span id="cb89-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb89-17" tabindex="-1"></a><span class="fu">table</span>(rejects_scored<span class="sc">$</span>Score_parc, rejects<span class="sc">$</span>GB)</span></code></pre></div>
<pre><code>##            
##               0   1
##   (200,225]   0   0
##   (225,250]   0   2
##   (250,275]  25 321
##   (275,300]  28 165
##   (300,325] 111 254
##   (325,350] 126 183
##   (350,375]  30  30
##   (375,400]  69  38
##   (400,425]  65  29
##   (425,450]   4   1
##   (450,475]   7   3
##   (475,500]   9   0</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb91-1" tabindex="-1"></a>rejects<span class="sc">$</span>good <span class="ot">&lt;-</span> <span class="fu">abs</span>(rejects<span class="sc">$</span>GB <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Verifying the Weights</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb92-1" tabindex="-1"></a><span class="co">#goods are weighted by 30</span></span>
<span id="cb92-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb92-2" tabindex="-1"></a><span class="co">#take the population of bads and divide it by the population of goods times the weight given</span></span>
<span id="cb92-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb92-3" tabindex="-1"></a><span class="dv">1500</span><span class="sc">/</span>(<span class="dv">1500</span><span class="sc">*</span><span class="dv">30</span>)</span></code></pre></div>
<pre><code>## [1] 0.03333333</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb94-1" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fl">0.0323</span></span></code></pre></div>
<pre><code>## [1] 30.95975</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-1" tabindex="-1"></a><span class="co">#you get .0333--&gt; 3.33%which is essentially the populations bad rate of 3.23%</span></span>
<span id="cb96-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-2" tabindex="-1"></a></span>
<span id="cb96-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-3" tabindex="-1"></a><span class="co">#could also take the population percentage of bad and put it under 1 to get what the actual weights should be which are 30.95975</span></span>
<span id="cb96-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-4" tabindex="-1"></a></span>
<span id="cb96-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-5" tabindex="-1"></a>pop_g <span class="ot">&lt;-</span> <span class="fl">0.9677</span></span>
<span id="cb96-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-6" tabindex="-1"></a>pop_b <span class="ot">&lt;-</span> <span class="fl">0.0323</span></span>
<span id="cb96-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-7" tabindex="-1"></a>sam_g <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb96-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-8" tabindex="-1"></a>sam_b <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb96-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-9" tabindex="-1"></a></span>
<span id="cb96-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-10" tabindex="-1"></a><span class="co">#verifying the initial weigths of 30 for the accepts dataset </span></span>
<span id="cb96-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-11" tabindex="-1"></a>Weight_Of_Good_AcceptsDF<span class="ot">=</span>(pop_g<span class="sc">/</span>pop_b)<span class="sc">/</span>(sam_g<span class="sc">/</span>sam_b)</span>
<span id="cb96-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb96-12" tabindex="-1"></a>Weight_Of_Good_AcceptsDF</span></code></pre></div>
<pre><code>## [1] 29.95975</code></pre>
<p>Adjusting the weights of Good to Bad for our Accepts and Rejects Data Set</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-1" tabindex="-1"></a><span class="co"># rejects_scored$pred &lt;- predict(initial_score, newdata=rejects_scored, type=&#39;response&#39;)</span></span>
<span id="cb98-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-2" tabindex="-1"></a><span class="co"># rejects$GB &lt;- as.numeric(rejects_scored$pred &gt; 0.0617)</span></span>
<span id="cb98-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-3" tabindex="-1"></a><span class="co"># rejects$good &lt;- abs(rejects$GB - 1)</span></span>
<span id="cb98-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-4" tabindex="-1"></a></span>
<span id="cb98-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-5" tabindex="-1"></a>pop_g <span class="ot">&lt;-</span> <span class="fl">0.9677</span></span>
<span id="cb98-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-6" tabindex="-1"></a>pop_b <span class="ot">&lt;-</span> <span class="fl">0.0323</span></span>
<span id="cb98-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-7" tabindex="-1"></a></span>
<span id="cb98-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-8" tabindex="-1"></a>sam_g <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb98-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-9" tabindex="-1"></a>sam_b <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb98-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-10" tabindex="-1"></a></span>
<span id="cb98-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-11" tabindex="-1"></a>pop_sam_gb_ratio <span class="ot">&lt;-</span> (pop_g<span class="sc">/</span>pop_b)<span class="sc">/</span>(sam_g<span class="sc">/</span>sam_b)</span>
<span id="cb98-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-12" tabindex="-1"></a></span>
<span id="cb98-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-13" tabindex="-1"></a>pop_a <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb98-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-14" tabindex="-1"></a>pop_r <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb98-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-15" tabindex="-1"></a></span>
<span id="cb98-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-16" tabindex="-1"></a>sam_a <span class="ot">&lt;-</span> <span class="dv">3000</span></span>
<span id="cb98-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-17" tabindex="-1"></a>sam_r <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb98-18"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-18" tabindex="-1"></a></span>
<span id="cb98-19"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-19" tabindex="-1"></a>pop_sam_ar_ratio <span class="ot">&lt;-</span> (pop_a<span class="sc">/</span>pop_r)<span class="sc">/</span>(sam_a<span class="sc">/</span>sam_r)</span>
<span id="cb98-20"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-20" tabindex="-1"></a></span>
<span id="cb98-21"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-21" tabindex="-1"></a>weight_rb <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-22"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-22" tabindex="-1"></a>weight_rg <span class="ot">&lt;-</span> pop_sam_gb_ratio</span>
<span id="cb98-23"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-23" tabindex="-1"></a></span>
<span id="cb98-24"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-24" tabindex="-1"></a>weight_ab <span class="ot">&lt;-</span> pop_sam_ar_ratio</span>
<span id="cb98-25"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-25" tabindex="-1"></a>weight_ag <span class="ot">&lt;-</span> pop_sam_ar_ratio<span class="sc">*</span>pop_sam_gb_ratio</span>
<span id="cb98-26"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-26" tabindex="-1"></a></span>
<span id="cb98-27"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-27" tabindex="-1"></a>accepts<span class="sc">$</span>weight_ar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(accepts<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>, weight_ab, weight_ag)</span>
<span id="cb98-28"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-28" tabindex="-1"></a>rejects<span class="sc">$</span>weight_ar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rejects<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>, weight_rb, weight_rg)</span>
<span id="cb98-29"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-29" tabindex="-1"></a></span>
<span id="cb98-30"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-30" tabindex="-1"></a></span>
<span id="cb98-31"><a href="reject-inference---clean-prepare-reject-data-1.html#cb98-31" tabindex="-1"></a>comb_parc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(accepts[, <span class="sc">!</span>(<span class="fu">names</span>(accepts) <span class="sc">==</span> <span class="st">&#39;_freq_&#39;</span>)], rejects) <span class="co"># New Combined Data Set #</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-1" tabindex="-1"></a>comb <span class="ot">&lt;-</span> comb_parc <span class="co"># Select which data set you want to use from above techniques #</span></span>
<span id="cb99-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-2" tabindex="-1"></a></span>
<span id="cb99-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0119</span>)</span>
<span id="cb99-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-4" tabindex="-1"></a>train_id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(comb)), <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.70</span><span class="sc">*</span><span class="fu">nrow</span>(comb)))</span>
<span id="cb99-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-5" tabindex="-1"></a></span>
<span id="cb99-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-6" tabindex="-1"></a>train_comb <span class="ot">&lt;-</span> comb[train_id, ]</span>
<span id="cb99-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-7" tabindex="-1"></a>test_comb <span class="ot">&lt;-</span> comb[<span class="sc">-</span>train_id, ]</span>
<span id="cb99-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-8" tabindex="-1"></a></span>
<span id="cb99-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb99-9" tabindex="-1"></a>iv_summary_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.sumiv</span>(<span class="at">df =</span> train_comb, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>)</span></code></pre></div>
<pre><code>##  
## 
  |                                                        
  |                                                  |   0%
  |                                                        
  |--                                                |   5%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----                                             |   9%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------                                           |  14%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------                                         |  18%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------                                       |  23%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |--------------                                    |  27%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |----------------                                  |  32%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------                                |  36%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |--------------------                              |  41%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------------------                           |  45%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------------------------                         |  50%
  |                                                        
  |---------------------------                       |  55%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------------------                    |  59%
  |                                                        
  |--------------------------------                  |  64%
  |                                                        
  |----------------------------------                |  68%
  |                                                        
  |------------------------------------              |  73%
  |                                                        
  |---------------------------------------           |  77%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------------------------------------         |  82%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------------------------------------------       |  86%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------------------------------------------     |  91%
  |                                                        
  |------------------------------------------------  |  95%
  |                                                        
  |--------------------------------------------------| 100%
## </code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb129-1" tabindex="-1"></a>iv_summary_comb<span class="ot">=</span> <span class="fu">na.omit</span>(iv_summary_comb)</span>
<span id="cb129-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb129-2" tabindex="-1"></a><span class="fu">smbinning.sumiv.plot</span>(iv_summary_comb)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb130-1" tabindex="-1"></a>iv_summary_comb</span></code></pre></div>
<pre><code>##        Char     IV            Process
## 8    INCOME 0.2471 Numeric binning OK
## 4    TMJOB1 0.2336 Numeric binning OK
## 2    PERS_H 0.2231  Factor binning OK
## 19    CARDS 0.2178  Factor binning OK
## 9   EC_CARD 0.1869  Factor binning OK
## 1  CHILDREN 0.0884  Factor binning OK
## 5       TEL 0.0557  Factor binning OK
## 18      CAR 0.0455  Factor binning OK
## 6   NMBLOAN 0.0337  Factor binning OK
## 3     TMADD 0.0222 Numeric binning OK
## 7   FINLOAN 0.0209  Factor binning OK
## 10   BUREAU 0.0184  Factor binning OK
## 13     REGN 0.0101  Factor binning OK
## 11 LOCATION 0.0036  Factor binning OK
## 16    RESID 0.0036  Factor binning OK
## 20       GB 0.0000  Factor binning OK</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-1" tabindex="-1"></a>imp_vars_comb<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb132-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(iv_summary_comb<span class="sc">$</span>Char)){</span>
<span id="cb132-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-3" tabindex="-1"></a>  <span class="cf">if</span> (iv_summary_comb<span class="sc">$</span>IV[i]<span class="sc">&gt;=</span>.<span class="dv">10</span>){</span>
<span id="cb132-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-4" tabindex="-1"></a>    imp_vars_comb<span class="ot">=</span><span class="fu">append</span>(imp_vars_comb, iv_summary_comb<span class="sc">$</span>Char[i])</span>
<span id="cb132-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-5" tabindex="-1"></a>  }</span>
<span id="cb132-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-6" tabindex="-1"></a>}</span>
<span id="cb132-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-7" tabindex="-1"></a></span>
<span id="cb132-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-8" tabindex="-1"></a></span>
<span id="cb132-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-9" tabindex="-1"></a><span class="co">#just using train 0 to just get the important vars names  </span></span>
<span id="cb132-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-10" tabindex="-1"></a>train_comb0<span class="ot">=</span>train_comb[,<span class="fu">c</span>(imp_vars_comb)]</span>
<span id="cb132-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-11" tabindex="-1"></a></span>
<span id="cb132-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-12" tabindex="-1"></a>num_names_comb0 <span class="ot">=</span> <span class="fu">names</span>(train_comb0)[<span class="fu">sapply</span>(train_comb0, is.numeric)] <span class="co"># Gathering the names of numeric variables in data #</span></span>
<span id="cb132-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-13" tabindex="-1"></a></span>
<span id="cb132-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-14" tabindex="-1"></a>results_all_sig_comb_num <span class="ot">=</span> <span class="fu">list</span>() </span>
<span id="cb132-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-15" tabindex="-1"></a>results_all_sig_comb_char <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb132-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-16" tabindex="-1"></a></span>
<span id="cb132-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(num_names_comb0)){</span>
<span id="cb132-18"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-18" tabindex="-1"></a>  results_all_sig_comb_num[[num_names_comb0[i]]] <span class="ot">&lt;-</span> <span class="fu">smbinning</span>(<span class="at">df =</span> train_comb, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>, <span class="at">x =</span> num_names_comb0[i])</span>
<span id="cb132-19"><a href="reject-inference---clean-prepare-reject-data-1.html#cb132-19" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb134-1" tabindex="-1"></a>char_names_comb0 <span class="ot">=</span><span class="fu">names</span>(train_comb0)[<span class="fu">sapply</span>(train_comb0, is.factor)]</span>
<span id="cb134-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb134-2" tabindex="-1"></a></span>
<span id="cb134-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb134-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(char_names_comb0)){</span>
<span id="cb134-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb134-4" tabindex="-1"></a>  results_all_sig_comb_char[[char_names_comb0[i]]] <span class="ot">&lt;-</span> <span class="fu">smbinning.factor</span>(<span class="at">df =</span> train_comb, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>, <span class="at">x =</span> char_names_comb0[i])</span>
<span id="cb134-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb134-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-1" tabindex="-1"></a><span class="co"># Generating Variables of Bins #</span></span>
<span id="cb136-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_num)) {</span>
<span id="cb136-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-3" tabindex="-1"></a>  train_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> train_comb, <span class="at">ivout =</span> results_all_sig_comb_num[[i]], </span>
<span id="cb136-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-4" tabindex="-1"></a>                         <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb136-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-5" tabindex="-1"></a>}</span>
<span id="cb136-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-6" tabindex="-1"></a></span>
<span id="cb136-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-7" tabindex="-1"></a></span>
<span id="cb136-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-8" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_char)) {</span>
<span id="cb136-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-9" tabindex="-1"></a>  train_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> train_comb, <span class="at">ivout =</span> results_all_sig_comb_char[[i]], </span>
<span id="cb136-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-10" tabindex="-1"></a>                                     <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb136-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-11" tabindex="-1"></a>}</span>
<span id="cb136-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-12" tabindex="-1"></a></span>
<span id="cb136-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-13" tabindex="-1"></a><span class="co"># Generating Variables WOE Values from Bins just created #</span></span>
<span id="cb136-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-14" tabindex="-1"></a></span>
<span id="cb136-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-15" tabindex="-1"></a>results_all_sig_comb<span class="ot">=</span><span class="fu">append</span>(results_all_sig_comb_num,results_all_sig_comb_char)</span>
<span id="cb136-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-16" tabindex="-1"></a></span>
<span id="cb136-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-17" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb)) {</span>
<span id="cb136-18"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-18" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(train_comb)) {</span>
<span id="cb136-19"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-19" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb136-20"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-20" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(train_comb[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb136-21"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-21" tabindex="-1"></a></span>
<span id="cb136-22"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-22" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb136-23"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-23" tabindex="-1"></a>    </span>
<span id="cb136-24"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-24" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb136-25"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-25" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig_comb[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb136-26"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-26" tabindex="-1"></a>      train_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb136-27"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-27" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb136-28"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-28" tabindex="-1"></a>      train_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb136-29"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-29" tabindex="-1"></a>    }</span>
<span id="cb136-30"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-30" tabindex="-1"></a>  }</span>
<span id="cb136-31"><a href="reject-inference---clean-prepare-reject-data-1.html#cb136-31" tabindex="-1"></a>}</span></code></pre></div>
<p>Building Model ON Combined Data</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-1" tabindex="-1"></a>test_comb<span class="sc">$</span>GB<span class="ot">=</span><span class="fu">ifelse</span>(test_comb<span class="sc">$</span>GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb137-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-2" tabindex="-1"></a>train_comb<span class="sc">$</span>GB<span class="ot">=</span><span class="fu">ifelse</span>(train_comb<span class="sc">$</span>GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb137-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-3" tabindex="-1"></a></span>
<span id="cb137-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-4" tabindex="-1"></a><span class="co">#watch out for quasi complete sep in the categorical vars--might need to combine levels</span></span>
<span id="cb137-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-5" tabindex="-1"></a>final_score <span class="ot">&lt;-</span> <span class="fu">glm</span>(GB <span class="sc">~</span> </span>
<span id="cb137-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-6" tabindex="-1"></a>                       TMJOB1_WOE <span class="sc">+</span> </span>
<span id="cb137-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-7" tabindex="-1"></a>                       INCOME_WOE <span class="sc">+</span></span>
<span id="cb137-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-8" tabindex="-1"></a>                       CARDS_WOE <span class="sc">+</span> </span>
<span id="cb137-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-9" tabindex="-1"></a>                       PERS_H_WOE, </span>
<span id="cb137-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-10" tabindex="-1"></a>                       <span class="co">#EC_CARD_WOE, #dogwater predictor</span></span>
<span id="cb137-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-11" tabindex="-1"></a>                     <span class="at">data =</span> train_comb,</span>
<span id="cb137-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-12" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="fu">as.numeric</span>(train_comb<span class="sc">$</span>weight_ar), </span>
<span id="cb137-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb137-13" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb139-1" tabindex="-1"></a><span class="fu">summary</span>(final_score)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = GB ~ TMJOB1_WOE + INCOME_WOE + CARDS_WOE + PERS_H_WOE, 
##     family = &quot;binomial&quot;, data = train_comb, weights = as.numeric(train_comb$weight_ar))
## 
## Coefficients:
##             Estimate Std. Error  z value             Pr(&gt;|z|)    
## (Intercept) -3.14125    0.02248 -139.728 &lt; 0.0000000000000002 ***
## TMJOB1_WOE  -0.79840    0.04955  -16.113 &lt; 0.0000000000000002 ***
## INCOME_WOE  -0.35378    0.06194   -5.712         0.0000000112 ***
## CARDS_WOE   -0.75346    0.06927  -10.877 &lt; 0.0000000000000002 ***
## PERS_H_WOE  -0.80497    0.04482  -17.961 &lt; 0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 19670  on 3149  degrees of freedom
## Residual deviance: 18374  on 3145  degrees of freedom
## AIC: 21647
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb141-1" tabindex="-1"></a>train</span></code></pre></div>
<pre><code>##      CHILDREN PERS_H TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN CASH             PRODUCT RESID
## 1064        0      1    42     27   2       2       1      0       0      1        1     4    4 2000 Radio or TV or Hifi Lease
## 2376        0      1   240     27   2       0       0      0       1      3        1     0    6  500                Cars Lease
## 2861        0      1     9      6   1       0       1   1900       0      3        1     0    4 1000 Radio or TV or Hifi  &lt;NA&gt;
## 2277        1      2    18     30   1       0       0   2000       0      3        1     0    0 1700 Furniture or Carpet Lease
## 2773        1      3    15      9   2       0       0   1500       0      3        1     0    6 1600 Radio or TV or Hifi  &lt;NA&gt;
## 387         0      2   120    120   1       0       0   1800       1      1        1     1    0 1200 Radio or TV or Hifi  &lt;NA&gt;
## 1108        2      4    30     24   2       0       0   4000       0      1        1     1    5 1300 Radio or TV or Hifi Lease
## 2363        1      2    96     27   2       0       1  10000       0      1        1     1    0 1700 Radio or TV or Hifi Lease
## 1445        0      1    42      6   2       2       1   3000       0      1        1     1    3  500 Dept. Store or Mail Lease
## 2680        1      3    30     12   2       0       0   1600       0      1        1     2    9 1900                Cars Lease
## 1922        0      1   240     60   1       2       0      0       1      1        1     1    0  700 Furniture or Carpet Lease
## 2265        0      1     3     30   2       2       1      0       1      1        1     2    5 1100                Cars Lease
## 596         2      4    18     66   2       0       1   5000       0      3        1     0    8  900                Cars Lease
## 1381        3      5    36      9   2       2       1   2500       0      1        1     2    0  600 Radio or TV or Hifi Lease
## 2204        0      1   144     36   1       0       0   1700       0      3        1     0    5  500 Radio or TV or Hifi  &lt;NA&gt;
## 492         0      1   240     96   1       0       1      0       1      1        1     1    0 1300                Cars Lease
## 1287        0      1   168     15   2       0       0   2000       1      3        1     0    2 1000 Radio or TV or Hifi  &lt;NA&gt;
## 2161        0      1   264     39   1       0       0   1700       0      3        1     0    0 3000 Furniture or Carpet Lease
## 2427        2      4    84     24   1       0       0   1900       0      3        1     0    0  800 Dept. Store or Mail  &lt;NA&gt;
## 854         1      3    30     39   2       0       0   1800       0      1        1     1    7  500 Radio or TV or Hifi Lease
## 800         0      1   120     45   2       2       1   2500       0      1        1     1    4 1200 Radio or TV or Hifi  &lt;NA&gt;
## 577         1      3    72     72   2       2       1      0       1      1        1     1    3 1100 Radio or TV or Hifi Lease
## 1390        0      1    66      9   1       0       0      0       1      1        1     1    0 1400 Radio or TV or Hifi  &lt;NA&gt;
## 180         1      3   120    216   2       2       1   3300       0      1        1     1    4  500 Furniture or Carpet Lease
## 1563        2      4    84    216   2       0       1   2300       0      1        1     1    5  900 Radio or TV or Hifi Lease
## 2706        4      5   108     12   2       0       0   1000       0      1        1     0    3  500 Radio or TV or Hifi Lease
##                    PROF             CAR            CARDS GB _freq_ good TMJOB1_bin INCOME_bin PERS_H_bin               CARDS_bin
## 1064   Self-employed pe             Car Mastercard/Euroc  0     30    1   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39; 02 = &#39;Mastercard/Euroc&#39;
## 2376             Others             Car      Cheque card  1      1    0   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;
## 2861      Civil Service Without Vehicle  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;
## 2277   Military Service             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   02 = &#39;2&#39;  03 = &#39;no credit cards&#39;
## 2773             Others Without Vehicle  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;
## 387              Others             Car      Cheque card  0     30    1  02 &lt;= 144     02 &gt; 0   02 = &#39;2&#39;      01 = &#39;Cheque card&#39;
## 1108             Others             Car  no credit cards  0     30    1   01 &lt;= 30     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;
## 2363   Self-employed pe             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   02 = &#39;2&#39;  03 = &#39;no credit cards&#39;
## 1445   Food or Building             Car  no credit cards  0     30    1   01 &lt;= 30     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;
## 2680             Others             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;
## 1922             Others Without Vehicle      Cheque card  1      1    0  02 &lt;= 144    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;
## 2265             Others             Car      Cheque card  1      1    0   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;
## 596              Others             Car  no credit cards  0     30    1  02 &lt;= 144     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;
## 1381             Others             Car  no credit cards  0     30    1   01 &lt;= 30     02 &gt; 0   05 = &#39;5&#39;  03 = &#39;no credit cards&#39;
## 2204             Others Without Vehicle  no credit cards  1      1    0  02 &lt;= 144     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;
## 492              Others             Car      Cheque card  0     30    1  02 &lt;= 144    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;
## 1287             Others Without Vehicle      Cheque card  0     30    1   01 &lt;= 30     02 &gt; 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;
## 2161             Others             Car  no credit cards  1      1    0  02 &lt;= 144     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;
## 2427   Food or Building Without Vehicle  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;
## 854              Others Without Vehicle  no credit cards  0     30    1  02 &lt;= 144     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;
## 800  State or Steel Ind Without Vehicle  no credit cards  0     30    1  02 &lt;= 144     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;
## 577              Others             Car      Cheque card  0     30    1  02 &lt;= 144    01 &lt;= 0   03 = &#39;3&#39;      01 = &#39;Cheque card&#39;
## 1390   Food or Building             Car      Cheque card  0     30    1   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;
## 180              Others Without Vehicle  no credit cards  0     30    1   03 &gt; 144     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;
## 1563   Food or Building             Car  no credit cards  1      1    0   03 &gt; 144     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;
## 2706   Food or Building             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   05 = &#39;5&#39;  03 = &#39;no credit cards&#39;
##      EC_CARD_bin TMJOB1_WOE INCOME_WOE PERS_H_WOE CARDS_WOE EC_CARD_WOE      pred TMJOB1_points INCOME_points CARDS_points
## 1064    01 = &#39;0&#39;    -0.3991     0.6767    -0.5239    0.8075     -0.2313 0.3374844      57.36191      77.46943    146.09702
## 2376    02 = &#39;1&#39;    -0.3991     0.6767    -0.5239    0.6846      0.6846 0.3678084      57.36191      77.46943    136.51072
## 2861    01 = &#39;0&#39;    -0.3991    -0.2075    -0.5239   -0.2663     -0.2313 0.5949340      57.36191      84.84137     62.33974
## 2277    01 = &#39;0&#39;    -0.3991    -0.2075     0.4283   -0.2663     -0.2313 0.3992090      57.36191      84.84137     62.33974
## 2773    01 = &#39;0&#39;    -0.3991    -0.2075     0.3172   -0.2663     -0.2313 0.4215977      57.36191      84.84137     62.33974
## 387     02 = &#39;1&#39;     0.0533    -0.2075     0.4283    0.6846      0.6846 0.1368591      86.55021      84.84137    136.51072
## 1108    01 = &#39;0&#39;    -0.3991    -0.2075     0.2948   -0.2663     -0.2313 0.4261542      57.36191      84.84137     62.33974
## 2363    01 = &#39;0&#39;    -0.3991    -0.2075     0.4283   -0.2663     -0.2313 0.3992090      57.36191      84.84137     62.33974
## 1445    01 = &#39;0&#39;    -0.3991    -0.2075    -0.5239   -0.2663     -0.2313 0.5949340      57.36191      84.84137     62.33974
## 2680    01 = &#39;0&#39;    -0.3991    -0.2075     0.3172   -0.2663     -0.2313 0.4215977      57.36191      84.84137     62.33974
## 1922    02 = &#39;1&#39;     0.0533     0.6767    -0.5239    0.6846      0.6846 0.2796363      86.55021      77.46943    136.51072
## 2265    02 = &#39;1&#39;    -0.3991     0.6767    -0.5239    0.6846      0.6846 0.3678084      57.36191      77.46943    136.51072
## 596     01 = &#39;0&#39;     0.0533    -0.2075     0.2948   -0.2663     -0.2313 0.3313257      86.55021      84.84137     62.33974
## 1381    01 = &#39;0&#39;    -0.3991    -0.2075     0.0426   -0.2663     -0.2313 0.4781434      57.36191      84.84137     62.33974
## 2204    01 = &#39;0&#39;     0.0533    -0.2075    -0.5239   -0.2663     -0.2313 0.4949414      86.55021      84.84137     62.33974
## 492     02 = &#39;1&#39;     0.0533     0.6767    -0.5239    0.6846      0.6846 0.2796363      86.55021      77.46943    136.51072
## 1287    02 = &#39;1&#39;    -0.3991    -0.2075    -0.5239    0.6846      0.6846 0.3443819      57.36191      84.84137    136.51072
## 2161    01 = &#39;0&#39;     0.0533    -0.2075    -0.5239   -0.2663     -0.2313 0.4949414      86.55021      84.84137     62.33974
## 2427    01 = &#39;0&#39;    -0.3991    -0.2075     0.2948   -0.2663     -0.2313 0.4261542      57.36191      84.84137     62.33974
## 854     01 = &#39;0&#39;     0.0533    -0.2075     0.3172   -0.2663     -0.2313 0.3272050      86.55021      84.84137     62.33974
## 800     01 = &#39;0&#39;     0.0533    -0.2075    -0.5239   -0.2663     -0.2313 0.4949414      86.55021      84.84137     62.33974
## 577     02 = &#39;1&#39;     0.0533     0.6767     0.3172    0.6846      0.6846 0.1615304      86.55021      77.46943    136.51072
## 1390    02 = &#39;1&#39;    -0.3991     0.6767    -0.5239    0.6846      0.6846 0.3678084      57.36191      77.46943    136.51072
## 180     01 = &#39;0&#39;     0.9852    -0.2075     0.3172   -0.2663     -0.2313 0.1744569     146.67527      84.84137     62.33974
## 1563    01 = &#39;0&#39;     0.9852    -0.2075     0.2948   -0.2663     -0.2313 0.1771605     146.67527      84.84137     62.33974
## 2706    01 = &#39;0&#39;    -0.3991    -0.2075     0.0426   -0.2663     -0.2313 0.4781434      57.36191      84.84137     62.33974
##      PERS_H_points    Score
## 1064      51.63192 332.5603
## 2376      51.63192 322.9740
## 2861      51.63192 256.1750
## 2277     108.84651 313.3895
## 2773     102.17087 306.7139
## 387      108.84651 416.7488
## 1108     100.82493 305.3680
## 2363     108.84651 313.3895
## 1445      51.63192 256.1750
## 2680     102.17087 306.7139
## 1922      51.63192 352.1623
## 2265      51.63192 322.9740
## 596      100.82493 334.5563
## 1381      85.67105 290.2141
## 2204      51.63192 285.3632
## 492       51.63192 352.1623
## 1287      51.63192 330.3459
## 2161      51.63192 285.3632
## 2427     100.82493 305.3680
## 854      102.17087 335.9022
## 800       51.63192 285.3632
## 577      102.17087 402.7012
## 1390      51.63192 322.9740
## 180      102.17087 396.0273
## 1563     100.82493 394.6813
## 2706      85.67105 290.2141
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 2074 rows ]</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb143-1" tabindex="-1"></a>train_comb<span class="sc">$</span>pred <span class="ot">&lt;-</span> final_score<span class="sc">$</span>fitted.values</span>
<span id="cb143-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb143-2" tabindex="-1"></a></span>
<span id="cb143-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb143-3" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##   Overall Performance Metrics 
##   -------------------------------------------------- 
##                     KS : 0.3276 (Fair)
##                    AUC : 0.7154 (Fair)
## 
##   Classification Matrix 
##   -------------------------------------------------- 
##            Cutoff (&gt;=) : 0.0415 (Optimal)
##    True Positives (TP) : 1253
##   False Positives (FP) : 486
##   False Negatives (FN) : 560
##    True Negatives (TN) : 851
##    Total Positives (P) : 1813
##    Total Negatives (N) : 1337
## 
##   Business/Performance Metrics 
##   -------------------------------------------------- 
##       %Records&gt;=Cutoff : 0.5521
##              Good Rate : 0.7205 (Vs 0.5756 Overall)
##               Bad Rate : 0.2795 (Vs 0.4244 Overall)
##         Accuracy (ACC) : 0.6679
##      Sensitivity (TPR) : 0.6911
##  False Neg. Rate (FNR) : 0.3089
##  False Pos. Rate (FPR) : 0.3635
##      Specificity (TNR) : 0.6365
##        Precision (PPV) : 0.7205
##   False Discovery Rate : 0.2795
##     False Omision Rate : 0.3969
##   Inv. Precision (NPV) : 0.6031
## 
##   Note: 0 rows deleted due to missing data.</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb145-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;ks&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb146-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;auc&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-2.png" width="672" />
checking model on our combined test data</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_num)) {</span>
<span id="cb147-2"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-2" tabindex="-1"></a>  test_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> test_comb, <span class="at">ivout =</span> results_all_sig_comb_num[[i]], </span>
<span id="cb147-3"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-3" tabindex="-1"></a>                             <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb147-4"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-4" tabindex="-1"></a>}</span>
<span id="cb147-5"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-5" tabindex="-1"></a></span>
<span id="cb147-6"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_char)) {</span>
<span id="cb147-7"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-7" tabindex="-1"></a>  test_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> test_comb, <span class="at">ivout =</span> results_all_sig_comb_char[[i]], </span>
<span id="cb147-8"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-8" tabindex="-1"></a>                                    <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb147-9"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-9" tabindex="-1"></a>}</span>
<span id="cb147-10"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-10" tabindex="-1"></a></span>
<span id="cb147-11"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-11" tabindex="-1"></a></span>
<span id="cb147-12"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-12" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb)) {</span>
<span id="cb147-13"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-13" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(test_comb)) {</span>
<span id="cb147-14"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-14" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb147-15"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-15" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(test_comb[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb147-16"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-16" tabindex="-1"></a>    </span>
<span id="cb147-17"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-17" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb147-18"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-18" tabindex="-1"></a>    </span>
<span id="cb147-19"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-19" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb147-20"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-20" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig_comb[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb147-21"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-21" tabindex="-1"></a>      test_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb147-22"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-22" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb147-23"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-23" tabindex="-1"></a>      test_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb147-24"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-24" tabindex="-1"></a>    }</span>
<span id="cb147-25"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-25" tabindex="-1"></a>  }</span>
<span id="cb147-26"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-26" tabindex="-1"></a>}</span>
<span id="cb147-27"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-27" tabindex="-1"></a></span>
<span id="cb147-28"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-28" tabindex="-1"></a>test_comb<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_score, <span class="at">newdata=</span>test_comb, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span>
<span id="cb147-29"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-29" tabindex="-1"></a></span>
<span id="cb147-30"><a href="reject-inference---clean-prepare-reject-data-1.html#cb147-30" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##   Overall Performance Metrics 
##   -------------------------------------------------- 
##                     KS : 0.3180 (Fair)
##                    AUC : 0.7187 (Fair)
## 
##   Classification Matrix 
##   -------------------------------------------------- 
##            Cutoff (&gt;=) : 0.0461 (Optimal)
##    True Positives (TP) : 417
##   False Positives (FP) : 170
##   False Negatives (FN) : 296
##    True Negatives (TN) : 467
##    Total Positives (P) : 713
##    Total Negatives (N) : 637
## 
##   Business/Performance Metrics 
##   -------------------------------------------------- 
##       %Records&gt;=Cutoff : 0.4348
##              Good Rate : 0.7104 (Vs 0.5281 Overall)
##               Bad Rate : 0.2896 (Vs 0.4719 Overall)
##         Accuracy (ACC) : 0.6548
##      Sensitivity (TPR) : 0.5849
##  False Neg. Rate (FNR) : 0.4151
##  False Pos. Rate (FPR) : 0.2669
##      Specificity (TNR) : 0.7331
##        Precision (PPV) : 0.7104
##   False Discovery Rate : 0.2896
##     False Omision Rate : 0.3879
##   Inv. Precision (NPV) : 0.6121
## 
##   Note: 0 rows deleted due to missing data.</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb149-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;ks&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="reject-inference---clean-prepare-reject-data-1.html#cb150-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;auc&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reject-inference---clean-prepare-reject-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="add-scores-to-train-comb-from-final-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aidan-miller/Arsenal/edit/main/02-tears.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/aidan-miller/Arsenal/blob/main/02-tears.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>

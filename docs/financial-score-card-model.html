<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Financial Score Card Model | Arsenal Repository</title>
  <meta name="description" content="Chapter 2 Financial Score Card Model | Arsenal Repository" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Financial Score Card Model | Arsenal Repository" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Financial Score Card Model | Arsenal Repository" />
  
  
  

<meta name="author" content="Aidan Miller" />


<meta name="date" content="2023-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="future-projects.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Arsenal Repo</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro to the Arsenal Repository</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#chapter-2--project-intro"><i class="fa fa-check"></i><b>1.2</b> Chapter 2- Project Intro</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html"><i class="fa fa-check"></i><b>2</b> Financial Score Card Model</a>
<ul>
<li class="chapter" data-level="2.1" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#data-preprocessing"><i class="fa fa-check"></i><b>2.1</b> Data Preprocessing</a></li>
<li class="chapter" data-level="2.2" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#initial-model-build"><i class="fa fa-check"></i><b>2.2</b> Initial Model Build</a></li>
<li class="chapter" data-level="2.3" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#reject-inference---clean-prepare-reject-data"><i class="fa fa-check"></i><b>2.3</b> Reject Inference - Clean &amp; Prepare Reject Data</a></li>
<li class="chapter" data-level="2.4" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#data-prep-for-final-model"><i class="fa fa-check"></i><b>2.4</b> Data Prep For Final Model</a></li>
<li class="chapter" data-level="2.5" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#building-model-on-combined-data"><i class="fa fa-check"></i><b>2.5</b> Building Model On Combined Data</a></li>
<li class="chapter" data-level="2.6" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#adding-scores-to-train-comb-from-final-model"><i class="fa fa-check"></i><b>2.6</b> Adding Scores to Train Comb from Final Model</a></li>
<li class="chapter" data-level="2.7" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#add-scores-to-test-comb-from-final-model"><i class="fa fa-check"></i><b>2.7</b> Add Scores to Test Comb from Final Model</a></li>
<li class="chapter" data-level="2.8" data-path="financial-score-card-model.html"><a href="financial-score-card-model.html#plots"><i class="fa fa-check"></i><b>2.8</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="future-projects.html"><a href="future-projects.html"><i class="fa fa-check"></i><b>3</b> Future Projects</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Arsenal Repository</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="financial-score-card-model" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Financial Score Card Model<a href="financial-score-card-model.html#financial-score-card-model" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="data-preprocessing" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Data Preprocessing<a href="financial-score-card-model.html#data-preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Loading in Packages</p>
<p>Reading in Data</p>
<p>Preview Data</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="financial-score-card-model.html#cb1-1" tabindex="-1"></a><span class="fu">head</span>(accepted)</span></code></pre></div>
<pre><code>##   CHILDREN PERS_H AGE TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN DIV CASH             PRODUCT RESID    NAT
## 1        0      2  51     3    999   2       0       0   1000       1      1        1     2    2   1 1300 Furniture or Carpet Lease German
## 2        1      2  55    60    999   2       2       0   2900       0      1        1     1    2   1  900 Furniture or Carpet Owner German
## 3        0      1  50    72    999   2       2       0   2300       0      1        1     1    0   0 1100 Radio or TV or Hifi Lease German
## 4        0      2  56    96    999   2       2       1   4000       0      3        1     0    0   0 7000 Furniture or Carpet Lease German
## 5        0      1  52   120    999   2       0       0      0       1      1        1     1    0   0 1200 Furniture or Carpet Lease German
## 6        0      1  63   144    999   2       2       1   2200       0      3        1     0    4   1 4000 Furniture or Carpet Lease German
##            PROF             CAR           CARDS GB _freq_
## 1        Others             Car     Cheque card  0     30
## 2        Others             Car no credit cards  0     30
## 3        Others Without Vehicle no credit cards  0     30
## 4 Civil Service             Car no credit cards  0     30
## 5        Others             Car     Cheque card  0     30
## 6     Pensioner Without Vehicle no credit cards  0     30</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="financial-score-card-model.html#cb3-1" tabindex="-1"></a><span class="fu">head</span>(rejected)</span></code></pre></div>
<pre><code>##   CHILDREN PERS_H AGE TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN DIV CASH          PRODUCT RESID          NAT
## 1        0      1  24     6     18   1       0       0      0       1      3        1     0    0   0  500 Dept. Store,Mail Lease East Germany
## 2        1      2  35    84     54   1       0       0   2500       0      2        1     0    3   1 1700 Furniture,Carpet Lease East Germany
## 3        1      3  26    36    108   2       0       1   2600       0      1        1     2    0   0  900  Radio, TV, Hifi Owner East Germany
## 4        2      3  35   168     15   1       0       0   1600       0      3        1     0    0   0 1200  Radio, TV, Hifi  &lt;NA&gt; East Germany
## 5        0      1  20   240      9   2       0       0      0       1      3        1     0    0   0 4000 Furniture,Carpet Lease East Germany
## 6        2      4  29    30      9   2       2       0   1700       0      3        1     0    0   0 2000  Radio, TV, Hifi Lease East Germany
##               PROF             CAR           CARDS
## 1           Others             Car     Cheque card
## 2 Food,Building,Ca Without Vehicle no credit cards
## 3           Others             Car no credit cards
## 4           Others Without Vehicle no credit cards
## 5           Others Without Vehicle     Cheque card
## 6           Others Without Vehicle no credit cards</code></pre>
<p>Looking at Accepts Data Closer</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="financial-score-card-model.html#cb5-1" tabindex="-1"></a><span class="co">#GB is our target var 0 is good and 1 is bad</span></span>
<span id="cb5-2"><a href="financial-score-card-model.html#cb5-2" tabindex="-1"></a><span class="fu">str</span>(accepted)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    3000 obs. of  24 variables:
##  $ CHILDREN: num  0 1 0 0 0 0 0 2 0 1 ...
##  $ PERS_H  : num  2 2 1 2 1 1 2 4 2 3 ...
##  $ AGE     : num  51 55 50 56 52 63 47 51 51 54 ...
##  $ TMADD   : num  3 60 72 96 120 144 168 168 168 168 ...
##  $ TMJOB1  : num  999 999 999 999 999 999 999 999 999 999 ...
##  $ TEL     : num  2 2 2 2 2 2 2 2 2 2 ...
##  $ NMBLOAN : num  0 2 2 2 0 2 0 0 0 0 ...
##  $ FINLOAN : num  0 0 0 1 0 1 0 1 0 0 ...
##  $ INCOME  : num  1000 2900 2300 4000 0 2200 0 5000 2800 0 ...
##  $ EC_CARD : num  1 0 0 0 1 0 0 0 0 1 ...
##  $ BUREAU  : num  1 1 1 3 1 3 1 1 3 1 ...
##  $ LOCATION: num  1 1 1 1 1 1 1 1 1 1 ...
##  $ LOANS   : num  2 1 1 0 1 0 1 1 0 3 ...
##  $ REGN    : num  2 2 0 0 0 4 0 3 4 5 ...
##  $ DIV     : num  1 1 0 0 0 1 0 1 1 1 ...
##  $ CASH    : num  1300 900 1100 7000 1200 4000 1900 5000 6000 4000 ...
##  $ PRODUCT : chr  &quot;Furniture or Carpet&quot; &quot;Furniture or Carpet&quot; &quot;Radio or TV or Hifi&quot; &quot;Furniture or Carpet&quot; ...
##  $ RESID   : chr  &quot;Lease&quot; &quot;Owner&quot; &quot;Lease&quot; &quot;Lease&quot; ...
##  $ NAT     : chr  &quot;German&quot; &quot;German&quot; &quot;German&quot; &quot;German&quot; ...
##  $ PROF    : chr  &quot;Others&quot; &quot;Others&quot; &quot;Others&quot; &quot;Civil Service&quot; ...
##  $ CAR     : chr  &quot;Car&quot; &quot;Car&quot; &quot;Without Vehicle&quot; &quot;Car&quot; ...
##  $ CARDS   : chr  &quot;Cheque card&quot; &quot;no credit cards&quot; &quot;no credit cards&quot; &quot;no credit cards&quot; ...
##  $ GB      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ _freq_  : num  30 30 30 30 30 30 30 30 30 30 ...</code></pre>
<p>Removing Vars That should not be taken into consideration when dealing with loans</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="financial-score-card-model.html#cb7-1" tabindex="-1"></a>accepts<span class="ot">=</span> accepted <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="financial-score-card-model.html#cb7-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>AGE, <span class="sc">-</span>DIV, <span class="sc">-</span>NAT) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="financial-score-card-model.html#cb7-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">good=</span> <span class="fu">ifelse</span>(GB<span class="sc">==</span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb7-4"><a href="financial-score-card-model.html#cb7-4" tabindex="-1"></a>         <span class="at">PERS_H=</span> <span class="fu">ifelse</span>(PERS_H<span class="sc">&gt;=</span><span class="dv">7</span>, <span class="st">&#39;7+&#39;</span>, PERS_H),</span>
<span id="cb7-5"><a href="financial-score-card-model.html#cb7-5" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;VISA mybank&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS),</span>
<span id="cb7-6"><a href="financial-score-card-model.html#cb7-6" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;VISA Others&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS),</span>
<span id="cb7-7"><a href="financial-score-card-model.html#cb7-7" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;American Express&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS),</span>
<span id="cb7-8"><a href="financial-score-card-model.html#cb7-8" tabindex="-1"></a>         <span class="at">GB=</span><span class="fu">ifelse</span>(GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="financial-score-card-model.html#cb8-1" tabindex="-1"></a>accepts <span class="sc">%&gt;%</span> <span class="fu">summarise_all</span>(n_distinct)</span></code></pre></div>
<pre><code>##   CHILDREN PERS_H TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN CASH PRODUCT RESID PROF CAR CARDS GB _freq_ good
## 1        9      7    32     33   3       3       2     27       2      3        2     9    9   29       7     3   10   3     4  2      2    2</code></pre>
<p>Getting all the Factor Variables from the accepts dataset</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="financial-score-card-model.html#cb10-1" tabindex="-1"></a>factor_vars<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb10-2"><a href="financial-score-card-model.html#cb10-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(accepts))){</span>
<span id="cb10-3"><a href="financial-score-card-model.html#cb10-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">colnames</span>(accepts)[i] <span class="sc">==</span> <span class="st">&#39;good&#39;</span>){</span>
<span id="cb10-4"><a href="financial-score-card-model.html#cb10-4" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb10-5"><a href="financial-score-card-model.html#cb10-5" tabindex="-1"></a>  }</span>
<span id="cb10-6"><a href="financial-score-card-model.html#cb10-6" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(accepts[,i]))<span class="sc">&lt;</span><span class="dv">15</span>){</span>
<span id="cb10-7"><a href="financial-score-card-model.html#cb10-7" tabindex="-1"></a>    factor_vars<span class="ot">=</span><span class="fu">append</span>(factor_vars,<span class="fu">colnames</span>(accepts[i]))</span>
<span id="cb10-8"><a href="financial-score-card-model.html#cb10-8" tabindex="-1"></a>  }</span>
<span id="cb10-9"><a href="financial-score-card-model.html#cb10-9" tabindex="-1"></a>}</span>
<span id="cb10-10"><a href="financial-score-card-model.html#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="financial-score-card-model.html#cb10-11" tabindex="-1"></a>factor_vars</span></code></pre></div>
<pre><code>##  [1] &quot;CHILDREN&quot; &quot;PERS_H&quot;   &quot;TEL&quot;      &quot;NMBLOAN&quot;  &quot;FINLOAN&quot;  &quot;EC_CARD&quot;  &quot;BUREAU&quot;   &quot;LOCATION&quot; &quot;LOANS&quot;    &quot;REGN&quot;     &quot;PRODUCT&quot;  &quot;RESID&quot;   
## [13] &quot;PROF&quot;     &quot;CAR&quot;      &quot;CARDS&quot;    &quot;GB&quot;       &quot;_freq_&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="financial-score-card-model.html#cb12-1" tabindex="-1"></a>accepts[,factor_vars] <span class="ot">=</span> <span class="fu">lapply</span>(accepts[,factor_vars] , factor)</span>
<span id="cb12-2"><a href="financial-score-card-model.html#cb12-2" tabindex="-1"></a><span class="co">#str(accepts)</span></span>
<span id="cb12-3"><a href="financial-score-card-model.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="financial-score-card-model.html#cb12-4" tabindex="-1"></a><span class="co">#      OR        #</span></span>
<span id="cb12-5"><a href="financial-score-card-model.html#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="financial-score-card-model.html#cb12-6" tabindex="-1"></a><span class="co">#for (i in (1:ncol(accepts))){</span></span>
<span id="cb12-7"><a href="financial-score-card-model.html#cb12-7" tabindex="-1"></a>  <span class="co">#if (colnames(accepts)[i] == &#39;good&#39;){</span></span>
<span id="cb12-8"><a href="financial-score-card-model.html#cb12-8" tabindex="-1"></a>    <span class="co">#break</span></span>
<span id="cb12-9"><a href="financial-score-card-model.html#cb12-9" tabindex="-1"></a>  <span class="co">#}</span></span>
<span id="cb12-10"><a href="financial-score-card-model.html#cb12-10" tabindex="-1"></a>  <span class="co">#if (length(unique(accepts[,i]))&lt;15){</span></span>
<span id="cb12-11"><a href="financial-score-card-model.html#cb12-11" tabindex="-1"></a>    <span class="co">#accepts[,i]=as.factor(accepts[,i])</span></span>
<span id="cb12-12"><a href="financial-score-card-model.html#cb12-12" tabindex="-1"></a>  <span class="co">#}</span></span>
<span id="cb12-13"><a href="financial-score-card-model.html#cb12-13" tabindex="-1"></a><span class="co">#}</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="financial-score-card-model.html#cb13-1" tabindex="-1"></a>accepts<span class="sc">$</span>good<span class="ot">=</span> <span class="fu">as.numeric</span>(accepts<span class="sc">$</span>good)</span>
<span id="cb13-2"><a href="financial-score-card-model.html#cb13-2" tabindex="-1"></a><span class="fu">table</span>(accepted<span class="sc">$</span>GB)</span></code></pre></div>
<pre><code>## 
##    0    1 
## 1500 1500</code></pre>
<p>Creating Train Test Population</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="financial-score-card-model.html#cb15-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0119</span>)</span>
<span id="cb15-2"><a href="financial-score-card-model.html#cb15-2" tabindex="-1"></a>train_id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(accepts)), <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.70</span><span class="sc">*</span><span class="fu">nrow</span>(accepts)))</span>
<span id="cb15-3"><a href="financial-score-card-model.html#cb15-3" tabindex="-1"></a>train <span class="ot">&lt;-</span> accepts[train_id, ]</span>
<span id="cb15-4"><a href="financial-score-card-model.html#cb15-4" tabindex="-1"></a>test <span class="ot">&lt;-</span> accepts[<span class="sc">-</span>train_id, ]</span>
<span id="cb15-5"><a href="financial-score-card-model.html#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="financial-score-card-model.html#cb15-6" tabindex="-1"></a><span class="fu">table</span>(train<span class="sc">$</span>good)</span></code></pre></div>
<pre><code>## 
##    0    1 
## 1060 1040</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="financial-score-card-model.html#cb17-1" tabindex="-1"></a><span class="fu">table</span>(test<span class="sc">$</span>good)</span></code></pre></div>
<pre><code>## 
##   0   1 
## 440 460</code></pre>
<p>Selecting + Binning Just the Important Vars</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="financial-score-card-model.html#cb19-1" tabindex="-1"></a><span class="co">#Selecting only important vars</span></span>
<span id="cb19-2"><a href="financial-score-card-model.html#cb19-2" tabindex="-1"></a>iv_summary <span class="ot">&lt;-</span> <span class="fu">smbinning.sumiv</span>(<span class="at">df =</span> train, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>)</span></code></pre></div>
<pre><code>##  
## 
  |                                                        
  |                                                  |   0%
  |                                                        
  |--                                                |   5%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----                                             |   9%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------                                           |  14%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------                                         |  18%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------                                       |  23%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |--------------                                    |  27%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |----------------                                  |  32%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------                                |  36%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |--------------------                              |  41%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------------------                           |  45%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------------------------                         |  50%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------------------------                       |  55%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------------------                    |  59%
  |                                                        
  |--------------------------------                  |  64%
  |                                                        
  |----------------------------------                |  68%
  |                                                        
  |------------------------------------              |  73%
  |                                                        
  |---------------------------------------           |  77%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------------------------------------         |  82%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------------------------------------------       |  86%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------------------------------------------     |  91%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------------------------------------  |  95%
  |                                                        
  |--------------------------------------------------| 100%
## </code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="financial-score-card-model.html#cb53-1" tabindex="-1"></a>iv_summary<span class="ot">=</span> <span class="fu">na.omit</span>(iv_summary)</span>
<span id="cb53-2"><a href="financial-score-card-model.html#cb53-2" tabindex="-1"></a><span class="fu">smbinning.sumiv.plot</span>(iv_summary)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="financial-score-card-model.html#cb54-1" tabindex="-1"></a>iv_summary</span></code></pre></div>
<pre><code>##        Char     IV            Process
## 4    TMJOB1 0.1993 Numeric binning OK
## 2    PERS_H 0.1845  Factor binning OK
## 19    CARDS 0.1812  Factor binning OK
## 9   EC_CARD 0.1563  Factor binning OK
## 8    INCOME 0.1388 Numeric binning OK
## 1  CHILDREN 0.0700  Factor binning OK
## 5       TEL 0.0692  Factor binning OK
## 17     PROF 0.0645  Factor binning OK
## 6   NMBLOAN 0.0542  Factor binning OK
## 18      CAR 0.0367  Factor binning OK
## 3     TMADD 0.0305 Numeric binning OK
## 7   FINLOAN 0.0298  Factor binning OK
## 15  PRODUCT 0.0199  Factor binning OK
## 13     REGN 0.0192  Factor binning OK
## 12    LOANS 0.0168  Factor binning OK
## 10   BUREAU 0.0041  Factor binning OK
## 16    RESID 0.0032  Factor binning OK
## 11 LOCATION 0.0006  Factor binning OK
## 20       GB 0.0000  Factor binning OK
## 21   _freq_ 0.0000  Factor binning OK</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="financial-score-card-model.html#cb56-1" tabindex="-1"></a>imp_vars<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb56-2"><a href="financial-score-card-model.html#cb56-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(iv_summary<span class="sc">$</span>Char)){</span>
<span id="cb56-3"><a href="financial-score-card-model.html#cb56-3" tabindex="-1"></a>  <span class="cf">if</span> (iv_summary<span class="sc">$</span>IV[i]<span class="sc">&gt;=</span>.<span class="dv">10</span>){</span>
<span id="cb56-4"><a href="financial-score-card-model.html#cb56-4" tabindex="-1"></a>    imp_vars<span class="ot">=</span><span class="fu">append</span>(imp_vars, iv_summary<span class="sc">$</span>Char[i])</span>
<span id="cb56-5"><a href="financial-score-card-model.html#cb56-5" tabindex="-1"></a>  }</span>
<span id="cb56-6"><a href="financial-score-card-model.html#cb56-6" tabindex="-1"></a>}</span>
<span id="cb56-7"><a href="financial-score-card-model.html#cb56-7" tabindex="-1"></a></span>
<span id="cb56-8"><a href="financial-score-card-model.html#cb56-8" tabindex="-1"></a><span class="co">#just using train 0 to just get the important vars names  </span></span>
<span id="cb56-9"><a href="financial-score-card-model.html#cb56-9" tabindex="-1"></a>train0<span class="ot">=</span>train[,<span class="fu">c</span>(imp_vars)]</span>
<span id="cb56-10"><a href="financial-score-card-model.html#cb56-10" tabindex="-1"></a></span>
<span id="cb56-11"><a href="financial-score-card-model.html#cb56-11" tabindex="-1"></a><span class="co">#Binning Just the Important Vars</span></span>
<span id="cb56-12"><a href="financial-score-card-model.html#cb56-12" tabindex="-1"></a></span>
<span id="cb56-13"><a href="financial-score-card-model.html#cb56-13" tabindex="-1"></a>num_names0 <span class="ot">=</span> <span class="fu">names</span>(train0)[<span class="fu">sapply</span>(train0, is.numeric)] <span class="co"># Gathering the names of numeric variables in data #</span></span>
<span id="cb56-14"><a href="financial-score-card-model.html#cb56-14" tabindex="-1"></a>num_names0<span class="ot">=</span>num_names0[num_names0 <span class="sc">!=</span> <span class="st">&quot;good&quot;</span>]</span>
<span id="cb56-15"><a href="financial-score-card-model.html#cb56-15" tabindex="-1"></a></span>
<span id="cb56-16"><a href="financial-score-card-model.html#cb56-16" tabindex="-1"></a>results_all_sig_num <span class="ot">=</span> <span class="fu">list</span>() <span class="co"># Creating empty list to store all results #</span></span>
<span id="cb56-17"><a href="financial-score-card-model.html#cb56-17" tabindex="-1"></a>results_all_sig_char <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb56-18"><a href="financial-score-card-model.html#cb56-18" tabindex="-1"></a><span class="co">#iv_summary &lt;- smbinning.sumiv(df = train0, y = &quot;good&quot;)</span></span>
<span id="cb56-19"><a href="financial-score-card-model.html#cb56-19" tabindex="-1"></a><span class="co">#iv_summary= na.omit(iv_summary)</span></span>
<span id="cb56-20"><a href="financial-score-card-model.html#cb56-20" tabindex="-1"></a></span>
<span id="cb56-21"><a href="financial-score-card-model.html#cb56-21" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(num_names0)){</span>
<span id="cb56-22"><a href="financial-score-card-model.html#cb56-22" tabindex="-1"></a>  results_all_sig_num[[num_names0[i]]] <span class="ot">&lt;-</span> <span class="fu">smbinning</span>(<span class="at">df =</span> train, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>, <span class="at">x =</span> num_names0[i])</span>
<span id="cb56-23"><a href="financial-score-card-model.html#cb56-23" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="financial-score-card-model.html#cb58-1" tabindex="-1"></a>char_names0 <span class="ot">=</span><span class="fu">names</span>(train0)[<span class="fu">sapply</span>(train0, is.factor)]</span>
<span id="cb58-2"><a href="financial-score-card-model.html#cb58-2" tabindex="-1"></a>char_names0<span class="ot">=</span>char_names0[char_names0 <span class="sc">!=</span> <span class="st">&quot;GB&quot;</span>]</span>
<span id="cb58-3"><a href="financial-score-card-model.html#cb58-3" tabindex="-1"></a>char_names0<span class="ot">=</span>char_names0[char_names0 <span class="sc">!=</span> <span class="st">&quot;_freq_&quot;</span>]</span>
<span id="cb58-4"><a href="financial-score-card-model.html#cb58-4" tabindex="-1"></a></span>
<span id="cb58-5"><a href="financial-score-card-model.html#cb58-5" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(char_names0)){</span>
<span id="cb58-6"><a href="financial-score-card-model.html#cb58-6" tabindex="-1"></a>  results_all_sig_char[[char_names0[i]]] <span class="ot">&lt;-</span> <span class="fu">smbinning.factor</span>(<span class="at">df =</span> train, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>, <span class="at">x =</span> char_names0[i])</span>
<span id="cb58-7"><a href="financial-score-card-model.html#cb58-7" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<p>Generating Variables of Bins and WOE Values</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="financial-score-card-model.html#cb60-1" tabindex="-1"></a><span class="co"># Generating Variables of Bins #</span></span>
<span id="cb60-2"><a href="financial-score-card-model.html#cb60-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_num)) {</span>
<span id="cb60-3"><a href="financial-score-card-model.html#cb60-3" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> train, <span class="at">ivout =</span> results_all_sig_num[[i]], <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb60-4"><a href="financial-score-card-model.html#cb60-4" tabindex="-1"></a>}</span>
<span id="cb60-5"><a href="financial-score-card-model.html#cb60-5" tabindex="-1"></a></span>
<span id="cb60-6"><a href="financial-score-card-model.html#cb60-6" tabindex="-1"></a></span>
<span id="cb60-7"><a href="financial-score-card-model.html#cb60-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_char)) {</span>
<span id="cb60-8"><a href="financial-score-card-model.html#cb60-8" tabindex="-1"></a>  train <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> train, <span class="at">ivout =</span> results_all_sig_char[[i]], <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb60-9"><a href="financial-score-card-model.html#cb60-9" tabindex="-1"></a>}</span>
<span id="cb60-10"><a href="financial-score-card-model.html#cb60-10" tabindex="-1"></a></span>
<span id="cb60-11"><a href="financial-score-card-model.html#cb60-11" tabindex="-1"></a><span class="co"># Generating Variables WOE Values from Bins just created #</span></span>
<span id="cb60-12"><a href="financial-score-card-model.html#cb60-12" tabindex="-1"></a></span>
<span id="cb60-13"><a href="financial-score-card-model.html#cb60-13" tabindex="-1"></a>results_all_sig<span class="ot">=</span><span class="fu">append</span>(results_all_sig_num,results_all_sig_char)</span>
<span id="cb60-14"><a href="financial-score-card-model.html#cb60-14" tabindex="-1"></a></span>
<span id="cb60-15"><a href="financial-score-card-model.html#cb60-15" tabindex="-1"></a></span>
<span id="cb60-16"><a href="financial-score-card-model.html#cb60-16" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig)) {</span>
<span id="cb60-17"><a href="financial-score-card-model.html#cb60-17" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(train)) {</span>
<span id="cb60-18"><a href="financial-score-card-model.html#cb60-18" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb60-19"><a href="financial-score-card-model.html#cb60-19" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(train[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb60-20"><a href="financial-score-card-model.html#cb60-20" tabindex="-1"></a></span>
<span id="cb60-21"><a href="financial-score-card-model.html#cb60-21" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb60-22"><a href="financial-score-card-model.html#cb60-22" tabindex="-1"></a>    </span>
<span id="cb60-23"><a href="financial-score-card-model.html#cb60-23" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb60-24"><a href="financial-score-card-model.html#cb60-24" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb60-25"><a href="financial-score-card-model.html#cb60-25" tabindex="-1"></a>      train[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb60-26"><a href="financial-score-card-model.html#cb60-26" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb60-27"><a href="financial-score-card-model.html#cb60-27" tabindex="-1"></a>      train[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb60-28"><a href="financial-score-card-model.html#cb60-28" tabindex="-1"></a>    }</span>
<span id="cb60-29"><a href="financial-score-card-model.html#cb60-29" tabindex="-1"></a>  }</span>
<span id="cb60-30"><a href="financial-score-card-model.html#cb60-30" tabindex="-1"></a>}</span></code></pre></div>
<p>Finding Out Which Vars Had Quasi Complete and then Making Sure None has INF in IV WOE</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="financial-score-card-model.html#cb61-1" tabindex="-1"></a><span class="fu">CrossTable</span>(train<span class="sc">$</span>PERS_H, train<span class="sc">$</span>good)</span></code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## | Chi-square contribution |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  2100 
## 
##  
##              | train$good 
## train$PERS_H |         0 |         1 | Row Total | 
## -------------|-----------|-----------|-----------|
##            1 |       506 |       294 |       800 | 
##              |    25.861 |    26.358 |           | 
##              |     0.632 |     0.367 |     0.381 | 
##              |     0.477 |     0.283 |           | 
##              |     0.241 |     0.140 |           | 
## -------------|-----------|-----------|-----------|
##            2 |       176 |       265 |       441 | 
##              |     9.755 |     9.943 |           | 
##              |     0.399 |     0.601 |     0.210 | 
##              |     0.166 |     0.255 |           | 
##              |     0.084 |     0.126 |           | 
## -------------|-----------|-----------|-----------|
##            3 |       167 |       225 |       392 | 
##              |     4.815 |     4.908 |           | 
##              |     0.426 |     0.574 |     0.187 | 
##              |     0.158 |     0.216 |           | 
##              |     0.080 |     0.107 |           | 
## -------------|-----------|-----------|-----------|
##            4 |       148 |       195 |       343 | 
##              |     3.649 |     3.719 |           | 
##              |     0.431 |     0.569 |     0.163 | 
##              |     0.140 |     0.188 |           | 
##              |     0.070 |     0.093 |           | 
## -------------|-----------|-----------|-----------|
##            5 |        42 |        43 |        85 | 
##              |     0.019 |     0.019 |           | 
##              |     0.494 |     0.506 |     0.040 | 
##              |     0.040 |     0.041 |           | 
##              |     0.020 |     0.020 |           | 
## -------------|-----------|-----------|-----------|
##            6 |        17 |         8 |        25 | 
##              |     1.521 |     1.550 |           | 
##              |     0.680 |     0.320 |     0.012 | 
##              |     0.016 |     0.008 |           | 
##              |     0.008 |     0.004 |           | 
## -------------|-----------|-----------|-----------|
##           7+ |         4 |        10 |        14 | 
##              |     1.331 |     1.356 |           | 
##              |     0.286 |     0.714 |     0.007 | 
##              |     0.004 |     0.010 |           | 
##              |     0.002 |     0.005 |           | 
## -------------|-----------|-----------|-----------|
## Column Total |      1060 |      1040 |      2100 | 
##              |     0.505 |     0.495 |           | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="financial-score-card-model.html#cb63-1" tabindex="-1"></a>results_all_sig[[<span class="st">&quot;PERS_H&quot;</span>]][[<span class="st">&quot;ivtable&quot;</span>]]</span></code></pre></div>
<pre><code>##   Cutpoint CntRec CntGood CntBad CntCumRec CntCumGood CntCumBad PctRec GoodRate BadRate   Odds  LnOdds     WoE     IV
## 1    = &#39;1&#39;    800     294    506       800        294       506 0.3810   0.3675  0.6325 0.5810 -0.5430 -0.5239 0.1020
## 2    = &#39;2&#39;    441     265    176      1241        559       682 0.2100   0.6009  0.3991 1.5057  0.4092  0.4283 0.0380
## 3    = &#39;3&#39;    392     225    167      1633        784       849 0.1867   0.5740  0.4260 1.3473  0.2981  0.3172 0.0187
## 4    = &#39;4&#39;    343     195    148      1976        979       997 0.1633   0.5685  0.4315 1.3176  0.2758  0.2948 0.0141
## 5    = &#39;5&#39;     85      43     42      2061       1022      1039 0.0405   0.5059  0.4941 1.0238  0.0235  0.0426 0.0001
## 6    = &#39;6&#39;     25       8     17      2086       1030      1056 0.0119   0.3200  0.6800 0.4706 -0.7538 -0.7347 0.0061
## 7   = &#39;7+&#39;     14      10      4      2100       1040      1060 0.0067   0.7143  0.2857 2.5000  0.9163  0.9353 0.0055
## 8  Missing      0       0      0      2100       1040      1060 0.0000      NaN     NaN    NaN     NaN     NaN    NaN
## 9    Total   2100    1040   1060        NA         NA        NA 1.0000   0.4952  0.5048 0.9811 -0.0190  0.0000 0.1845</code></pre>
</div>
<div id="initial-model-build" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Initial Model Build<a href="financial-score-card-model.html#initial-model-build" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Building Initial Scorecard Model</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="financial-score-card-model.html#cb65-1" tabindex="-1"></a><span class="co">#need to fix gb var in test</span></span>
<span id="cb65-2"><a href="financial-score-card-model.html#cb65-2" tabindex="-1"></a>test<span class="sc">$</span>GB<span class="ot">=</span><span class="fu">ifelse</span>(test<span class="sc">$</span>GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb65-3"><a href="financial-score-card-model.html#cb65-3" tabindex="-1"></a>train<span class="sc">$</span>GB<span class="ot">=</span><span class="fu">ifelse</span>(train<span class="sc">$</span>GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb65-4"><a href="financial-score-card-model.html#cb65-4" tabindex="-1"></a>initial_score <span class="ot">&lt;-</span> <span class="fu">glm</span>(GB <span class="sc">~</span> </span>
<span id="cb65-5"><a href="financial-score-card-model.html#cb65-5" tabindex="-1"></a>                       TMJOB1_WOE <span class="sc">+</span> </span>
<span id="cb65-6"><a href="financial-score-card-model.html#cb65-6" tabindex="-1"></a>                       INCOME_WOE <span class="sc">+</span></span>
<span id="cb65-7"><a href="financial-score-card-model.html#cb65-7" tabindex="-1"></a>                       CARDS_WOE <span class="sc">+</span> <span class="co">#quasi complete seperation issue with this var</span></span>
<span id="cb65-8"><a href="financial-score-card-model.html#cb65-8" tabindex="-1"></a>                       PERS_H_WOE, <span class="co">#quasi complete seperation issue with this var</span></span>
<span id="cb65-9"><a href="financial-score-card-model.html#cb65-9" tabindex="-1"></a>                       <span class="co">#EC_CARD_WOE, dogwater predictor</span></span>
<span id="cb65-10"><a href="financial-score-card-model.html#cb65-10" tabindex="-1"></a>                     <span class="at">data =</span> train,</span>
<span id="cb65-11"><a href="financial-score-card-model.html#cb65-11" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="fu">as.numeric</span>(train<span class="sc">$</span><span class="st">`</span><span class="at">_freq_</span><span class="st">`</span>), </span>
<span id="cb65-12"><a href="financial-score-card-model.html#cb65-12" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb65-13"><a href="financial-score-card-model.html#cb65-13" tabindex="-1"></a></span>
<span id="cb65-14"><a href="financial-score-card-model.html#cb65-14" tabindex="-1"></a><span class="fu">summary</span>(initial_score)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = GB ~ TMJOB1_WOE + INCOME_WOE + CARDS_WOE + PERS_H_WOE, 
##     family = &quot;binomial&quot;, data = train, weights = as.numeric(train$`_freq_`))
## 
## Coefficients:
##             Estimate Std. Error z value             Pr(&gt;|z|)    
## (Intercept) -0.67293    0.04019 -16.745 &lt; 0.0000000000000002 ***
## TMJOB1_WOE  -0.89442    0.09564  -9.352 &lt; 0.0000000000000002 ***
## INCOME_WOE   0.11558    0.25362   0.456                0.649    
## CARDS_WOE   -1.08132    0.22153  -4.881           0.00000106 ***
## PERS_H_WOE  -0.83298    0.09204  -9.050 &lt; 0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 4015.5  on 2099  degrees of freedom
## Residual deviance: 3677.2  on 2095  degrees of freedom
## AIC: 3687.2
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Evaluate the Initial Model - Training Data</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="financial-score-card-model.html#cb67-1" tabindex="-1"></a>train<span class="sc">$</span>pred <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>fitted.values</span>
<span id="cb67-2"><a href="financial-score-card-model.html#cb67-2" tabindex="-1"></a></span>
<span id="cb67-3"><a href="financial-score-card-model.html#cb67-3" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##   Overall Performance Metrics 
##   -------------------------------------------------- 
##                     KS : 0.2997 (Unpredictive)
##                    AUC : 0.6954 (Poor)
## 
##   Classification Matrix 
##   -------------------------------------------------- 
##            Cutoff (&gt;=) : 0.3678 (Optimal)
##    True Positives (TP) : 652
##   False Positives (FP) : 328
##   False Negatives (FN) : 408
##    True Negatives (TN) : 712
##    Total Positives (P) : 1060
##    Total Negatives (N) : 1040
## 
##   Business/Performance Metrics 
##   -------------------------------------------------- 
##       %Records&gt;=Cutoff : 0.4667
##              Good Rate : 0.6653 (Vs 0.5048 Overall)
##               Bad Rate : 0.3347 (Vs 0.4952 Overall)
##         Accuracy (ACC) : 0.6495
##      Sensitivity (TPR) : 0.6151
##  False Neg. Rate (FNR) : 0.3849
##  False Pos. Rate (FPR) : 0.3154
##      Specificity (TNR) : 0.6846
##        Precision (PPV) : 0.6653
##   False Discovery Rate : 0.3347
##     False Omision Rate : 0.3643
##   Inv. Precision (NPV) : 0.6357
## 
##   Note: 0 rows deleted due to missing data.</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="financial-score-card-model.html#cb69-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;ks&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="financial-score-card-model.html#cb70-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;auc&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p>Fixing PERS_H Variable</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="financial-score-card-model.html#cb71-1" tabindex="-1"></a><span class="co">#test PERS_H is missing an 8+ Category so we are gonna combine 7 and 8+</span></span>
<span id="cb71-2"><a href="financial-score-card-model.html#cb71-2" tabindex="-1"></a><span class="co">#test PERS_H is missing an 8+ Category</span></span>
<span id="cb71-3"><a href="financial-score-card-model.html#cb71-3" tabindex="-1"></a><span class="fu">table</span>(test<span class="sc">$</span>PERS_H)</span></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6  7+ 
## 316 203 179 138  48  13   3</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="financial-score-card-model.html#cb73-1" tabindex="-1"></a><span class="fu">table</span>(train<span class="sc">$</span>PERS_H)</span></code></pre></div>
<pre><code>## 
##   1   2   3   4   5   6  7+ 
## 800 441 392 343  85  25  14</code></pre>
<p>Check Model on the Testing Data</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="financial-score-card-model.html#cb75-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_num)) {</span>
<span id="cb75-2"><a href="financial-score-card-model.html#cb75-2" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> test, <span class="at">ivout =</span> results_all_sig_num[[i]], <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb75-3"><a href="financial-score-card-model.html#cb75-3" tabindex="-1"></a>}</span>
<span id="cb75-4"><a href="financial-score-card-model.html#cb75-4" tabindex="-1"></a></span>
<span id="cb75-5"><a href="financial-score-card-model.html#cb75-5" tabindex="-1"></a></span>
<span id="cb75-6"><a href="financial-score-card-model.html#cb75-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_char)) {</span>
<span id="cb75-7"><a href="financial-score-card-model.html#cb75-7" tabindex="-1"></a>  test <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> test, <span class="at">ivout =</span> results_all_sig_char[[i]], <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb75-8"><a href="financial-score-card-model.html#cb75-8" tabindex="-1"></a>}</span>
<span id="cb75-9"><a href="financial-score-card-model.html#cb75-9" tabindex="-1"></a></span>
<span id="cb75-10"><a href="financial-score-card-model.html#cb75-10" tabindex="-1"></a></span>
<span id="cb75-11"><a href="financial-score-card-model.html#cb75-11" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig)) {</span>
<span id="cb75-12"><a href="financial-score-card-model.html#cb75-12" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(test)) {</span>
<span id="cb75-13"><a href="financial-score-card-model.html#cb75-13" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb75-14"><a href="financial-score-card-model.html#cb75-14" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(test[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb75-15"><a href="financial-score-card-model.html#cb75-15" tabindex="-1"></a>    </span>
<span id="cb75-16"><a href="financial-score-card-model.html#cb75-16" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb75-17"><a href="financial-score-card-model.html#cb75-17" tabindex="-1"></a>    </span>
<span id="cb75-18"><a href="financial-score-card-model.html#cb75-18" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb75-19"><a href="financial-score-card-model.html#cb75-19" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb75-20"><a href="financial-score-card-model.html#cb75-20" tabindex="-1"></a>      test[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb75-21"><a href="financial-score-card-model.html#cb75-21" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb75-22"><a href="financial-score-card-model.html#cb75-22" tabindex="-1"></a>      test[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb75-23"><a href="financial-score-card-model.html#cb75-23" tabindex="-1"></a>    }</span>
<span id="cb75-24"><a href="financial-score-card-model.html#cb75-24" tabindex="-1"></a>  }</span>
<span id="cb75-25"><a href="financial-score-card-model.html#cb75-25" tabindex="-1"></a>}</span>
<span id="cb75-26"><a href="financial-score-card-model.html#cb75-26" tabindex="-1"></a></span>
<span id="cb75-27"><a href="financial-score-card-model.html#cb75-27" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(initial_score, <span class="at">newdata=</span>test, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span>
<span id="cb75-28"><a href="financial-score-card-model.html#cb75-28" tabindex="-1"></a></span>
<span id="cb75-29"><a href="financial-score-card-model.html#cb75-29" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##   Overall Performance Metrics 
##   -------------------------------------------------- 
##                     KS : 0.2475 (Unpredictive)
##                    AUC : 0.6610 (Poor)
## 
##   Classification Matrix 
##   -------------------------------------------------- 
##            Cutoff (&gt;=) : 0.3992 (Optimal)
##    True Positives (TP) : 239
##   False Positives (FP) : 136
##   False Negatives (FN) : 201
##    True Negatives (TN) : 324
##    Total Positives (P) : 440
##    Total Negatives (N) : 460
## 
##   Business/Performance Metrics 
##   -------------------------------------------------- 
##       %Records&gt;=Cutoff : 0.4167
##              Good Rate : 0.6373 (Vs 0.4889 Overall)
##               Bad Rate : 0.3627 (Vs 0.5111 Overall)
##         Accuracy (ACC) : 0.6256
##      Sensitivity (TPR) : 0.5432
##  False Neg. Rate (FNR) : 0.4568
##  False Pos. Rate (FPR) : 0.2957
##      Specificity (TNR) : 0.7043
##        Precision (PPV) : 0.6373
##   False Discovery Rate : 0.3627
##     False Omision Rate : 0.3829
##   Inv. Precision (NPV) : 0.6171
## 
##   Note: 0 rows deleted due to missing data.</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="financial-score-card-model.html#cb77-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;ks&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="financial-score-card-model.html#cb78-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;auc&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<p>Add Scores to Initial Model on Training Data</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="financial-score-card-model.html#cb79-1" tabindex="-1"></a><span class="co"># Add Scores to Initial Model #</span></span>
<span id="cb79-2"><a href="financial-score-card-model.html#cb79-2" tabindex="-1"></a>pdo <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb79-3"><a href="financial-score-card-model.html#cb79-3" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb79-4"><a href="financial-score-card-model.html#cb79-4" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb79-5"><a href="financial-score-card-model.html#cb79-5" tabindex="-1"></a>fact <span class="ot">&lt;-</span> pdo<span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)</span>
<span id="cb79-6"><a href="financial-score-card-model.html#cb79-6" tabindex="-1"></a>os <span class="ot">&lt;-</span> score <span class="sc">-</span> fact<span class="sc">*</span><span class="fu">log</span>(odds)</span>
<span id="cb79-7"><a href="financial-score-card-model.html#cb79-7" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">names</span>(initial_score<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb79-8"><a href="financial-score-card-model.html#cb79-8" tabindex="-1"></a></span>
<span id="cb79-9"><a href="financial-score-card-model.html#cb79-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> var_names) {</span>
<span id="cb79-10"><a href="financial-score-card-model.html#cb79-10" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[i]</span>
<span id="cb79-11"><a href="financial-score-card-model.html#cb79-11" tabindex="-1"></a>  beta0 <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb79-12"><a href="financial-score-card-model.html#cb79-12" tabindex="-1"></a>  nvar <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb79-13"><a href="financial-score-card-model.html#cb79-13" tabindex="-1"></a>  WOE_var <span class="ot">&lt;-</span> train[[i]]</span>
<span id="cb79-14"><a href="financial-score-card-model.html#cb79-14" tabindex="-1"></a>  points_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(i, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>), <span class="st">&quot;points&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb79-15"><a href="financial-score-card-model.html#cb79-15" tabindex="-1"></a></span>
<span id="cb79-16"><a href="financial-score-card-model.html#cb79-16" tabindex="-1"></a>  train[[points_name]] <span class="ot">&lt;-</span> <span class="sc">-</span>(WOE_var<span class="sc">*</span>(beta) <span class="sc">+</span> (beta0<span class="sc">/</span>nvar))<span class="sc">*</span>fact <span class="sc">+</span> os<span class="sc">/</span>nvar</span>
<span id="cb79-17"><a href="financial-score-card-model.html#cb79-17" tabindex="-1"></a>}</span>
<span id="cb79-18"><a href="financial-score-card-model.html#cb79-18" tabindex="-1"></a></span>
<span id="cb79-19"><a href="financial-score-card-model.html#cb79-19" tabindex="-1"></a></span>
<span id="cb79-20"><a href="financial-score-card-model.html#cb79-20" tabindex="-1"></a>colini <span class="ot">&lt;-</span> (<span class="fu">ncol</span>(train)<span class="sc">-</span>nvar <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb79-21"><a href="financial-score-card-model.html#cb79-21" tabindex="-1"></a>colend <span class="ot">&lt;-</span> <span class="fu">ncol</span>(train)</span>
<span id="cb79-22"><a href="financial-score-card-model.html#cb79-22" tabindex="-1"></a>train<span class="sc">$</span>Score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(train[, colini<span class="sc">:</span>colend])</span>
<span id="cb79-23"><a href="financial-score-card-model.html#cb79-23" tabindex="-1"></a></span>
<span id="cb79-24"><a href="financial-score-card-model.html#cb79-24" tabindex="-1"></a><span class="fu">hist</span>(train<span class="sc">$</span>Score, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">250</span>,<span class="dv">500</span>), <span class="at">main =</span> <span class="st">&quot;Distribution of Train Scores&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Scoring for the Test Data Set</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="financial-score-card-model.html#cb80-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> var_names) {</span>
<span id="cb80-2"><a href="financial-score-card-model.html#cb80-2" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[i]</span>
<span id="cb80-3"><a href="financial-score-card-model.html#cb80-3" tabindex="-1"></a>  beta0 <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb80-4"><a href="financial-score-card-model.html#cb80-4" tabindex="-1"></a>  nvar <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb80-5"><a href="financial-score-card-model.html#cb80-5" tabindex="-1"></a>  WOE_var <span class="ot">&lt;-</span> test[[i]]</span>
<span id="cb80-6"><a href="financial-score-card-model.html#cb80-6" tabindex="-1"></a>  points_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(i, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>), <span class="st">&quot;points&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb80-7"><a href="financial-score-card-model.html#cb80-7" tabindex="-1"></a>  </span>
<span id="cb80-8"><a href="financial-score-card-model.html#cb80-8" tabindex="-1"></a>  test[[points_name]] <span class="ot">&lt;-</span> <span class="sc">-</span>(WOE_var<span class="sc">*</span>(beta) <span class="sc">+</span> (beta0<span class="sc">/</span>nvar))<span class="sc">*</span>fact <span class="sc">+</span> os<span class="sc">/</span>nvar</span>
<span id="cb80-9"><a href="financial-score-card-model.html#cb80-9" tabindex="-1"></a>}</span>
<span id="cb80-10"><a href="financial-score-card-model.html#cb80-10" tabindex="-1"></a></span>
<span id="cb80-11"><a href="financial-score-card-model.html#cb80-11" tabindex="-1"></a>colini <span class="ot">&lt;-</span> (<span class="fu">ncol</span>(test)<span class="sc">-</span>nvar <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb80-12"><a href="financial-score-card-model.html#cb80-12" tabindex="-1"></a>colend <span class="ot">&lt;-</span> <span class="fu">ncol</span>(test)</span>
<span id="cb80-13"><a href="financial-score-card-model.html#cb80-13" tabindex="-1"></a>test<span class="sc">$</span>Score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(test[, colini<span class="sc">:</span>colend])</span>
<span id="cb80-14"><a href="financial-score-card-model.html#cb80-14" tabindex="-1"></a></span>
<span id="cb80-15"><a href="financial-score-card-model.html#cb80-15" tabindex="-1"></a><span class="fu">hist</span>(test<span class="sc">$</span>Score, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">250</span>,<span class="dv">480</span>), <span class="at">main =</span> <span class="st">&quot;Distribution of Test Scores&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>combining training and testing data back together and looking at histogram of result</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="financial-score-card-model.html#cb81-1" tabindex="-1"></a>accepts_scored <span class="ot">&lt;-</span> <span class="fu">rbind</span>(train, test)</span>
<span id="cb81-2"><a href="financial-score-card-model.html#cb81-2" tabindex="-1"></a><span class="fu">hist</span>(accepts_scored<span class="sc">$</span>Score, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">&quot;Distribution of Scores&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="reject-inference---clean-prepare-reject-data" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Reject Inference - Clean &amp; Prepare Reject Data<a href="financial-score-card-model.html#reject-inference---clean-prepare-reject-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="financial-score-card-model.html#cb82-1" tabindex="-1"></a><span class="co">#need to make sure our levels match the accepts data exactly or we wont be able to bin properly </span></span>
<span id="cb82-2"><a href="financial-score-card-model.html#cb82-2" tabindex="-1"></a>rejects<span class="ot">=</span> rejected <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="financial-score-card-model.html#cb82-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>AGE, <span class="sc">-</span>DIV, <span class="sc">-</span>NAT) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="financial-score-card-model.html#cb82-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PERS_H=</span> <span class="fu">ifelse</span>(PERS_H<span class="sc">&gt;=</span><span class="dv">7</span>, <span class="st">&#39;7+&#39;</span>, PERS_H),</span>
<span id="cb82-5"><a href="financial-score-card-model.html#cb82-5" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;VISA mybank&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS),</span>
<span id="cb82-6"><a href="financial-score-card-model.html#cb82-6" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;VISA Others&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS),</span>
<span id="cb82-7"><a href="financial-score-card-model.html#cb82-7" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;American Express&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS),</span>
<span id="cb82-8"><a href="financial-score-card-model.html#cb82-8" tabindex="-1"></a>          <span class="co"># citibank in rejects and not accepts and need to get it to match</span></span>
<span id="cb82-9"><a href="financial-score-card-model.html#cb82-9" tabindex="-1"></a>         <span class="at">CARDS=</span> <span class="fu">ifelse</span>(CARDS<span class="sc">==</span><span class="st">&#39;VISA Citibank&#39;</span>, <span class="st">&#39;Other credit car&#39;</span>, CARDS))</span>
<span id="cb82-10"><a href="financial-score-card-model.html#cb82-10" tabindex="-1"></a></span>
<span id="cb82-11"><a href="financial-score-card-model.html#cb82-11" tabindex="-1"></a></span>
<span id="cb82-12"><a href="financial-score-card-model.html#cb82-12" tabindex="-1"></a></span>
<span id="cb82-13"><a href="financial-score-card-model.html#cb82-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(rejects))){</span>
<span id="cb82-14"><a href="financial-score-card-model.html#cb82-14" tabindex="-1"></a><span class="co">#if (colnames(accepts)[i] == &#39;good&#39;){</span></span>
<span id="cb82-15"><a href="financial-score-card-model.html#cb82-15" tabindex="-1"></a><span class="co">#next</span></span>
<span id="cb82-16"><a href="financial-score-card-model.html#cb82-16" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb82-17"><a href="financial-score-card-model.html#cb82-17" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(rejects[,i]))<span class="sc">&lt;</span><span class="dv">15</span>){</span>
<span id="cb82-18"><a href="financial-score-card-model.html#cb82-18" tabindex="-1"></a>rejects[,i]<span class="ot">=</span><span class="fu">as.factor</span>(rejects[,i])</span>
<span id="cb82-19"><a href="financial-score-card-model.html#cb82-19" tabindex="-1"></a>}</span>
<span id="cb82-20"><a href="financial-score-card-model.html#cb82-20" tabindex="-1"></a>}</span>
<span id="cb82-21"><a href="financial-score-card-model.html#cb82-21" tabindex="-1"></a></span>
<span id="cb82-22"><a href="financial-score-card-model.html#cb82-22" tabindex="-1"></a><span class="co">#str(rejects)</span></span>
<span id="cb82-23"><a href="financial-score-card-model.html#cb82-23" tabindex="-1"></a><span class="co">#str(accepts)</span></span></code></pre></div>
<p>Reject Inference - Clean &amp; Prepare Reject Data</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="financial-score-card-model.html#cb83-1" tabindex="-1"></a><span class="co">#altering the bands for each binning set in the results list in case there are any additional lower points or higher points in the rejects data</span></span>
<span id="cb83-2"><a href="financial-score-card-model.html#cb83-2" tabindex="-1"></a><span class="co">#this is mostly for the numeric values </span></span>
<span id="cb83-3"><a href="financial-score-card-model.html#cb83-3" tabindex="-1"></a></span>
<span id="cb83-4"><a href="financial-score-card-model.html#cb83-4" tabindex="-1"></a><span class="co">#making sure bands change in our results_all_sig_char for accepts and rejects combined</span></span>
<span id="cb83-5"><a href="financial-score-card-model.html#cb83-5" tabindex="-1"></a><span class="co">#this shouldnt cause any issues in the binner and WoE creating as long as there are the same type of unique levels</span></span>
<span id="cb83-6"><a href="financial-score-card-model.html#cb83-6" tabindex="-1"></a><span class="co">#this will not run since these are categorical variables so no need to set band</span></span>
<span id="cb83-7"><a href="financial-score-card-model.html#cb83-7" tabindex="-1"></a><span class="co"># for(i in names(results_all_sig_char)) {</span></span>
<span id="cb83-8"><a href="financial-score-card-model.html#cb83-8" tabindex="-1"></a><span class="co">#   results_all_sig_char[[i]]$bands[1] &lt;- min(c(accepts[[i]], rejects[[i]]), na.rm = TRUE)</span></span>
<span id="cb83-9"><a href="financial-score-card-model.html#cb83-9" tabindex="-1"></a><span class="co">#   results_all_sig_char[[i]]$bands[length(results_all_sig_char[[i]]$bands)] &lt;- max(c(accepts[[i]], rejects[[i]]), na.rm = TRUE)</span></span>
<span id="cb83-10"><a href="financial-score-card-model.html#cb83-10" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb83-11"><a href="financial-score-card-model.html#cb83-11" tabindex="-1"></a></span>
<span id="cb83-12"><a href="financial-score-card-model.html#cb83-12" tabindex="-1"></a></span>
<span id="cb83-13"><a href="financial-score-card-model.html#cb83-13" tabindex="-1"></a><span class="co">#making sure bands change in our results_all_sig_num for accepts and rejects combined</span></span>
<span id="cb83-14"><a href="financial-score-card-model.html#cb83-14" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(results_all_sig_num)) {</span>
<span id="cb83-15"><a href="financial-score-card-model.html#cb83-15" tabindex="-1"></a>  results_all_sig_num[[i]]<span class="sc">$</span>bands[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">c</span>(accepts[[i]], rejects[[i]]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-16"><a href="financial-score-card-model.html#cb83-16" tabindex="-1"></a>  results_all_sig_num[[i]]<span class="sc">$</span>bands[<span class="fu">length</span>(results_all_sig_num[[i]]<span class="sc">$</span>bands)] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">c</span>(accepts[[i]], rejects[[i]]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-17"><a href="financial-score-card-model.html#cb83-17" tabindex="-1"></a>}</span>
<span id="cb83-18"><a href="financial-score-card-model.html#cb83-18" tabindex="-1"></a></span>
<span id="cb83-19"><a href="financial-score-card-model.html#cb83-19" tabindex="-1"></a><span class="co">#Getting the bins of the variables in the results_all_sig numeric </span></span>
<span id="cb83-20"><a href="financial-score-card-model.html#cb83-20" tabindex="-1"></a>rejects_scored <span class="ot">&lt;-</span> rejects</span>
<span id="cb83-21"><a href="financial-score-card-model.html#cb83-21" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_num)) {</span>
<span id="cb83-22"><a href="financial-score-card-model.html#cb83-22" tabindex="-1"></a>  rejects_scored <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> rejects_scored, <span class="at">ivout =</span> results_all_sig_num[[i]], </span>
<span id="cb83-23"><a href="financial-score-card-model.html#cb83-23" tabindex="-1"></a>                                  <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb83-24"><a href="financial-score-card-model.html#cb83-24" tabindex="-1"></a>}</span>
<span id="cb83-25"><a href="financial-score-card-model.html#cb83-25" tabindex="-1"></a></span>
<span id="cb83-26"><a href="financial-score-card-model.html#cb83-26" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_char)) {</span>
<span id="cb83-27"><a href="financial-score-card-model.html#cb83-27" tabindex="-1"></a>  rejects_scored <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> rejects_scored, <span class="at">ivout =</span> results_all_sig_char[[i]], </span>
<span id="cb83-28"><a href="financial-score-card-model.html#cb83-28" tabindex="-1"></a>                                         <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb83-29"><a href="financial-score-card-model.html#cb83-29" tabindex="-1"></a>}</span>
<span id="cb83-30"><a href="financial-score-card-model.html#cb83-30" tabindex="-1"></a></span>
<span id="cb83-31"><a href="financial-score-card-model.html#cb83-31" tabindex="-1"></a>results_all_sig_AR<span class="ot">=</span><span class="fu">append</span>(results_all_sig_num,results_all_sig_char)</span></code></pre></div>
<p>Getting the WoE values for our Rejects Bins we Just Created
-This wont work if the levels of the categories are not the same across the rejects
and accepts data for the significant categorical vars in the results list
-This also wont work if our bands for the numeric sig vars are not altered to account for both the accepts and the rejects</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="financial-score-card-model.html#cb84-1" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_AR)) {</span>
<span id="cb84-2"><a href="financial-score-card-model.html#cb84-2" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rejects_scored)) {</span>
<span id="cb84-3"><a href="financial-score-card-model.html#cb84-3" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_AR[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb84-4"><a href="financial-score-card-model.html#cb84-4" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(rejects_scored[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb84-5"><a href="financial-score-card-model.html#cb84-5" tabindex="-1"></a>    </span>
<span id="cb84-6"><a href="financial-score-card-model.html#cb84-6" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_AR[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb84-7"><a href="financial-score-card-model.html#cb84-7" tabindex="-1"></a>    </span>
<span id="cb84-8"><a href="financial-score-card-model.html#cb84-8" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb84-9"><a href="financial-score-card-model.html#cb84-9" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig_AR[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb84-10"><a href="financial-score-card-model.html#cb84-10" tabindex="-1"></a>      rejects_scored[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_AR[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb84-11"><a href="financial-score-card-model.html#cb84-11" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb84-12"><a href="financial-score-card-model.html#cb84-12" tabindex="-1"></a>      rejects_scored[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_AR[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb84-13"><a href="financial-score-card-model.html#cb84-13" tabindex="-1"></a>    }</span>
<span id="cb84-14"><a href="financial-score-card-model.html#cb84-14" tabindex="-1"></a>  }</span>
<span id="cb84-15"><a href="financial-score-card-model.html#cb84-15" tabindex="-1"></a>}</span>
<span id="cb84-16"><a href="financial-score-card-model.html#cb84-16" tabindex="-1"></a></span>
<span id="cb84-17"><a href="financial-score-card-model.html#cb84-17" tabindex="-1"></a><span class="fu">head</span>(rejects_scored)</span></code></pre></div>
<pre><code>##   CHILDREN PERS_H TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN CASH          PRODUCT RESID             PROF
## 1        0      1     6     18   1       0       0      0       1      3        1     0    0  500 Dept. Store,Mail Lease           Others
## 2        1      2    84     54   1       0       0   2500       0      2        1     0    3 1700 Furniture,Carpet Lease Food,Building,Ca
## 3        1      3    36    108   2       0       1   2600       0      1        1     2    0  900  Radio, TV, Hifi Owner           Others
## 4        2      3   168     15   1       0       0   1600       0      3        1     0    0 1200  Radio, TV, Hifi  &lt;NA&gt;           Others
## 5        0      1   240      9   2       0       0      0       1      3        1     0    0 4000 Furniture,Carpet Lease           Others
## 6        2      4    30      9   2       2       0   1700       0      3        1     0    0 2000  Radio, TV, Hifi Lease           Others
##               CAR           CARDS TMJOB1_bin INCOME_bin PERS_H_bin              CARDS_bin EC_CARD_bin TMJOB1_WOE INCOME_WOE PERS_H_WOE
## 1             Car     Cheque card   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;     01 = &#39;Cheque card&#39;    02 = &#39;1&#39;    -0.3991     0.6767    -0.5239
## 2 Without Vehicle no credit cards  02 &lt;= 144     02 &gt; 0   02 = &#39;2&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;     0.0533    -0.2075     0.4283
## 3             Car no credit cards  02 &lt;= 144     02 &gt; 0   03 = &#39;3&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;     0.0533    -0.2075     0.3172
## 4 Without Vehicle no credit cards   01 &lt;= 30     02 &gt; 0   03 = &#39;3&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;    -0.3991    -0.2075     0.3172
## 5 Without Vehicle     Cheque card   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;     01 = &#39;Cheque card&#39;    02 = &#39;1&#39;    -0.3991     0.6767    -0.5239
## 6 Without Vehicle no credit cards   01 &lt;= 30     02 &gt; 0   04 = &#39;4&#39; 03 = &#39;no credit cards&#39;    01 = &#39;0&#39;    -0.3991    -0.2075     0.2948
##   CARDS_WOE EC_CARD_WOE
## 1    0.6846      0.6846
## 2   -0.2663     -0.2313
## 3   -0.2663     -0.2313
## 4   -0.2663     -0.2313
## 5    0.6846      0.6846
## 6   -0.2663     -0.2313</code></pre>
<p>Scoring the Rejects Data Using our initial model we made</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="financial-score-card-model.html#cb86-1" tabindex="-1"></a>pdo <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb86-2"><a href="financial-score-card-model.html#cb86-2" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb86-3"><a href="financial-score-card-model.html#cb86-3" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb86-4"><a href="financial-score-card-model.html#cb86-4" tabindex="-1"></a>fact <span class="ot">&lt;-</span> pdo<span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)</span>
<span id="cb86-5"><a href="financial-score-card-model.html#cb86-5" tabindex="-1"></a>os <span class="ot">&lt;-</span> score <span class="sc">-</span> fact<span class="sc">*</span><span class="fu">log</span>(odds)</span>
<span id="cb86-6"><a href="financial-score-card-model.html#cb86-6" tabindex="-1"></a>var_names <span class="ot">&lt;-</span> <span class="fu">names</span>(initial_score<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb86-7"><a href="financial-score-card-model.html#cb86-7" tabindex="-1"></a></span>
<span id="cb86-8"><a href="financial-score-card-model.html#cb86-8" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> var_names) {</span>
<span id="cb86-9"><a href="financial-score-card-model.html#cb86-9" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[i]</span>
<span id="cb86-10"><a href="financial-score-card-model.html#cb86-10" tabindex="-1"></a>  beta0 <span class="ot">&lt;-</span> initial_score<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb86-11"><a href="financial-score-card-model.html#cb86-11" tabindex="-1"></a>  nvar <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names)</span>
<span id="cb86-12"><a href="financial-score-card-model.html#cb86-12" tabindex="-1"></a>  WOE_var <span class="ot">&lt;-</span> rejects_scored[[i]]</span>
<span id="cb86-13"><a href="financial-score-card-model.html#cb86-13" tabindex="-1"></a>  points_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(i, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>), <span class="st">&quot;points&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb86-14"><a href="financial-score-card-model.html#cb86-14" tabindex="-1"></a>  </span>
<span id="cb86-15"><a href="financial-score-card-model.html#cb86-15" tabindex="-1"></a>  rejects_scored[[points_name]] <span class="ot">&lt;-</span> <span class="sc">-</span>(WOE_var<span class="sc">*</span>(beta) <span class="sc">+</span> (beta0<span class="sc">/</span>nvar))<span class="sc">*</span>fact <span class="sc">+</span> os<span class="sc">/</span>nvar</span>
<span id="cb86-16"><a href="financial-score-card-model.html#cb86-16" tabindex="-1"></a>}</span>
<span id="cb86-17"><a href="financial-score-card-model.html#cb86-17" tabindex="-1"></a></span>
<span id="cb86-18"><a href="financial-score-card-model.html#cb86-18" tabindex="-1"></a>colini <span class="ot">&lt;-</span> (<span class="fu">ncol</span>(rejects_scored)<span class="sc">-</span>nvar <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb86-19"><a href="financial-score-card-model.html#cb86-19" tabindex="-1"></a>colend <span class="ot">&lt;-</span> <span class="fu">ncol</span>(rejects_scored)</span>
<span id="cb86-20"><a href="financial-score-card-model.html#cb86-20" tabindex="-1"></a>rejects_scored<span class="sc">$</span>Score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(rejects_scored[, colini<span class="sc">:</span>colend])</span></code></pre></div>
<p>Parceling our Rejects Data to get our GB variable</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="financial-score-card-model.html#cb87-1" tabindex="-1"></a>parc <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">25</span>)</span>
<span id="cb87-2"><a href="financial-score-card-model.html#cb87-2" tabindex="-1"></a></span>
<span id="cb87-3"><a href="financial-score-card-model.html#cb87-3" tabindex="-1"></a>accepts_scored<span class="sc">$</span>Score_parc <span class="ot">&lt;-</span> <span class="fu">cut</span>(accepts_scored<span class="sc">$</span>Score, <span class="at">breaks =</span> parc)</span>
<span id="cb87-4"><a href="financial-score-card-model.html#cb87-4" tabindex="-1"></a>rejects_scored<span class="sc">$</span>Score_parc <span class="ot">&lt;-</span> <span class="fu">cut</span>(rejects_scored<span class="sc">$</span>Score, <span class="at">breaks =</span> parc)</span>
<span id="cb87-5"><a href="financial-score-card-model.html#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="financial-score-card-model.html#cb87-6" tabindex="-1"></a><span class="fu">table</span>(accepts_scored<span class="sc">$</span>Score_parc, accepts_scored<span class="sc">$</span>GB)</span></code></pre></div>
<pre><code>##            
##               0   1
##   (200,225]   0   0
##   (225,250]   1   7
##   (250,275] 121 336
##   (275,300] 121 238
##   (300,325] 257 326
##   (325,350] 328 288
##   (350,375] 143  92
##   (375,400] 202  85
##   (400,425] 233 110
##   (425,450]  13   3
##   (450,475]  74  15
##   (475,500]   7   0</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="financial-score-card-model.html#cb89-1" tabindex="-1"></a>parc_perc <span class="ot">&lt;-</span> <span class="fu">table</span>(accepts_scored<span class="sc">$</span>Score_parc, accepts_scored<span class="sc">$</span>GB)[,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">rowSums</span>(<span class="fu">table</span>(accepts_scored<span class="sc">$</span>Score_parc, accepts_scored<span class="sc">$</span>GB))</span>
<span id="cb89-2"><a href="financial-score-card-model.html#cb89-2" tabindex="-1"></a></span>
<span id="cb89-3"><a href="financial-score-card-model.html#cb89-3" tabindex="-1"></a>rejects<span class="sc">$</span>GB <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb89-4"><a href="financial-score-card-model.html#cb89-4" tabindex="-1"></a></span>
<span id="cb89-5"><a href="financial-score-card-model.html#cb89-5" tabindex="-1"></a>rej_bump <span class="ot">&lt;-</span> <span class="fl">1.25</span></span>
<span id="cb89-6"><a href="financial-score-card-model.html#cb89-6" tabindex="-1"></a></span>
<span id="cb89-7"><a href="financial-score-card-model.html#cb89-7" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(parc)<span class="sc">-</span><span class="dv">1</span>)) {</span>
<span id="cb89-8"><a href="financial-score-card-model.html#cb89-8" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(rejects_scored<span class="sc">$</span>Score)) {</span>
<span id="cb89-9"><a href="financial-score-card-model.html#cb89-9" tabindex="-1"></a>    <span class="cf">if</span>((rejects_scored<span class="sc">$</span>Score[j] <span class="sc">&gt;</span> parc[i]) <span class="sc">&amp;</span> </span>
<span id="cb89-10"><a href="financial-score-card-model.html#cb89-10" tabindex="-1"></a>       (rejects_scored<span class="sc">$</span>Score[j] <span class="sc">&lt;=</span> parc[i<span class="sc">+</span><span class="dv">1</span>]) <span class="sc">&amp;</span> </span>
<span id="cb89-11"><a href="financial-score-card-model.html#cb89-11" tabindex="-1"></a>       (<span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>) <span class="sc">&lt;</span> (rej_bump<span class="sc">*</span>parc_perc[i]))) {</span>
<span id="cb89-12"><a href="financial-score-card-model.html#cb89-12" tabindex="-1"></a>      rejects<span class="sc">$</span>GB[j] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb89-13"><a href="financial-score-card-model.html#cb89-13" tabindex="-1"></a>    }</span>
<span id="cb89-14"><a href="financial-score-card-model.html#cb89-14" tabindex="-1"></a>  }</span>
<span id="cb89-15"><a href="financial-score-card-model.html#cb89-15" tabindex="-1"></a>}</span>
<span id="cb89-16"><a href="financial-score-card-model.html#cb89-16" tabindex="-1"></a></span>
<span id="cb89-17"><a href="financial-score-card-model.html#cb89-17" tabindex="-1"></a><span class="fu">table</span>(rejects_scored<span class="sc">$</span>Score_parc, rejects<span class="sc">$</span>GB)</span></code></pre></div>
<pre><code>##            
##               0   1
##   (200,225]   0   0
##   (225,250]   0   2
##   (250,275]  25 321
##   (275,300]  28 165
##   (300,325] 111 254
##   (325,350] 126 183
##   (350,375]  30  30
##   (375,400]  69  38
##   (400,425]  65  29
##   (425,450]   4   1
##   (450,475]   7   3
##   (475,500]   9   0</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="financial-score-card-model.html#cb91-1" tabindex="-1"></a>rejects<span class="sc">$</span>good <span class="ot">&lt;-</span> <span class="fu">abs</span>(rejects<span class="sc">$</span>GB <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="data-prep-for-final-model" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Data Prep For Final Model<a href="financial-score-card-model.html#data-prep-for-final-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Verifying the Weights</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="financial-score-card-model.html#cb92-1" tabindex="-1"></a><span class="co">#goods are weighted by 30</span></span>
<span id="cb92-2"><a href="financial-score-card-model.html#cb92-2" tabindex="-1"></a><span class="co">#take the population of bads and divide it by the population of goods times the weight given</span></span>
<span id="cb92-3"><a href="financial-score-card-model.html#cb92-3" tabindex="-1"></a><span class="dv">1500</span><span class="sc">/</span>(<span class="dv">1500</span><span class="sc">*</span><span class="dv">30</span>)</span></code></pre></div>
<pre><code>## [1] 0.03333333</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="financial-score-card-model.html#cb94-1" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span><span class="fl">0.0323</span></span></code></pre></div>
<pre><code>## [1] 30.95975</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="financial-score-card-model.html#cb96-1" tabindex="-1"></a><span class="co">#you get .0333--&gt; 3.33%which is essentially the populations bad rate of 3.23%</span></span>
<span id="cb96-2"><a href="financial-score-card-model.html#cb96-2" tabindex="-1"></a></span>
<span id="cb96-3"><a href="financial-score-card-model.html#cb96-3" tabindex="-1"></a><span class="co">#could also take the population percentage of bad and put it under 1 to get what the actual weights should be which are 30.95975</span></span>
<span id="cb96-4"><a href="financial-score-card-model.html#cb96-4" tabindex="-1"></a></span>
<span id="cb96-5"><a href="financial-score-card-model.html#cb96-5" tabindex="-1"></a>pop_g <span class="ot">&lt;-</span> <span class="fl">0.9677</span></span>
<span id="cb96-6"><a href="financial-score-card-model.html#cb96-6" tabindex="-1"></a>pop_b <span class="ot">&lt;-</span> <span class="fl">0.0323</span></span>
<span id="cb96-7"><a href="financial-score-card-model.html#cb96-7" tabindex="-1"></a>sam_g <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb96-8"><a href="financial-score-card-model.html#cb96-8" tabindex="-1"></a>sam_b <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb96-9"><a href="financial-score-card-model.html#cb96-9" tabindex="-1"></a></span>
<span id="cb96-10"><a href="financial-score-card-model.html#cb96-10" tabindex="-1"></a><span class="co">#verifying the initial weigths of 30 for the accepts dataset </span></span>
<span id="cb96-11"><a href="financial-score-card-model.html#cb96-11" tabindex="-1"></a>Weight_Of_Good_AcceptsDF<span class="ot">=</span>(pop_g<span class="sc">/</span>pop_b)<span class="sc">/</span>(sam_g<span class="sc">/</span>sam_b)</span>
<span id="cb96-12"><a href="financial-score-card-model.html#cb96-12" tabindex="-1"></a>Weight_Of_Good_AcceptsDF</span></code></pre></div>
<pre><code>## [1] 29.95975</code></pre>
<p>Adjusting the weights of Good to Bad for our Accepts and Rejects Data Set</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="financial-score-card-model.html#cb98-1" tabindex="-1"></a><span class="co"># rejects_scored$pred &lt;- predict(initial_score, newdata=rejects_scored, type=&#39;response&#39;)</span></span>
<span id="cb98-2"><a href="financial-score-card-model.html#cb98-2" tabindex="-1"></a><span class="co"># rejects$GB &lt;- as.numeric(rejects_scored$pred &gt; 0.0617)</span></span>
<span id="cb98-3"><a href="financial-score-card-model.html#cb98-3" tabindex="-1"></a><span class="co"># rejects$good &lt;- abs(rejects$GB - 1)</span></span>
<span id="cb98-4"><a href="financial-score-card-model.html#cb98-4" tabindex="-1"></a></span>
<span id="cb98-5"><a href="financial-score-card-model.html#cb98-5" tabindex="-1"></a>pop_g <span class="ot">&lt;-</span> <span class="fl">0.9677</span></span>
<span id="cb98-6"><a href="financial-score-card-model.html#cb98-6" tabindex="-1"></a>pop_b <span class="ot">&lt;-</span> <span class="fl">0.0323</span></span>
<span id="cb98-7"><a href="financial-score-card-model.html#cb98-7" tabindex="-1"></a></span>
<span id="cb98-8"><a href="financial-score-card-model.html#cb98-8" tabindex="-1"></a>sam_g <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb98-9"><a href="financial-score-card-model.html#cb98-9" tabindex="-1"></a>sam_b <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb98-10"><a href="financial-score-card-model.html#cb98-10" tabindex="-1"></a></span>
<span id="cb98-11"><a href="financial-score-card-model.html#cb98-11" tabindex="-1"></a>pop_sam_gb_ratio <span class="ot">&lt;-</span> (pop_g<span class="sc">/</span>pop_b)<span class="sc">/</span>(sam_g<span class="sc">/</span>sam_b)</span>
<span id="cb98-12"><a href="financial-score-card-model.html#cb98-12" tabindex="-1"></a></span>
<span id="cb98-13"><a href="financial-score-card-model.html#cb98-13" tabindex="-1"></a>pop_a <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb98-14"><a href="financial-score-card-model.html#cb98-14" tabindex="-1"></a>pop_r <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb98-15"><a href="financial-score-card-model.html#cb98-15" tabindex="-1"></a></span>
<span id="cb98-16"><a href="financial-score-card-model.html#cb98-16" tabindex="-1"></a>sam_a <span class="ot">&lt;-</span> <span class="dv">3000</span></span>
<span id="cb98-17"><a href="financial-score-card-model.html#cb98-17" tabindex="-1"></a>sam_r <span class="ot">&lt;-</span> <span class="dv">1500</span></span>
<span id="cb98-18"><a href="financial-score-card-model.html#cb98-18" tabindex="-1"></a></span>
<span id="cb98-19"><a href="financial-score-card-model.html#cb98-19" tabindex="-1"></a>pop_sam_ar_ratio <span class="ot">&lt;-</span> (pop_a<span class="sc">/</span>pop_r)<span class="sc">/</span>(sam_a<span class="sc">/</span>sam_r)</span>
<span id="cb98-20"><a href="financial-score-card-model.html#cb98-20" tabindex="-1"></a></span>
<span id="cb98-21"><a href="financial-score-card-model.html#cb98-21" tabindex="-1"></a>weight_rb <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb98-22"><a href="financial-score-card-model.html#cb98-22" tabindex="-1"></a>weight_rg <span class="ot">&lt;-</span> pop_sam_gb_ratio</span>
<span id="cb98-23"><a href="financial-score-card-model.html#cb98-23" tabindex="-1"></a></span>
<span id="cb98-24"><a href="financial-score-card-model.html#cb98-24" tabindex="-1"></a>weight_ab <span class="ot">&lt;-</span> pop_sam_ar_ratio</span>
<span id="cb98-25"><a href="financial-score-card-model.html#cb98-25" tabindex="-1"></a>weight_ag <span class="ot">&lt;-</span> pop_sam_ar_ratio<span class="sc">*</span>pop_sam_gb_ratio</span>
<span id="cb98-26"><a href="financial-score-card-model.html#cb98-26" tabindex="-1"></a></span>
<span id="cb98-27"><a href="financial-score-card-model.html#cb98-27" tabindex="-1"></a>accepts<span class="sc">$</span>weight_ar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(accepts<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>, weight_ab, weight_ag)</span>
<span id="cb98-28"><a href="financial-score-card-model.html#cb98-28" tabindex="-1"></a>rejects<span class="sc">$</span>weight_ar <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(rejects<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>, weight_rb, weight_rg)</span>
<span id="cb98-29"><a href="financial-score-card-model.html#cb98-29" tabindex="-1"></a></span>
<span id="cb98-30"><a href="financial-score-card-model.html#cb98-30" tabindex="-1"></a></span>
<span id="cb98-31"><a href="financial-score-card-model.html#cb98-31" tabindex="-1"></a>comb_parc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(accepts[, <span class="sc">!</span>(<span class="fu">names</span>(accepts) <span class="sc">==</span> <span class="st">&#39;_freq_&#39;</span>)], rejects) <span class="co"># New Combined Data Set #</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="financial-score-card-model.html#cb99-1" tabindex="-1"></a>comb <span class="ot">&lt;-</span> comb_parc <span class="co"># Select which data set you want to use from above techniques #</span></span>
<span id="cb99-2"><a href="financial-score-card-model.html#cb99-2" tabindex="-1"></a></span>
<span id="cb99-3"><a href="financial-score-card-model.html#cb99-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0119</span>)</span>
<span id="cb99-4"><a href="financial-score-card-model.html#cb99-4" tabindex="-1"></a>train_id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(comb)), <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.70</span><span class="sc">*</span><span class="fu">nrow</span>(comb)))</span>
<span id="cb99-5"><a href="financial-score-card-model.html#cb99-5" tabindex="-1"></a></span>
<span id="cb99-6"><a href="financial-score-card-model.html#cb99-6" tabindex="-1"></a>train_comb <span class="ot">&lt;-</span> comb[train_id, ]</span>
<span id="cb99-7"><a href="financial-score-card-model.html#cb99-7" tabindex="-1"></a>test_comb <span class="ot">&lt;-</span> comb[<span class="sc">-</span>train_id, ]</span>
<span id="cb99-8"><a href="financial-score-card-model.html#cb99-8" tabindex="-1"></a></span>
<span id="cb99-9"><a href="financial-score-card-model.html#cb99-9" tabindex="-1"></a>iv_summary_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.sumiv</span>(<span class="at">df =</span> train_comb, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>)</span></code></pre></div>
<pre><code>##  
## 
  |                                                        
  |                                                  |   0%
  |                                                        
  |--                                                |   5%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----                                             |   9%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------                                           |  14%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------                                         |  18%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------                                       |  23%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |--------------                                    |  27%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |----------------                                  |  32%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------                                |  36%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |--------------------                              |  41%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------------------                           |  45%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------------------------                         |  50%
  |                                                        
  |---------------------------                       |  55%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |------------------------------                    |  59%
  |                                                        
  |--------------------------------                  |  64%
  |                                                        
  |----------------------------------                |  68%
  |                                                        
  |------------------------------------              |  73%
  |                                                        
  |---------------------------------------           |  77%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-----------------------------------------         |  82%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |-------------------------------------------       |  86%</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<pre><code>## 
  |                                                        
  |---------------------------------------------     |  91%
  |                                                        
  |------------------------------------------------  |  95%
  |                                                        
  |--------------------------------------------------| 100%
## </code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="financial-score-card-model.html#cb129-1" tabindex="-1"></a>iv_summary_comb<span class="ot">=</span> <span class="fu">na.omit</span>(iv_summary_comb)</span>
<span id="cb129-2"><a href="financial-score-card-model.html#cb129-2" tabindex="-1"></a><span class="fu">smbinning.sumiv.plot</span>(iv_summary_comb)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="financial-score-card-model.html#cb130-1" tabindex="-1"></a>iv_summary_comb</span></code></pre></div>
<pre><code>##        Char     IV            Process
## 8    INCOME 0.2471 Numeric binning OK
## 4    TMJOB1 0.2336 Numeric binning OK
## 2    PERS_H 0.2231  Factor binning OK
## 19    CARDS 0.2178  Factor binning OK
## 9   EC_CARD 0.1869  Factor binning OK
## 1  CHILDREN 0.0884  Factor binning OK
## 5       TEL 0.0557  Factor binning OK
## 18      CAR 0.0455  Factor binning OK
## 6   NMBLOAN 0.0337  Factor binning OK
## 3     TMADD 0.0222 Numeric binning OK
## 7   FINLOAN 0.0209  Factor binning OK
## 10   BUREAU 0.0184  Factor binning OK
## 13     REGN 0.0101  Factor binning OK
## 11 LOCATION 0.0036  Factor binning OK
## 16    RESID 0.0036  Factor binning OK
## 20       GB 0.0000  Factor binning OK</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="financial-score-card-model.html#cb132-1" tabindex="-1"></a>imp_vars_comb<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb132-2"><a href="financial-score-card-model.html#cb132-2" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(iv_summary_comb<span class="sc">$</span>Char)){</span>
<span id="cb132-3"><a href="financial-score-card-model.html#cb132-3" tabindex="-1"></a>  <span class="cf">if</span> (iv_summary_comb<span class="sc">$</span>IV[i]<span class="sc">&gt;=</span>.<span class="dv">10</span>){</span>
<span id="cb132-4"><a href="financial-score-card-model.html#cb132-4" tabindex="-1"></a>    imp_vars_comb<span class="ot">=</span><span class="fu">append</span>(imp_vars_comb, iv_summary_comb<span class="sc">$</span>Char[i])</span>
<span id="cb132-5"><a href="financial-score-card-model.html#cb132-5" tabindex="-1"></a>  }</span>
<span id="cb132-6"><a href="financial-score-card-model.html#cb132-6" tabindex="-1"></a>}</span>
<span id="cb132-7"><a href="financial-score-card-model.html#cb132-7" tabindex="-1"></a></span>
<span id="cb132-8"><a href="financial-score-card-model.html#cb132-8" tabindex="-1"></a></span>
<span id="cb132-9"><a href="financial-score-card-model.html#cb132-9" tabindex="-1"></a><span class="co">#just using train 0 to just get the important vars names  </span></span>
<span id="cb132-10"><a href="financial-score-card-model.html#cb132-10" tabindex="-1"></a>train_comb0<span class="ot">=</span>train_comb[,<span class="fu">c</span>(imp_vars_comb)]</span>
<span id="cb132-11"><a href="financial-score-card-model.html#cb132-11" tabindex="-1"></a></span>
<span id="cb132-12"><a href="financial-score-card-model.html#cb132-12" tabindex="-1"></a>num_names_comb0 <span class="ot">=</span> <span class="fu">names</span>(train_comb0)[<span class="fu">sapply</span>(train_comb0, is.numeric)] <span class="co"># Gathering the names of numeric variables in data #</span></span>
<span id="cb132-13"><a href="financial-score-card-model.html#cb132-13" tabindex="-1"></a></span>
<span id="cb132-14"><a href="financial-score-card-model.html#cb132-14" tabindex="-1"></a>results_all_sig_comb_num <span class="ot">=</span> <span class="fu">list</span>() </span>
<span id="cb132-15"><a href="financial-score-card-model.html#cb132-15" tabindex="-1"></a>results_all_sig_comb_char <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb132-16"><a href="financial-score-card-model.html#cb132-16" tabindex="-1"></a></span>
<span id="cb132-17"><a href="financial-score-card-model.html#cb132-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(num_names_comb0)){</span>
<span id="cb132-18"><a href="financial-score-card-model.html#cb132-18" tabindex="-1"></a>  results_all_sig_comb_num[[num_names_comb0[i]]] <span class="ot">&lt;-</span> <span class="fu">smbinning</span>(<span class="at">df =</span> train_comb, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>, <span class="at">x =</span> num_names_comb0[i])</span>
<span id="cb132-19"><a href="financial-score-card-model.html#cb132-19" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="financial-score-card-model.html#cb134-1" tabindex="-1"></a>char_names_comb0 <span class="ot">=</span><span class="fu">names</span>(train_comb0)[<span class="fu">sapply</span>(train_comb0, is.factor)]</span>
<span id="cb134-2"><a href="financial-score-card-model.html#cb134-2" tabindex="-1"></a></span>
<span id="cb134-3"><a href="financial-score-card-model.html#cb134-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(char_names_comb0)){</span>
<span id="cb134-4"><a href="financial-score-card-model.html#cb134-4" tabindex="-1"></a>  results_all_sig_comb_char[[char_names_comb0[i]]] <span class="ot">&lt;-</span> <span class="fu">smbinning.factor</span>(<span class="at">df =</span> train_comb, <span class="at">y =</span> <span class="st">&quot;good&quot;</span>, <span class="at">x =</span> char_names_comb0[i])</span>
<span id="cb134-5"><a href="financial-score-card-model.html#cb134-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2

## Warning in rbind(deparse.level, ...): number of columns of result, 14, is not a multiple of vector length 13 of arg 2</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="financial-score-card-model.html#cb136-1" tabindex="-1"></a><span class="co"># Generating Variables of Bins #</span></span>
<span id="cb136-2"><a href="financial-score-card-model.html#cb136-2" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_num)) {</span>
<span id="cb136-3"><a href="financial-score-card-model.html#cb136-3" tabindex="-1"></a>  train_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> train_comb, <span class="at">ivout =</span> results_all_sig_comb_num[[i]], </span>
<span id="cb136-4"><a href="financial-score-card-model.html#cb136-4" tabindex="-1"></a>                         <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb136-5"><a href="financial-score-card-model.html#cb136-5" tabindex="-1"></a>}</span>
<span id="cb136-6"><a href="financial-score-card-model.html#cb136-6" tabindex="-1"></a></span>
<span id="cb136-7"><a href="financial-score-card-model.html#cb136-7" tabindex="-1"></a></span>
<span id="cb136-8"><a href="financial-score-card-model.html#cb136-8" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_char)) {</span>
<span id="cb136-9"><a href="financial-score-card-model.html#cb136-9" tabindex="-1"></a>  train_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> train_comb, <span class="at">ivout =</span> results_all_sig_comb_char[[i]], </span>
<span id="cb136-10"><a href="financial-score-card-model.html#cb136-10" tabindex="-1"></a>                                     <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb136-11"><a href="financial-score-card-model.html#cb136-11" tabindex="-1"></a>}</span>
<span id="cb136-12"><a href="financial-score-card-model.html#cb136-12" tabindex="-1"></a></span>
<span id="cb136-13"><a href="financial-score-card-model.html#cb136-13" tabindex="-1"></a><span class="co"># Generating Variables WOE Values from Bins just created #</span></span>
<span id="cb136-14"><a href="financial-score-card-model.html#cb136-14" tabindex="-1"></a></span>
<span id="cb136-15"><a href="financial-score-card-model.html#cb136-15" tabindex="-1"></a>results_all_sig_comb<span class="ot">=</span><span class="fu">append</span>(results_all_sig_comb_num,results_all_sig_comb_char)</span>
<span id="cb136-16"><a href="financial-score-card-model.html#cb136-16" tabindex="-1"></a></span>
<span id="cb136-17"><a href="financial-score-card-model.html#cb136-17" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb)) {</span>
<span id="cb136-18"><a href="financial-score-card-model.html#cb136-18" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(train_comb)) {</span>
<span id="cb136-19"><a href="financial-score-card-model.html#cb136-19" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb136-20"><a href="financial-score-card-model.html#cb136-20" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(train_comb[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb136-21"><a href="financial-score-card-model.html#cb136-21" tabindex="-1"></a></span>
<span id="cb136-22"><a href="financial-score-card-model.html#cb136-22" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb136-23"><a href="financial-score-card-model.html#cb136-23" tabindex="-1"></a>    </span>
<span id="cb136-24"><a href="financial-score-card-model.html#cb136-24" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb136-25"><a href="financial-score-card-model.html#cb136-25" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig_comb[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb136-26"><a href="financial-score-card-model.html#cb136-26" tabindex="-1"></a>      train_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb136-27"><a href="financial-score-card-model.html#cb136-27" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb136-28"><a href="financial-score-card-model.html#cb136-28" tabindex="-1"></a>      train_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb136-29"><a href="financial-score-card-model.html#cb136-29" tabindex="-1"></a>    }</span>
<span id="cb136-30"><a href="financial-score-card-model.html#cb136-30" tabindex="-1"></a>  }</span>
<span id="cb136-31"><a href="financial-score-card-model.html#cb136-31" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="building-model-on-combined-data" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Building Model On Combined Data<a href="financial-score-card-model.html#building-model-on-combined-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="financial-score-card-model.html#cb137-1" tabindex="-1"></a>test_comb<span class="sc">$</span>GB<span class="ot">=</span><span class="fu">ifelse</span>(test_comb<span class="sc">$</span>GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb137-2"><a href="financial-score-card-model.html#cb137-2" tabindex="-1"></a>train_comb<span class="sc">$</span>GB<span class="ot">=</span><span class="fu">ifelse</span>(train_comb<span class="sc">$</span>GB<span class="sc">==</span><span class="st">&quot;0&quot;</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb137-3"><a href="financial-score-card-model.html#cb137-3" tabindex="-1"></a></span>
<span id="cb137-4"><a href="financial-score-card-model.html#cb137-4" tabindex="-1"></a><span class="co">#watch out for quasi complete sep in the categorical vars--might need to combine levels</span></span>
<span id="cb137-5"><a href="financial-score-card-model.html#cb137-5" tabindex="-1"></a>final_score <span class="ot">&lt;-</span> <span class="fu">glm</span>(GB <span class="sc">~</span> </span>
<span id="cb137-6"><a href="financial-score-card-model.html#cb137-6" tabindex="-1"></a>                       TMJOB1_WOE <span class="sc">+</span> </span>
<span id="cb137-7"><a href="financial-score-card-model.html#cb137-7" tabindex="-1"></a>                       INCOME_WOE <span class="sc">+</span></span>
<span id="cb137-8"><a href="financial-score-card-model.html#cb137-8" tabindex="-1"></a>                       CARDS_WOE <span class="sc">+</span> </span>
<span id="cb137-9"><a href="financial-score-card-model.html#cb137-9" tabindex="-1"></a>                       PERS_H_WOE, </span>
<span id="cb137-10"><a href="financial-score-card-model.html#cb137-10" tabindex="-1"></a>                       <span class="co">#EC_CARD_WOE, #dogwater predictor</span></span>
<span id="cb137-11"><a href="financial-score-card-model.html#cb137-11" tabindex="-1"></a>                     <span class="at">data =</span> train_comb,</span>
<span id="cb137-12"><a href="financial-score-card-model.html#cb137-12" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="fu">as.numeric</span>(train_comb<span class="sc">$</span>weight_ar), </span>
<span id="cb137-13"><a href="financial-score-card-model.html#cb137-13" tabindex="-1"></a>                     <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="financial-score-card-model.html#cb139-1" tabindex="-1"></a><span class="fu">summary</span>(final_score)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = GB ~ TMJOB1_WOE + INCOME_WOE + CARDS_WOE + PERS_H_WOE, 
##     family = &quot;binomial&quot;, data = train_comb, weights = as.numeric(train_comb$weight_ar))
## 
## Coefficients:
##             Estimate Std. Error  z value             Pr(&gt;|z|)    
## (Intercept) -3.14125    0.02248 -139.728 &lt; 0.0000000000000002 ***
## TMJOB1_WOE  -0.79840    0.04955  -16.113 &lt; 0.0000000000000002 ***
## INCOME_WOE  -0.35378    0.06194   -5.712         0.0000000112 ***
## CARDS_WOE   -0.75346    0.06927  -10.877 &lt; 0.0000000000000002 ***
## PERS_H_WOE  -0.80497    0.04482  -17.961 &lt; 0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 19670  on 3149  degrees of freedom
## Residual deviance: 18374  on 3145  degrees of freedom
## AIC: 21647
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="financial-score-card-model.html#cb141-1" tabindex="-1"></a>train</span></code></pre></div>
<pre><code>##      CHILDREN PERS_H TMADD TMJOB1 TEL NMBLOAN FINLOAN INCOME EC_CARD BUREAU LOCATION LOANS REGN CASH             PRODUCT RESID
## 1064        0      1    42     27   2       2       1      0       0      1        1     4    4 2000 Radio or TV or Hifi Lease
## 2376        0      1   240     27   2       0       0      0       1      3        1     0    6  500                Cars Lease
## 2861        0      1     9      6   1       0       1   1900       0      3        1     0    4 1000 Radio or TV or Hifi  &lt;NA&gt;
## 2277        1      2    18     30   1       0       0   2000       0      3        1     0    0 1700 Furniture or Carpet Lease
## 2773        1      3    15      9   2       0       0   1500       0      3        1     0    6 1600 Radio or TV or Hifi  &lt;NA&gt;
## 387         0      2   120    120   1       0       0   1800       1      1        1     1    0 1200 Radio or TV or Hifi  &lt;NA&gt;
## 1108        2      4    30     24   2       0       0   4000       0      1        1     1    5 1300 Radio or TV or Hifi Lease
## 2363        1      2    96     27   2       0       1  10000       0      1        1     1    0 1700 Radio or TV or Hifi Lease
## 1445        0      1    42      6   2       2       1   3000       0      1        1     1    3  500 Dept. Store or Mail Lease
## 2680        1      3    30     12   2       0       0   1600       0      1        1     2    9 1900                Cars Lease
## 1922        0      1   240     60   1       2       0      0       1      1        1     1    0  700 Furniture or Carpet Lease
## 2265        0      1     3     30   2       2       1      0       1      1        1     2    5 1100                Cars Lease
## 596         2      4    18     66   2       0       1   5000       0      3        1     0    8  900                Cars Lease
## 1381        3      5    36      9   2       2       1   2500       0      1        1     2    0  600 Radio or TV or Hifi Lease
## 2204        0      1   144     36   1       0       0   1700       0      3        1     0    5  500 Radio or TV or Hifi  &lt;NA&gt;
## 492         0      1   240     96   1       0       1      0       1      1        1     1    0 1300                Cars Lease
## 1287        0      1   168     15   2       0       0   2000       1      3        1     0    2 1000 Radio or TV or Hifi  &lt;NA&gt;
## 2161        0      1   264     39   1       0       0   1700       0      3        1     0    0 3000 Furniture or Carpet Lease
## 2427        2      4    84     24   1       0       0   1900       0      3        1     0    0  800 Dept. Store or Mail  &lt;NA&gt;
## 854         1      3    30     39   2       0       0   1800       0      1        1     1    7  500 Radio or TV or Hifi Lease
## 800         0      1   120     45   2       2       1   2500       0      1        1     1    4 1200 Radio or TV or Hifi  &lt;NA&gt;
## 577         1      3    72     72   2       2       1      0       1      1        1     1    3 1100 Radio or TV or Hifi Lease
## 1390        0      1    66      9   1       0       0      0       1      1        1     1    0 1400 Radio or TV or Hifi  &lt;NA&gt;
## 180         1      3   120    216   2       2       1   3300       0      1        1     1    4  500 Furniture or Carpet Lease
## 1563        2      4    84    216   2       0       1   2300       0      1        1     1    5  900 Radio or TV or Hifi Lease
## 2706        4      5   108     12   2       0       0   1000       0      1        1     0    3  500 Radio or TV or Hifi Lease
##                    PROF             CAR            CARDS GB _freq_ good TMJOB1_bin INCOME_bin PERS_H_bin               CARDS_bin EC_CARD_bin
## 1064   Self-employed pe             Car Mastercard/Euroc  0     30    1   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39; 02 = &#39;Mastercard/Euroc&#39;    01 = &#39;0&#39;
## 2376             Others             Car      Cheque card  1      1    0   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 2861      Civil Service Without Vehicle  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2277   Military Service             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   02 = &#39;2&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2773             Others Without Vehicle  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 387              Others             Car      Cheque card  0     30    1  02 &lt;= 144     02 &gt; 0   02 = &#39;2&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 1108             Others             Car  no credit cards  0     30    1   01 &lt;= 30     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2363   Self-employed pe             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   02 = &#39;2&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 1445   Food or Building             Car  no credit cards  0     30    1   01 &lt;= 30     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2680             Others             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 1922             Others Without Vehicle      Cheque card  1      1    0  02 &lt;= 144    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 2265             Others             Car      Cheque card  1      1    0   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 596              Others             Car  no credit cards  0     30    1  02 &lt;= 144     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 1381             Others             Car  no credit cards  0     30    1   01 &lt;= 30     02 &gt; 0   05 = &#39;5&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2204             Others Without Vehicle  no credit cards  1      1    0  02 &lt;= 144     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 492              Others             Car      Cheque card  0     30    1  02 &lt;= 144    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 1287             Others Without Vehicle      Cheque card  0     30    1   01 &lt;= 30     02 &gt; 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 2161             Others             Car  no credit cards  1      1    0  02 &lt;= 144     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2427   Food or Building Without Vehicle  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 854              Others Without Vehicle  no credit cards  0     30    1  02 &lt;= 144     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 800  State or Steel Ind Without Vehicle  no credit cards  0     30    1  02 &lt;= 144     02 &gt; 0   01 = &#39;1&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 577              Others             Car      Cheque card  0     30    1  02 &lt;= 144    01 &lt;= 0   03 = &#39;3&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 1390   Food or Building             Car      Cheque card  0     30    1   01 &lt;= 30    01 &lt;= 0   01 = &#39;1&#39;      01 = &#39;Cheque card&#39;    02 = &#39;1&#39;
## 180              Others Without Vehicle  no credit cards  0     30    1   03 &gt; 144     02 &gt; 0   03 = &#39;3&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 1563   Food or Building             Car  no credit cards  1      1    0   03 &gt; 144     02 &gt; 0   04 = &#39;4&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
## 2706   Food or Building             Car  no credit cards  1      1    0   01 &lt;= 30     02 &gt; 0   05 = &#39;5&#39;  03 = &#39;no credit cards&#39;    01 = &#39;0&#39;
##      TMJOB1_WOE INCOME_WOE PERS_H_WOE CARDS_WOE EC_CARD_WOE      pred TMJOB1_points INCOME_points CARDS_points PERS_H_points    Score
## 1064    -0.3991     0.6767    -0.5239    0.8075     -0.2313 0.3374844      57.36191      77.46943    146.09702      51.63192 332.5603
## 2376    -0.3991     0.6767    -0.5239    0.6846      0.6846 0.3678084      57.36191      77.46943    136.51072      51.63192 322.9740
## 2861    -0.3991    -0.2075    -0.5239   -0.2663     -0.2313 0.5949340      57.36191      84.84137     62.33974      51.63192 256.1750
## 2277    -0.3991    -0.2075     0.4283   -0.2663     -0.2313 0.3992090      57.36191      84.84137     62.33974     108.84651 313.3895
## 2773    -0.3991    -0.2075     0.3172   -0.2663     -0.2313 0.4215977      57.36191      84.84137     62.33974     102.17087 306.7139
## 387      0.0533    -0.2075     0.4283    0.6846      0.6846 0.1368591      86.55021      84.84137    136.51072     108.84651 416.7488
## 1108    -0.3991    -0.2075     0.2948   -0.2663     -0.2313 0.4261542      57.36191      84.84137     62.33974     100.82493 305.3680
## 2363    -0.3991    -0.2075     0.4283   -0.2663     -0.2313 0.3992090      57.36191      84.84137     62.33974     108.84651 313.3895
## 1445    -0.3991    -0.2075    -0.5239   -0.2663     -0.2313 0.5949340      57.36191      84.84137     62.33974      51.63192 256.1750
## 2680    -0.3991    -0.2075     0.3172   -0.2663     -0.2313 0.4215977      57.36191      84.84137     62.33974     102.17087 306.7139
## 1922     0.0533     0.6767    -0.5239    0.6846      0.6846 0.2796363      86.55021      77.46943    136.51072      51.63192 352.1623
## 2265    -0.3991     0.6767    -0.5239    0.6846      0.6846 0.3678084      57.36191      77.46943    136.51072      51.63192 322.9740
## 596      0.0533    -0.2075     0.2948   -0.2663     -0.2313 0.3313257      86.55021      84.84137     62.33974     100.82493 334.5563
## 1381    -0.3991    -0.2075     0.0426   -0.2663     -0.2313 0.4781434      57.36191      84.84137     62.33974      85.67105 290.2141
## 2204     0.0533    -0.2075    -0.5239   -0.2663     -0.2313 0.4949414      86.55021      84.84137     62.33974      51.63192 285.3632
## 492      0.0533     0.6767    -0.5239    0.6846      0.6846 0.2796363      86.55021      77.46943    136.51072      51.63192 352.1623
## 1287    -0.3991    -0.2075    -0.5239    0.6846      0.6846 0.3443819      57.36191      84.84137    136.51072      51.63192 330.3459
## 2161     0.0533    -0.2075    -0.5239   -0.2663     -0.2313 0.4949414      86.55021      84.84137     62.33974      51.63192 285.3632
## 2427    -0.3991    -0.2075     0.2948   -0.2663     -0.2313 0.4261542      57.36191      84.84137     62.33974     100.82493 305.3680
## 854      0.0533    -0.2075     0.3172   -0.2663     -0.2313 0.3272050      86.55021      84.84137     62.33974     102.17087 335.9022
## 800      0.0533    -0.2075    -0.5239   -0.2663     -0.2313 0.4949414      86.55021      84.84137     62.33974      51.63192 285.3632
## 577      0.0533     0.6767     0.3172    0.6846      0.6846 0.1615304      86.55021      77.46943    136.51072     102.17087 402.7012
## 1390    -0.3991     0.6767    -0.5239    0.6846      0.6846 0.3678084      57.36191      77.46943    136.51072      51.63192 322.9740
## 180      0.9852    -0.2075     0.3172   -0.2663     -0.2313 0.1744569     146.67527      84.84137     62.33974     102.17087 396.0273
## 1563     0.9852    -0.2075     0.2948   -0.2663     -0.2313 0.1771605     146.67527      84.84137     62.33974     100.82493 394.6813
## 2706    -0.3991    -0.2075     0.0426   -0.2663     -0.2313 0.4781434      57.36191      84.84137     62.33974      85.67105 290.2141
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 2074 rows ]</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="financial-score-card-model.html#cb143-1" tabindex="-1"></a>train_comb<span class="sc">$</span>pred <span class="ot">&lt;-</span> final_score<span class="sc">$</span>fitted.values</span>
<span id="cb143-2"><a href="financial-score-card-model.html#cb143-2" tabindex="-1"></a></span>
<span id="cb143-3"><a href="financial-score-card-model.html#cb143-3" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##   Overall Performance Metrics 
##   -------------------------------------------------- 
##                     KS : 0.3276 (Fair)
##                    AUC : 0.7154 (Fair)
## 
##   Classification Matrix 
##   -------------------------------------------------- 
##            Cutoff (&gt;=) : 0.0415 (Optimal)
##    True Positives (TP) : 1253
##   False Positives (FP) : 486
##   False Negatives (FN) : 560
##    True Negatives (TN) : 851
##    Total Positives (P) : 1813
##    Total Negatives (N) : 1337
## 
##   Business/Performance Metrics 
##   -------------------------------------------------- 
##       %Records&gt;=Cutoff : 0.5521
##              Good Rate : 0.7205 (Vs 0.5756 Overall)
##               Bad Rate : 0.2795 (Vs 0.4244 Overall)
##         Accuracy (ACC) : 0.6679
##      Sensitivity (TPR) : 0.6911
##  False Neg. Rate (FNR) : 0.3089
##  False Pos. Rate (FPR) : 0.3635
##      Specificity (TNR) : 0.6365
##        Precision (PPV) : 0.7205
##   False Discovery Rate : 0.2795
##     False Omision Rate : 0.3969
##   Inv. Precision (NPV) : 0.6031
## 
##   Note: 0 rows deleted due to missing data.</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="financial-score-card-model.html#cb145-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;ks&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="financial-score-card-model.html#cb146-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> train_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;auc&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-32-2.png" width="672" />
checking model on our combined test data</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="financial-score-card-model.html#cb147-1" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_num)) {</span>
<span id="cb147-2"><a href="financial-score-card-model.html#cb147-2" tabindex="-1"></a>  test_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.gen</span>(<span class="at">df =</span> test_comb, <span class="at">ivout =</span> results_all_sig_comb_num[[i]], </span>
<span id="cb147-3"><a href="financial-score-card-model.html#cb147-3" tabindex="-1"></a>                             <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_num[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb147-4"><a href="financial-score-card-model.html#cb147-4" tabindex="-1"></a>}</span>
<span id="cb147-5"><a href="financial-score-card-model.html#cb147-5" tabindex="-1"></a></span>
<span id="cb147-6"><a href="financial-score-card-model.html#cb147-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb_char)) {</span>
<span id="cb147-7"><a href="financial-score-card-model.html#cb147-7" tabindex="-1"></a>  test_comb <span class="ot">&lt;-</span> <span class="fu">smbinning.factor.gen</span>(<span class="at">df =</span> test_comb, <span class="at">ivout =</span> results_all_sig_comb_char[[i]], </span>
<span id="cb147-8"><a href="financial-score-card-model.html#cb147-8" tabindex="-1"></a>                                    <span class="at">chrname =</span> <span class="fu">paste</span>(results_all_sig_comb_char[[i]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb147-9"><a href="financial-score-card-model.html#cb147-9" tabindex="-1"></a>}</span>
<span id="cb147-10"><a href="financial-score-card-model.html#cb147-10" tabindex="-1"></a></span>
<span id="cb147-11"><a href="financial-score-card-model.html#cb147-11" tabindex="-1"></a></span>
<span id="cb147-12"><a href="financial-score-card-model.html#cb147-12" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(results_all_sig_comb)) {</span>
<span id="cb147-13"><a href="financial-score-card-model.html#cb147-13" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(test_comb)) {</span>
<span id="cb147-14"><a href="financial-score-card-model.html#cb147-14" tabindex="-1"></a>    bin_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_bin&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb147-15"><a href="financial-score-card-model.html#cb147-15" tabindex="-1"></a>    bin <span class="ot">&lt;-</span> <span class="fu">substr</span>(test_comb[[bin_name]][i], <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb147-16"><a href="financial-score-card-model.html#cb147-16" tabindex="-1"></a>    </span>
<span id="cb147-17"><a href="financial-score-card-model.html#cb147-17" tabindex="-1"></a>    woe_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(results_all_sig_comb[[j]]<span class="sc">$</span>x, <span class="st">&quot;_WOE&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb147-18"><a href="financial-score-card-model.html#cb147-18" tabindex="-1"></a>    </span>
<span id="cb147-19"><a href="financial-score-card-model.html#cb147-19" tabindex="-1"></a>    <span class="cf">if</span>(bin <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb147-20"><a href="financial-score-card-model.html#cb147-20" tabindex="-1"></a>      bin <span class="ot">&lt;-</span> <span class="fu">dim</span>(results_all_sig_comb[[j]]<span class="sc">$</span>ivtable)[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb147-21"><a href="financial-score-card-model.html#cb147-21" tabindex="-1"></a>      test_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb147-22"><a href="financial-score-card-model.html#cb147-22" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb147-23"><a href="financial-score-card-model.html#cb147-23" tabindex="-1"></a>      test_comb[[woe_name]][i] <span class="ot">&lt;-</span> results_all_sig_comb[[j]]<span class="sc">$</span>ivtable[bin, <span class="st">&quot;WoE&quot;</span>]</span>
<span id="cb147-24"><a href="financial-score-card-model.html#cb147-24" tabindex="-1"></a>    }</span>
<span id="cb147-25"><a href="financial-score-card-model.html#cb147-25" tabindex="-1"></a>  }</span>
<span id="cb147-26"><a href="financial-score-card-model.html#cb147-26" tabindex="-1"></a>}</span>
<span id="cb147-27"><a href="financial-score-card-model.html#cb147-27" tabindex="-1"></a></span>
<span id="cb147-28"><a href="financial-score-card-model.html#cb147-28" tabindex="-1"></a>test_comb<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_score, <span class="at">newdata=</span>test_comb, <span class="at">type=</span><span class="st">&#39;response&#39;</span>)</span>
<span id="cb147-29"><a href="financial-score-card-model.html#cb147-29" tabindex="-1"></a></span>
<span id="cb147-30"><a href="financial-score-card-model.html#cb147-30" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## 
##   Overall Performance Metrics 
##   -------------------------------------------------- 
##                     KS : 0.3180 (Fair)
##                    AUC : 0.7187 (Fair)
## 
##   Classification Matrix 
##   -------------------------------------------------- 
##            Cutoff (&gt;=) : 0.0461 (Optimal)
##    True Positives (TP) : 417
##   False Positives (FP) : 170
##   False Negatives (FN) : 296
##    True Negatives (TN) : 467
##    Total Positives (P) : 713
##    Total Negatives (N) : 637
## 
##   Business/Performance Metrics 
##   -------------------------------------------------- 
##       %Records&gt;=Cutoff : 0.4348
##              Good Rate : 0.7104 (Vs 0.5281 Overall)
##               Bad Rate : 0.2896 (Vs 0.4719 Overall)
##         Accuracy (ACC) : 0.6548
##      Sensitivity (TPR) : 0.5849
##  False Neg. Rate (FNR) : 0.4151
##  False Pos. Rate (FPR) : 0.2669
##      Specificity (TNR) : 0.7331
##        Precision (PPV) : 0.7104
##   False Discovery Rate : 0.2896
##     False Omision Rate : 0.3879
##   Inv. Precision (NPV) : 0.6121
## 
##   Note: 0 rows deleted due to missing data.</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="financial-score-card-model.html#cb149-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;ks&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="financial-score-card-model.html#cb150-1" tabindex="-1"></a><span class="fu">smbinning.metrics</span>(<span class="at">dataset =</span> test_comb, <span class="at">prediction =</span> <span class="st">&quot;pred&quot;</span>, <span class="at">actualclass =</span> <span class="st">&quot;GB&quot;</span>, <span class="at">report =</span> <span class="dv">0</span>, <span class="at">plot =</span> <span class="st">&quot;auc&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-33-2.png" width="672" /></p>
</div>
<div id="adding-scores-to-train-comb-from-final-model" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Adding Scores to Train Comb from Final Model<a href="financial-score-card-model.html#adding-scores-to-train-comb-from-final-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our Points should almost double from our original model since we are weighting the good in the accepts as around 46 (about an aditional half of their original score) whereas in just the accepts we are weighting them as 30, we are also weighting the bads in the accepts as 1.5 also an additional half of their original score and giving just the rejects a weight of 1 this should ultimately cause the coefficients of our WoE vars to increase in our final model in comparison to our initial model resulting in almost doubling the points individuals get for each bin they fall in.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="financial-score-card-model.html#cb151-1" tabindex="-1"></a><span class="co"># Add Scores to Initial Model #</span></span>
<span id="cb151-2"><a href="financial-score-card-model.html#cb151-2" tabindex="-1"></a>pdo_f <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb151-3"><a href="financial-score-card-model.html#cb151-3" tabindex="-1"></a>score_f <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb151-4"><a href="financial-score-card-model.html#cb151-4" tabindex="-1"></a>odds_f <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb151-5"><a href="financial-score-card-model.html#cb151-5" tabindex="-1"></a>fact_f <span class="ot">&lt;-</span> pdo_f<span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)</span>
<span id="cb151-6"><a href="financial-score-card-model.html#cb151-6" tabindex="-1"></a>os_f <span class="ot">&lt;-</span> score_f <span class="sc">-</span> fact_f<span class="sc">*</span><span class="fu">log</span>(odds_f)</span>
<span id="cb151-7"><a href="financial-score-card-model.html#cb151-7" tabindex="-1"></a>var_names_f <span class="ot">&lt;-</span> <span class="fu">names</span>(final_score<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb151-8"><a href="financial-score-card-model.html#cb151-8" tabindex="-1"></a></span>
<span id="cb151-9"><a href="financial-score-card-model.html#cb151-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> var_names_f) {</span>
<span id="cb151-10"><a href="financial-score-card-model.html#cb151-10" tabindex="-1"></a>  beta_f <span class="ot">&lt;-</span> final_score<span class="sc">$</span>coefficients[i]</span>
<span id="cb151-11"><a href="financial-score-card-model.html#cb151-11" tabindex="-1"></a>  beta0_f <span class="ot">&lt;-</span> final_score<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb151-12"><a href="financial-score-card-model.html#cb151-12" tabindex="-1"></a>  nvar_f <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names_f)</span>
<span id="cb151-13"><a href="financial-score-card-model.html#cb151-13" tabindex="-1"></a>  WOE_var_f <span class="ot">&lt;-</span> train_comb[[i]]</span>
<span id="cb151-14"><a href="financial-score-card-model.html#cb151-14" tabindex="-1"></a>  points_name_f <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(i, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>), <span class="st">&quot;points&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb151-15"><a href="financial-score-card-model.html#cb151-15" tabindex="-1"></a></span>
<span id="cb151-16"><a href="financial-score-card-model.html#cb151-16" tabindex="-1"></a>  train_comb[[points_name_f]] <span class="ot">&lt;-</span> <span class="sc">-</span>(WOE_var_f<span class="sc">*</span>(beta_f) <span class="sc">+</span> (beta0_f<span class="sc">/</span>nvar_f))<span class="sc">*</span>fact_f <span class="sc">+</span> os_f<span class="sc">/</span>nvar_f</span>
<span id="cb151-17"><a href="financial-score-card-model.html#cb151-17" tabindex="-1"></a>}</span>
<span id="cb151-18"><a href="financial-score-card-model.html#cb151-18" tabindex="-1"></a></span>
<span id="cb151-19"><a href="financial-score-card-model.html#cb151-19" tabindex="-1"></a></span>
<span id="cb151-20"><a href="financial-score-card-model.html#cb151-20" tabindex="-1"></a>colini_f <span class="ot">&lt;-</span> (<span class="fu">ncol</span>(train_comb)<span class="sc">-</span>nvar_f <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb151-21"><a href="financial-score-card-model.html#cb151-21" tabindex="-1"></a>colend_f <span class="ot">&lt;-</span> <span class="fu">ncol</span>(train_comb)</span>
<span id="cb151-22"><a href="financial-score-card-model.html#cb151-22" tabindex="-1"></a>train_comb<span class="sc">$</span>Score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(train_comb[, colini_f<span class="sc">:</span>colend_f])</span>
<span id="cb151-23"><a href="financial-score-card-model.html#cb151-23" tabindex="-1"></a></span>
<span id="cb151-24"><a href="financial-score-card-model.html#cb151-24" tabindex="-1"></a><span class="fu">hist</span>(train_comb<span class="sc">$</span>Score, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">350</span>,<span class="dv">700</span>), <span class="at">main =</span> <span class="st">&quot;Distribution of Train Combined Scores&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="add-scores-to-test-comb-from-final-model" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Add Scores to Test Comb from Final Model<a href="financial-score-card-model.html#add-scores-to-test-comb-from-final-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="financial-score-card-model.html#cb152-1" tabindex="-1"></a><span class="co">#using the same initial values as above</span></span>
<span id="cb152-2"><a href="financial-score-card-model.html#cb152-2" tabindex="-1"></a>pdo_f <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb152-3"><a href="financial-score-card-model.html#cb152-3" tabindex="-1"></a>score_f <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb152-4"><a href="financial-score-card-model.html#cb152-4" tabindex="-1"></a>odds_f <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb152-5"><a href="financial-score-card-model.html#cb152-5" tabindex="-1"></a>fact_f <span class="ot">&lt;-</span> pdo_f<span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)</span>
<span id="cb152-6"><a href="financial-score-card-model.html#cb152-6" tabindex="-1"></a>os_f <span class="ot">&lt;-</span> score_f <span class="sc">-</span> fact_f<span class="sc">*</span><span class="fu">log</span>(odds_f)</span>
<span id="cb152-7"><a href="financial-score-card-model.html#cb152-7" tabindex="-1"></a>var_names_f <span class="ot">&lt;-</span> <span class="fu">names</span>(final_score<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb152-8"><a href="financial-score-card-model.html#cb152-8" tabindex="-1"></a></span>
<span id="cb152-9"><a href="financial-score-card-model.html#cb152-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> var_names) {</span>
<span id="cb152-10"><a href="financial-score-card-model.html#cb152-10" tabindex="-1"></a>  beta_f <span class="ot">&lt;-</span> final_score<span class="sc">$</span>coefficients[i]</span>
<span id="cb152-11"><a href="financial-score-card-model.html#cb152-11" tabindex="-1"></a>  beta0_f <span class="ot">&lt;-</span> final_score<span class="sc">$</span>coefficients[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb152-12"><a href="financial-score-card-model.html#cb152-12" tabindex="-1"></a>  nvar_f <span class="ot">&lt;-</span> <span class="fu">length</span>(var_names_f)</span>
<span id="cb152-13"><a href="financial-score-card-model.html#cb152-13" tabindex="-1"></a>  WOE_var_f <span class="ot">&lt;-</span> test_comb[[i]]</span>
<span id="cb152-14"><a href="financial-score-card-model.html#cb152-14" tabindex="-1"></a>  points_name_f <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">str_sub</span>(i, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>), <span class="st">&quot;points&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb152-15"><a href="financial-score-card-model.html#cb152-15" tabindex="-1"></a>  </span>
<span id="cb152-16"><a href="financial-score-card-model.html#cb152-16" tabindex="-1"></a>  test_comb[[points_name_f]] <span class="ot">&lt;-</span> <span class="sc">-</span>(WOE_var_f<span class="sc">*</span>(beta_f) <span class="sc">+</span> (beta0_f<span class="sc">/</span>nvar_f))<span class="sc">*</span>fact_f <span class="sc">+</span> os_f<span class="sc">/</span>nvar_f</span>
<span id="cb152-17"><a href="financial-score-card-model.html#cb152-17" tabindex="-1"></a>}</span>
<span id="cb152-18"><a href="financial-score-card-model.html#cb152-18" tabindex="-1"></a></span>
<span id="cb152-19"><a href="financial-score-card-model.html#cb152-19" tabindex="-1"></a>colini_f <span class="ot">&lt;-</span> (<span class="fu">ncol</span>(test_comb)<span class="sc">-</span>nvar_f <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb152-20"><a href="financial-score-card-model.html#cb152-20" tabindex="-1"></a>colend_f <span class="ot">&lt;-</span> <span class="fu">ncol</span>(test_comb)</span>
<span id="cb152-21"><a href="financial-score-card-model.html#cb152-21" tabindex="-1"></a>test_comb<span class="sc">$</span>Score <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(test_comb[, colini_f<span class="sc">:</span>colend_f])</span>
<span id="cb152-22"><a href="financial-score-card-model.html#cb152-22" tabindex="-1"></a></span>
<span id="cb152-23"><a href="financial-score-card-model.html#cb152-23" tabindex="-1"></a><span class="fu">hist</span>(test_comb<span class="sc">$</span>Score, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">main =</span> <span class="st">&quot;Distribution of Test Comb Scores&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="financial-score-card-model.html#cb153-1" tabindex="-1"></a>scored_comb <span class="ot">&lt;-</span> <span class="fu">rbind</span>(train_comb, test_comb)</span>
<span id="cb153-2"><a href="financial-score-card-model.html#cb153-2" tabindex="-1"></a><span class="fu">hist</span>(scored_comb<span class="sc">$</span>Score, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">main =</span> <span class="st">&quot;Distribution of Scores&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
<div id="plots" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Plots<a href="financial-score-card-model.html#plots" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>DECILE PLOT</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="financial-score-card-model.html#cb154-1" tabindex="-1"></a>accepts_scored_comb<span class="ot">=</span>scored_comb</span>
<span id="cb154-2"><a href="financial-score-card-model.html#cb154-2" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> <span class="fu">quantile</span>(accepts_scored_comb<span class="sc">$</span>Score, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.10</span>))</span>
<span id="cb154-3"><a href="financial-score-card-model.html#cb154-3" tabindex="-1"></a>accepts_scored_comb<span class="sc">$</span>Score.QBin <span class="ot">&lt;-</span> <span class="fu">cut</span>(accepts_scored_comb<span class="sc">$</span>Score, <span class="at">breaks=</span>cutpoints, <span class="at">include.lowest=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-4"><a href="financial-score-card-model.html#cb154-4" tabindex="-1"></a>Default.QBin.pop <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(accepts_scored_comb<span class="sc">$</span>Score.QBin, accepts_scored_comb<span class="sc">$</span>GB)[,<span class="dv">2</span>]<span class="sc">/</span>(<span class="fu">table</span>(accepts_scored_comb<span class="sc">$</span>Score.QBin, accepts_scored_comb<span class="sc">$</span>GB)[,<span class="dv">2</span>] <span class="sc">+</span> <span class="fu">table</span>(accepts_scored_comb<span class="sc">$</span>Score.QBin, accepts_scored_comb<span class="sc">$</span>GB)[,<span class="dv">1</span>]<span class="sc">*</span><span class="fl">30.95975</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb154-5"><a href="financial-score-card-model.html#cb154-5" tabindex="-1"></a></span>
<span id="cb154-6"><a href="financial-score-card-model.html#cb154-6" tabindex="-1"></a><span class="fu">print</span>(Default.QBin.pop)</span></code></pre></div>
<pre><code>## [405,428] (428,452] (452,468] (468,491] (491,507] (507,521] (521,527] (527,569] (569,585] (585,666] 
##     15.20      8.79      7.11      5.51      4.28      3.52      3.17      2.33      1.28      1.20</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="financial-score-card-model.html#cb156-1" tabindex="-1"></a><span class="fu">barplot</span>(Default.QBin.pop, </span>
<span id="cb156-2"><a href="financial-score-card-model.html#cb156-2" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Default Decile Plot&quot;</span>, </span>
<span id="cb156-3"><a href="financial-score-card-model.html#cb156-3" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Deciles of Scorecard&quot;</span>,</span>
<span id="cb156-4"><a href="financial-score-card-model.html#cb156-4" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Default Rate (%)&quot;</span>,</span>
<span id="cb156-5"><a href="financial-score-card-model.html#cb156-5" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">saturation</span>(heat.colors, <span class="fu">scalefac</span>(<span class="fl">0.8</span>))(<span class="dv">10</span>))</span>
<span id="cb156-6"><a href="financial-score-card-model.html#cb156-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">3.23</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb156-7"><a href="financial-score-card-model.html#cb156-7" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">11.5</span>, <span class="dv">5</span>, <span class="st">&quot;Current = 3.23%&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Plotting Default, Acceptance, &amp; Profit By Score</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="financial-score-card-model.html#cb157-1" tabindex="-1"></a><span class="co"># Plotting Default, Acceptance, &amp; Profit By Score #</span></span>
<span id="cb157-2"><a href="financial-score-card-model.html#cb157-2" tabindex="-1"></a>def <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb157-3"><a href="financial-score-card-model.html#cb157-3" tabindex="-1"></a>acc <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb157-4"><a href="financial-score-card-model.html#cb157-4" tabindex="-1"></a>prof <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb157-5"><a href="financial-score-card-model.html#cb157-5" tabindex="-1"></a>score <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb157-6"><a href="financial-score-card-model.html#cb157-6" tabindex="-1"></a></span>
<span id="cb157-7"><a href="financial-score-card-model.html#cb157-7" tabindex="-1"></a>cost <span class="ot">&lt;-</span> <span class="dv">52000</span></span>
<span id="cb157-8"><a href="financial-score-card-model.html#cb157-8" tabindex="-1"></a>profit <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb157-9"><a href="financial-score-card-model.html#cb157-9" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">min</span>(<span class="fu">floor</span>(train_comb<span class="sc">$</span>Score))<span class="sc">:</span><span class="fu">max</span>(<span class="fu">floor</span>(train_comb<span class="sc">$</span>Score))){</span>
<span id="cb157-10"><a href="financial-score-card-model.html#cb157-10" tabindex="-1"></a>  score[i <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">floor</span>(train_comb<span class="sc">$</span>Score)) <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> i</span>
<span id="cb157-11"><a href="financial-score-card-model.html#cb157-11" tabindex="-1"></a>  def[i <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">floor</span>(train_comb<span class="sc">$</span>Score)) <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> </span>
<span id="cb157-12"><a href="financial-score-card-model.html#cb157-12" tabindex="-1"></a>    <span class="dv">100</span><span class="sc">*</span><span class="fu">sum</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i)])<span class="sc">/</span>(<span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i <span class="sc">&amp;</span> train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">+</span></span>
<span id="cb157-13"><a href="financial-score-card-model.html#cb157-13" tabindex="-1"></a>                                                            <span class="fl">30.95975</span><span class="sc">*</span><span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i <span class="sc">&amp;</span> train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">0</span>)]))</span>
<span id="cb157-14"><a href="financial-score-card-model.html#cb157-14" tabindex="-1"></a>  acc[i <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">floor</span>(train_comb<span class="sc">$</span>Score)) <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> </span>
<span id="cb157-15"><a href="financial-score-card-model.html#cb157-15" tabindex="-1"></a>    <span class="dv">100</span><span class="sc">*</span>(<span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i <span class="sc">&amp;</span> </span>
<span id="cb157-16"><a href="financial-score-card-model.html#cb157-16" tabindex="-1"></a>                                      train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">+</span> <span class="fl">30.95975</span><span class="sc">*</span><span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i <span class="sc">&amp;</span> </span>
<span id="cb157-17"><a href="financial-score-card-model.html#cb157-17" tabindex="-1"></a>                                             train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">0</span>)]))<span class="sc">/</span>(<span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">+</span> </span>
<span id="cb157-18"><a href="financial-score-card-model.html#cb157-18" tabindex="-1"></a>                                                                                             <span class="fl">30.95975</span><span class="sc">*</span><span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>GB <span class="sc">==</span> </span>
<span id="cb157-19"><a href="financial-score-card-model.html#cb157-19" tabindex="-1"></a>                                                                                                                               <span class="dv">0</span>)]))</span>
<span id="cb157-20"><a href="financial-score-card-model.html#cb157-20" tabindex="-1"></a>  prof[i <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">floor</span>(train_comb<span class="sc">$</span>Score)) <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> </span>
<span id="cb157-21"><a href="financial-score-card-model.html#cb157-21" tabindex="-1"></a>    <span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i <span class="sc">&amp;</span> </span>
<span id="cb157-22"><a href="financial-score-card-model.html#cb157-22" tabindex="-1"></a>                                 train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">1</span>)])<span class="sc">*</span>(<span class="sc">-</span>cost) <span class="sc">+</span> <span class="fl">30.95975</span><span class="sc">*</span><span class="fu">length</span>(train_comb<span class="sc">$</span>GB[<span class="fu">which</span>(train_comb<span class="sc">$</span>Score <span class="sc">&gt;=</span> i <span class="sc">&amp;</span> </span>
<span id="cb157-23"><a href="financial-score-card-model.html#cb157-23" tabindex="-1"></a>                                                                                                   train_comb<span class="sc">$</span>GB <span class="sc">==</span> <span class="dv">0</span>)])<span class="sc">*</span>profit</span>
<span id="cb157-24"><a href="financial-score-card-model.html#cb157-24" tabindex="-1"></a>}</span>
<span id="cb157-25"><a href="financial-score-card-model.html#cb157-25" tabindex="-1"></a></span>
<span id="cb157-26"><a href="financial-score-card-model.html#cb157-26" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(def, acc, prof, score)</span>
<span id="cb157-27"><a href="financial-score-card-model.html#cb157-27" tabindex="-1"></a></span>
<span id="cb157-28"><a href="financial-score-card-model.html#cb157-28" tabindex="-1"></a>def_plot <span class="ot">&lt;-</span> <span class="fu">xyplot</span>(def <span class="sc">~</span> score, plot_data, </span>
<span id="cb157-29"><a href="financial-score-card-model.html#cb157-29" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;l&quot;</span> , <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>,</span>
<span id="cb157-30"><a href="financial-score-card-model.html#cb157-30" tabindex="-1"></a>                   <span class="at">ylab =</span> <span class="st">&quot;Default Rate (%)&quot;</span>,</span>
<span id="cb157-31"><a href="financial-score-card-model.html#cb157-31" tabindex="-1"></a>                   <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>,</span>
<span id="cb157-32"><a href="financial-score-card-model.html#cb157-32" tabindex="-1"></a>                   <span class="at">main =</span> <span class="st">&quot;Default Rate by Acceptance Across Score&quot;</span>,</span>
<span id="cb157-33"><a href="financial-score-card-model.html#cb157-33" tabindex="-1"></a>                   <span class="at">panel =</span> <span class="cf">function</span>(x, y,...) {</span>
<span id="cb157-34"><a href="financial-score-card-model.html#cb157-34" tabindex="-1"></a>                     <span class="fu">panel.xyplot</span>(x, y, ...)</span>
<span id="cb157-35"><a href="financial-score-card-model.html#cb157-35" tabindex="-1"></a>                     <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="fl">3.23</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb157-36"><a href="financial-score-card-model.html#cb157-36" tabindex="-1"></a>                   })</span>
<span id="cb157-37"><a href="financial-score-card-model.html#cb157-37" tabindex="-1"></a></span>
<span id="cb157-38"><a href="financial-score-card-model.html#cb157-38" tabindex="-1"></a>acc_plot <span class="ot">&lt;-</span> <span class="fu">xyplot</span>(acc <span class="sc">~</span> score, plot_data, </span>
<span id="cb157-39"><a href="financial-score-card-model.html#cb157-39" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>,</span>
<span id="cb157-40"><a href="financial-score-card-model.html#cb157-40" tabindex="-1"></a>                   <span class="at">ylab =</span> <span class="st">&quot;Acceptance Rate (%)&quot;</span>,</span>
<span id="cb157-41"><a href="financial-score-card-model.html#cb157-41" tabindex="-1"></a>                   <span class="at">panel =</span> <span class="cf">function</span>(x, y,...) {</span>
<span id="cb157-42"><a href="financial-score-card-model.html#cb157-42" tabindex="-1"></a>                     <span class="fu">panel.xyplot</span>(x, y, ...)</span>
<span id="cb157-43"><a href="financial-score-card-model.html#cb157-43" tabindex="-1"></a>                     <span class="fu">panel.abline</span>(<span class="at">h =</span> <span class="dv">75</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb157-44"><a href="financial-score-card-model.html#cb157-44" tabindex="-1"></a>                   })</span>
<span id="cb157-45"><a href="financial-score-card-model.html#cb157-45" tabindex="-1"></a></span>
<span id="cb157-46"><a href="financial-score-card-model.html#cb157-46" tabindex="-1"></a>prof_plot <span class="ot">&lt;-</span> <span class="fu">xyplot</span>(prof<span class="sc">/</span><span class="dv">1000</span> <span class="sc">~</span> score, plot_data, </span>
<span id="cb157-47"><a href="financial-score-card-model.html#cb157-47" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;l&quot;</span> , <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;green&quot;</span>,</span>
<span id="cb157-48"><a href="financial-score-card-model.html#cb157-48" tabindex="-1"></a>                    <span class="at">ylab =</span> <span class="st">&quot;Profit (Thousands $)&quot;</span>,</span>
<span id="cb157-49"><a href="financial-score-card-model.html#cb157-49" tabindex="-1"></a>                    <span class="at">xlab =</span> <span class="st">&quot;Score&quot;</span>,</span>
<span id="cb157-50"><a href="financial-score-card-model.html#cb157-50" tabindex="-1"></a>                    <span class="at">main =</span> <span class="st">&quot;Profit by Acceptance Across Score&quot;</span></span>
<span id="cb157-51"><a href="financial-score-card-model.html#cb157-51" tabindex="-1"></a>)</span>
<span id="cb157-52"><a href="financial-score-card-model.html#cb157-52" tabindex="-1"></a></span>
<span id="cb157-53"><a href="financial-score-card-model.html#cb157-53" tabindex="-1"></a><span class="fu">doubleYScale</span>(def_plot, acc_plot, <span class="at">add.ylab2 =</span> <span class="cn">TRUE</span>, <span class="at">use.style=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="financial-score-card-model.html#cb158-1" tabindex="-1"></a><span class="fu">doubleYScale</span>(prof_plot, acc_plot, <span class="at">add.ylab2 =</span> <span class="cn">TRUE</span>, <span class="at">use.style=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-38-2.png" width="672" /></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="financial-score-card-model.html#cb159-1" tabindex="-1"></a>ay1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb159-2"><a href="financial-score-card-model.html#cb159-2" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Default Rate (%)&quot;</span>,</span>
<span id="cb159-3"><a href="financial-score-card-model.html#cb159-3" tabindex="-1"></a>  <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb159-4"><a href="financial-score-card-model.html#cb159-4" tabindex="-1"></a>)</span>
<span id="cb159-5"><a href="financial-score-card-model.html#cb159-5" tabindex="-1"></a></span>
<span id="cb159-6"><a href="financial-score-card-model.html#cb159-6" tabindex="-1"></a></span>
<span id="cb159-7"><a href="financial-score-card-model.html#cb159-7" tabindex="-1"></a>ay2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb159-8"><a href="financial-score-card-model.html#cb159-8" tabindex="-1"></a>  <span class="at">tickfont =</span> <span class="fu">list</span>(),</span>
<span id="cb159-9"><a href="financial-score-card-model.html#cb159-9" tabindex="-1"></a>  <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb159-10"><a href="financial-score-card-model.html#cb159-10" tabindex="-1"></a>  <span class="at">overlaying =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb159-11"><a href="financial-score-card-model.html#cb159-11" tabindex="-1"></a>  <span class="at">side =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb159-12"><a href="financial-score-card-model.html#cb159-12" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Acceptance Rate (%)&quot;</span></span>
<span id="cb159-13"><a href="financial-score-card-model.html#cb159-13" tabindex="-1"></a>)</span>
<span id="cb159-14"><a href="financial-score-card-model.html#cb159-14" tabindex="-1"></a></span>
<span id="cb159-15"><a href="financial-score-card-model.html#cb159-15" tabindex="-1"></a></span>
<span id="cb159-16"><a href="financial-score-card-model.html#cb159-16" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb159-17"><a href="financial-score-card-model.html#cb159-17" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span>score, <span class="at">y =</span> <span class="sc">~</span>def, <span class="at">name =</span> <span class="st">&quot;Default Rate (%)&quot;</span>)</span>
<span id="cb159-18"><a href="financial-score-card-model.html#cb159-18" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span>score, <span class="at">y =</span> <span class="sc">~</span>acc, <span class="at">name =</span> <span class="st">&quot;Acceptance Rate (%)&quot;</span>, <span class="at">yaxis =</span> <span class="st">&quot;y2&quot;</span>)</span>
<span id="cb159-19"><a href="financial-score-card-model.html#cb159-19" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb159-20"><a href="financial-score-card-model.html#cb159-20" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Default Rate by Acceptance Across Score&quot;</span>, <span class="at">yaxis =</span> ay1, <span class="at">yaxis2 =</span> ay2,</span>
<span id="cb159-21"><a href="financial-score-card-model.html#cb159-21" tabindex="-1"></a>  <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">&quot;Scorecard Value&quot;</span>),</span>
<span id="cb159-22"><a href="financial-score-card-model.html#cb159-22" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">1.2</span>, <span class="at">y =</span> <span class="fl">0.8</span>)</span>
<span id="cb159-23"><a href="financial-score-card-model.html#cb159-23" tabindex="-1"></a>)</span>
<span id="cb159-24"><a href="financial-score-card-model.html#cb159-24" tabindex="-1"></a></span>
<span id="cb159-25"><a href="financial-score-card-model.html#cb159-25" tabindex="-1"></a>fig</span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6605e0eff4a6e76f13f1" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-6605e0eff4a6e76f13f1">{"x":{"visdat":{"1802577420e0c":["function () ","plotlyVisDat"]},"cur_data":"1802577420e0c","attrs":{"1802577420e0c":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Default Rate (%)","inherit":true},"1802577420e0c.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Acceptance Rate (%)","yaxis":"y2","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Default Rate by Acceptance Across Score","yaxis":{"domain":[0,1],"automargin":true,"title":"Default Rate (%)","range":[0,10]},"yaxis2":{"tickfont":[],"range":[0,100],"overlaying":"y","side":"right","title":"Acceptance Rate (%)"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Scorecard Value"},"legend":{"x":1.2,"y":0.80000000000000004},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665],"y":[4.1961584169692649,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,4.0216876129172343,3.9892154901284722,3.9892154901284722,3.9892154901284722,3.9892154901284722,3.9892154901284722,3.9892154901284722,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.5941045880392668,3.592105288161322,3.592105288161322,3.592105288161322,3.592105288161322,3.592105288161322,3.592105288161322,3.4487235855736391,3.4438940667939,3.4438940667939,3.4438940667939,3.4438940667939,3.4438940667939,3.4438940667939,3.4438940667939,3.1644623335528506,3.1644623335528506,3.1543145016347482,3.1543145016347482,3.1543145016347482,3.1543145016347482,3.1543145016347482,3.1417015528090544,3.1417015528090544,3.1366020393426712,3.1340466991688589,3.1340466991688589,3.0927769221465264,3.0512208864707224,3.0512208864707224,3.0406986598576093,2.8526011086634209,2.8526011086634209,2.8526011086634209,2.8526011086634209,2.8526011086634209,2.8526011086634209,2.8526011086634209,2.8106923848670129,2.8106923848670129,2.807963344734179,2.8037750857039505,2.8037750857039505,2.7502903932066243,2.7530773681285035,2.7266827643551244,2.7266827643551244,2.7191314522307062,2.7191314522307062,2.7191314522307062,2.5665670874283508,2.5665670874283508,2.5665670874283508,2.5689972449110172,2.5689972449110172,2.5475660746627313,2.5475660746627313,2.5475660746627313,2.5475660746627313,2.5475660746627313,2.5475660746627313,2.467780553609598,2.4503097534603731,2.449615256703348,2.449615256703348,2.449615256703348,2.312340318053248,2.312340318053248,2.312340318053248,2.2746087275017297,2.2746087275017297,2.2517230321688473,2.2301817498345611,2.2301817498345611,2.0868564081620491,2.0868564081620491,2.0868564081620491,2.0831343965326914,2.0831343965326914,2.0831343965326914,2.0831343965326914,2.0855888956625068,2.0781354375101677,2.0805871218706766,2.085507885912635,1.9394629401498875,1.9446875182994225,1.9430386246562694,1.9476298561918806,1.9283682340392965,1.8185205666252422,1.6056788764610883,1.6056788764610883,1.6056788764610883,1.6056788764610883,1.6002306546994884,1.6002306546994884,1.5947818295542036,1.5893324009249916,1.5618848770915139,1.5618848770915139,1.5618848770915139,1.5672982766771799,1.56178820383049,1.56178820383049,1.56178820383049,1.5560430029397374,1.5504925802164251,1.5532037885125527,1.4469382425054025,1.4469382425054025,1.4469382425054025,1.4492061854461507,1.4292171968453666,1.4292171968453666,1.4292171968453666,1.4152391179168389,1.4152391179168389,1.4152391179168389,1.4117086015566247,1.4117086015566247,1.413818313224281,1.4059272880890348,1.4059272880890348,1.4065182834107803,1.4123201819121689,1.4100659276661816,1.4034138852420368,1.3507443120676534,1.356562742713858,1.3505180423671226,1.3333830299352734,1.307798299085706,1.3168868629947945,1.3168868629947945,1.3168868629947945,1.3168868629947945,1.3168868629947945,1.2894072149601246,1.2894072149601246,1.2925343431760543,1.2925343431760543,1.2686574929550949,1.2686574929550949,1.2410915461690288,1.2348826565618964,1.2348826565618964,1.2083455145510609,1.3454292140480513,1.281545128448391,1.281545128448391,1.281545128448391,1.2908747017525375,1.2755203724519488,1.2755203724519488,1.2755203724519488,1.2755203724519488,1.2601612656375221,1.2601612656375221,1.2601612656375221,1.2601612656375221,1.2601612656375221,1.2601612656375221,1.2497395015936277,1.2497395015936277,1.2497395015936277,1.2951922463814323,1.2951922463814323,0.84074658296567362,0.84074658296567362,0.84074658296567362,0.81162546688488002,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.7268121537955895,0.72262746442781622,0.72262746442781622,0.72262746442781622,0.76543917730597222,0.76543917730597222,0.76543917730597222,0.76543917730597222,0.76543917730597222,0.76543917730597222,0.76543917730597222,0.76543917730597222,0.77694663372089212,0.77694663372089212,0.77694663372089212,0.80103172886678042,0.80103172886678042,0.80103172886678042,0.80103172886678042,0.80103172886678042,0.92312975450287316,0.91441843559007996,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.86720549034466754,0.91441843559007996,0.91441843559007996,0.9410600005740466,0.90025927467110534,0.90025927467110534,1.3125432729110289,0,0,0],"type":"scatter","mode":"lines","name":"Default Rate (%)","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665],"y":[99.999999999999986,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,97.993264193657737,97.993264193657737,97.993264193657737,97.993264193657737,97.993264193657737,97.993264193657737,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.393619321048263,94.393619321048263,94.393619321048263,94.393619321048263,94.393619321048263,94.393619321048263,92.546489711834852,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,88.352954183186611,88.352954183186611,88.343696249558434,88.343696249558434,88.343696249558434,88.343696249558434,88.343696249558434,87.814331655045493,87.814331655045493,87.73573237716316,87.733417893756112,87.733417893756112,86.808742426424445,86.54979975870701,86.54979975870701,86.392601202942345,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.428013215677126,82.428013215677126,82.425698732270078,82.053532693521788,82.053532693521788,81.713676264514973,81.126542742783087,79.704905448637078,79.704905448637078,79.33042492648174,79.33042492648174,79.33042492648174,75.749668552957147,75.749668552957147,75.749668552957147,75.678012725295957,75.678012725295957,75.587841030378385,75.587841030378385,75.587841030378385,75.587841030378385,75.587841030378385,75.587841030378385,73.248471719121838,72.353884536081736,72.279914225013485,72.279914225013485,72.279914225013485,69.464320279648845,69.464320279648845,69.464320279648845,67.971027157841633,67.971027157841633,66.708902902867337,66.107882480693178,66.107882480693178,60.888300004589041,60.888300004589041,60.888300004589041,60.885985521181993,60.885985521181993,60.885985521181993,60.885985521181993,60.814329693520797,60.809700726706716,60.738044899045505,60.594733243723091,53.343328275627762,53.200016620305348,53.126046309237097,52.763138204116999,51.729868332568572,46.70914511355587,41.801645265574038,41.801645265574038,41.801645265574038,41.801645265574038,41.799330782166997,41.799330782166997,41.797016298759956,41.794701815352909,41.491877120858788,41.491877120858788,41.491877120858788,41.348565465536375,41.346250982129334,41.346250982129334,41.346250982129334,41.052684221263391,41.050369737856343,40.97871391019514,36.790179980189528,36.790179980189528,36.790179980189528,36.57289801379887,36.274702286118831,36.274702286118831,36.274702286118831,35.978821041845848,35.978821041845848,35.978821041845848,35.904850730777596,35.904850730777596,35.687568764386945,35.394002003520988,35.394002003520988,34.885467759671428,34.742156104349021,34.305277688160658,34.302963204753617,33.413004988527597,33.26969333320519,32.904470744678036,31.591521012705922,31.147699146296432,30.932731663312815,30.932731663312815,30.932731663312815,30.932731663312815,30.932731663312815,29.617467447933659,29.617467447933659,29.545811620272453,29.545811620272453,26.635603329090443,26.635603329090443,22.565014894886897,22.491044583818649,22.491044583818649,19.728776914773135,16.342437147440169,15.170484587383418,15.170484587383418,15.170484587383418,14.881546793331555,14.879232309924513,14.879232309924513,14.879232309924513,14.879232309924513,14.876917826517468,14.876917826517468,14.876917826517468,14.876917826517468,14.876917826517468,14.876917826517468,12.408216918337903,12.408216918337903,12.408216918337903,11.615373847250563,11.615373847250563,5.7810703644442851,5.7810703644442851,5.7810703644442851,5.4181622593241752,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.1245954984582269,5.1245954984582269,5.1245954984582269,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.7663163601522038,4.7663163601522038,4.7663163601522038,4.6230047048297944,4.6230047048297944,4.6230047048297944,4.6230047048297944,4.6230047048297944,3.7608202894882936,3.5435383230976365,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,2.5310988022125978,2.5310988022125978,2.459442974551393,2.3138168358219402,2.3138168358219402,1.2343504540897827,0.3582791383060237,0.3582791383060237,0.14331165532240947],"type":"scatter","mode":"lines","name":"Acceptance Rate (%)","yaxis":"y2","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="financial-score-card-model.html#cb160-1" tabindex="-1"></a>ay1 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb160-2"><a href="financial-score-card-model.html#cb160-2" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Profit ($)&quot;</span>,</span>
<span id="cb160-3"><a href="financial-score-card-model.html#cb160-3" tabindex="-1"></a>  <span class="at">showline =</span> <span class="cn">FALSE</span>,</span>
<span id="cb160-4"><a href="financial-score-card-model.html#cb160-4" tabindex="-1"></a>  <span class="at">showgrid =</span> <span class="cn">FALSE</span></span>
<span id="cb160-5"><a href="financial-score-card-model.html#cb160-5" tabindex="-1"></a>)</span>
<span id="cb160-6"><a href="financial-score-card-model.html#cb160-6" tabindex="-1"></a>ay2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb160-7"><a href="financial-score-card-model.html#cb160-7" tabindex="-1"></a>  <span class="at">tickfont =</span> <span class="fu">list</span>(),</span>
<span id="cb160-8"><a href="financial-score-card-model.html#cb160-8" tabindex="-1"></a>  <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb160-9"><a href="financial-score-card-model.html#cb160-9" tabindex="-1"></a>  <span class="at">overlaying =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb160-10"><a href="financial-score-card-model.html#cb160-10" tabindex="-1"></a>  <span class="at">side =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb160-11"><a href="financial-score-card-model.html#cb160-11" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Acceptance Rate (%)&quot;</span></span>
<span id="cb160-12"><a href="financial-score-card-model.html#cb160-12" tabindex="-1"></a>)</span>
<span id="cb160-13"><a href="financial-score-card-model.html#cb160-13" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>()</span>
<span id="cb160-14"><a href="financial-score-card-model.html#cb160-14" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span>score, <span class="at">y =</span> <span class="sc">~</span>prof, <span class="at">name =</span> <span class="st">&quot;Profit ($)&quot;</span>)</span>
<span id="cb160-15"><a href="financial-score-card-model.html#cb160-15" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span>score, <span class="at">y =</span> <span class="sc">~</span>acc, <span class="at">name =</span> <span class="st">&quot;Acceptance Rate (%)&quot;</span>, <span class="at">yaxis =</span> <span class="st">&quot;y2&quot;</span>)</span>
<span id="cb160-16"><a href="financial-score-card-model.html#cb160-16" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span> <span class="fu">layout</span>(</span>
<span id="cb160-17"><a href="financial-score-card-model.html#cb160-17" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Profit by Acceptance Across Score&quot;</span>, <span class="at">yaxis =</span> ay1, <span class="at">yaxis2 =</span> ay2,</span>
<span id="cb160-18"><a href="financial-score-card-model.html#cb160-18" tabindex="-1"></a>  <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title=</span><span class="st">&quot;Scorecard Value&quot;</span>),</span>
<span id="cb160-19"><a href="financial-score-card-model.html#cb160-19" tabindex="-1"></a>  <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">1.2</span>, <span class="at">y =</span> <span class="fl">0.8</span>)</span>
<span id="cb160-20"><a href="financial-score-card-model.html#cb160-20" tabindex="-1"></a>)</span>
<span id="cb160-21"><a href="financial-score-card-model.html#cb160-21" tabindex="-1"></a></span>
<span id="cb160-22"><a href="financial-score-card-model.html#cb160-22" tabindex="-1"></a>fig</span></code></pre></div>
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d84d63235da18378f9e5" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-d84d63235da18378f9e5">{"x":{"visdat":{"180254a15cc67":["function () ","plotlyVisDat"]},"cur_data":"180254a15cc67","attrs":{"180254a15cc67":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Profit ($)","inherit":true},"180254a15cc67.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Acceptance Rate (%)","yaxis":"y2","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Profit by Acceptance Across Score","yaxis":{"domain":[0,1],"automargin":true,"title":"Profit ($)","showline":false,"showgrid":false},"yaxis2":{"tickfont":[],"range":[0,100],"overlaying":"y","side":"right","title":"Acceptance Rate (%)"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Scorecard Value"},"legend":{"x":1.2,"y":0.80000000000000004},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665],"y":[-11489628.5,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-7322421,-6527696.5,-6527696.5,-6527696.5,-6527696.5,-6527696.5,-6527696.5,2415684.5,2415684.5,2415684.5,2415684.5,2415684.5,2415684.5,2415684.5,2415684.5,2415684.5,2415684.5,2457765,2457765,2457765,2457765,2457765,2457765,5505616.5,5609616.5,5609616.5,5609616.5,5609616.5,5609616.5,5609616.5,5609616.5,11115883,11115883,11323883,11323883,11323883,11323883,11323883,11514446.5,11514446.5,11608527,11660527,11660527,12373493,13175734.5,13175734.5,13363895.5,16433679,16433679,16433679,16433679,16433679,16433679,16433679,17174001,17174001,17226001,17228403.5,17228403.5,18176725.5,17993369.5,18168899.000000007,18168899.000000007,18223301.5,18223301.5,18223301.5,20097085,20097085,20097085,20035165.5,20035165.5,20389246,20389246,20389246,20389246,20389246,20389246,21121741.5,21158707.5,21148788,21148788,21148788,22549766.5,22549766.5,22549766.5,22663376.5,22663376.5,22598745,22727389,22727389,22969024,22969024,22969024,23021024,23021024,23021024,23021024,22959104.5,23063104.5,23001185,22877346,21957235,21833396,21823476.5,21617879,21427006,20544479.999999993,20461793,20461793,20461793,20461793,20513793,20513793,20565793,20617793,20734115,20734115,20734115,20610276,20662276,20662276,20662276,20570598,20622598,20560678.5,19371267,19371267,19371267,19237508.5,19249830.5,19249830.5,19249830.5,19210152.5,19210152.5,19210152.5,19200233,19200233,19066474.5,18974796.5,18974796.5,18697360,18573521,18358004,18410004,18342970,18219131,18065533.5,17470982.5,17411465.5,17225707,17225707,17225707,17225707,17225707,16683156,16683156,16621236.5,16621236.5,15132456.5,15132456.5,12964964.5,12955045,12955045,11486104,8991887.5,8573175.5,8573175.5,8573175.5,8377497.5,8429497.5,8429497.5,8429497.5,8429497.5,8481497.5,8481497.5,8481497.5,8481497.5,8481497.5,8481497.5,7104234.5,7104234.5,7104234.5,6527119.9999999981,6527119.9999999981,3861559.9999999991,3861559.9999999991,3861559.9999999991,3655962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3759962.5,3564284.5,3564284.5,3564284.5,3316606.5,3316606.5,3316606.5,3316606.5,3316606.5,3316606.5,3316606.5,3316606.5,3254687,3254687,3254687,3130848,3130848,3130848,3130848,3130848,2439814,2306055.5,2296136,2296136,2296136,2296136,2296136,2296136,2296136,2296136,2296136,2296136,2296136,2296136,1647182.5,1647182.5,1585263,1513424,1513424,688631.5,309597.49999999994,309597.49999999994,123839],"type":"scatter","mode":"lines","name":"Profit ($)","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[405,406,407,408,409,410,411,412,413,414,415,416,417,418,419,420,421,422,423,424,425,426,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,444,445,446,447,448,449,450,451,452,453,454,455,456,457,458,459,460,461,462,463,464,465,466,467,468,469,470,471,472,473,474,475,476,477,478,479,480,481,482,483,484,485,486,487,488,489,490,491,492,493,494,495,496,497,498,499,500,501,502,503,504,505,506,507,508,509,510,511,512,513,514,515,516,517,518,519,520,521,522,523,524,525,526,527,528,529,530,531,532,533,534,535,536,537,538,539,540,541,542,543,544,545,546,547,548,549,550,551,552,553,554,555,556,557,558,559,560,561,562,563,564,565,566,567,568,569,570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665],"y":[99.999999999999986,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,98.698343211191712,97.993264193657737,97.993264193657737,97.993264193657737,97.993264193657737,97.993264193657737,97.993264193657737,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.469904115523562,94.393619321048263,94.393619321048263,94.393619321048263,94.393619321048263,94.393619321048263,94.393619321048263,92.546489711834852,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,92.541860745020756,88.352954183186611,88.352954183186611,88.343696249558434,88.343696249558434,88.343696249558434,88.343696249558434,88.343696249558434,87.814331655045493,87.814331655045493,87.73573237716316,87.733417893756112,87.733417893756112,86.808742426424445,86.54979975870701,86.54979975870701,86.392601202942345,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.758611711055764,82.428013215677126,82.428013215677126,82.425698732270078,82.053532693521788,82.053532693521788,81.713676264514973,81.126542742783087,79.704905448637078,79.704905448637078,79.33042492648174,79.33042492648174,79.33042492648174,75.749668552957147,75.749668552957147,75.749668552957147,75.678012725295957,75.678012725295957,75.587841030378385,75.587841030378385,75.587841030378385,75.587841030378385,75.587841030378385,75.587841030378385,73.248471719121838,72.353884536081736,72.279914225013485,72.279914225013485,72.279914225013485,69.464320279648845,69.464320279648845,69.464320279648845,67.971027157841633,67.971027157841633,66.708902902867337,66.107882480693178,66.107882480693178,60.888300004589041,60.888300004589041,60.888300004589041,60.885985521181993,60.885985521181993,60.885985521181993,60.885985521181993,60.814329693520797,60.809700726706716,60.738044899045505,60.594733243723091,53.343328275627762,53.200016620305348,53.126046309237097,52.763138204116999,51.729868332568572,46.70914511355587,41.801645265574038,41.801645265574038,41.801645265574038,41.801645265574038,41.799330782166997,41.799330782166997,41.797016298759956,41.794701815352909,41.491877120858788,41.491877120858788,41.491877120858788,41.348565465536375,41.346250982129334,41.346250982129334,41.346250982129334,41.052684221263391,41.050369737856343,40.97871391019514,36.790179980189528,36.790179980189528,36.790179980189528,36.57289801379887,36.274702286118831,36.274702286118831,36.274702286118831,35.978821041845848,35.978821041845848,35.978821041845848,35.904850730777596,35.904850730777596,35.687568764386945,35.394002003520988,35.394002003520988,34.885467759671428,34.742156104349021,34.305277688160658,34.302963204753617,33.413004988527597,33.26969333320519,32.904470744678036,31.591521012705922,31.147699146296432,30.932731663312815,30.932731663312815,30.932731663312815,30.932731663312815,30.932731663312815,29.617467447933659,29.617467447933659,29.545811620272453,29.545811620272453,26.635603329090443,26.635603329090443,22.565014894886897,22.491044583818649,22.491044583818649,19.728776914773135,16.342437147440169,15.170484587383418,15.170484587383418,15.170484587383418,14.881546793331555,14.879232309924513,14.879232309924513,14.879232309924513,14.879232309924513,14.876917826517468,14.876917826517468,14.876917826517468,14.876917826517468,14.876917826517468,14.876917826517468,12.408216918337903,12.408216918337903,12.408216918337903,11.615373847250563,11.615373847250563,5.7810703644442851,5.7810703644442851,5.7810703644442851,5.4181622593241752,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.4135332925100892,5.1245954984582269,5.1245954984582269,5.1245954984582269,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.8379721878134081,4.7663163601522038,4.7663163601522038,4.7663163601522038,4.6230047048297944,4.6230047048297944,4.6230047048297944,4.6230047048297944,4.6230047048297944,3.7608202894882936,3.5435383230976365,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,3.4695680120293888,2.5310988022125978,2.5310988022125978,2.459442974551393,2.3138168358219402,2.3138168358219402,1.2343504540897827,0.3582791383060237,0.3582791383060237,0.14331165532240947],"type":"scatter","mode":"lines","name":"Acceptance Rate (%)","yaxis":"y2","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="future-projects.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aidan-miller/Arsenal/edit/main/02-tears.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/aidan-miller/Arsenal/blob/main/02-tears.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
